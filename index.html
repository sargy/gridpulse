<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>GridPulse</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Fraunces:ital,wght@0,100;0,300;1,100&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #07070f;
    --surface: #10101a;
    --surface2: #18182a;
    --border: rgba(255,255,255,0.07);
    --accent: #c8ff00;
    --text: #e8e8f0;
    --muted: rgba(232,232,240,0.4);
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html { height: 100%; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Mono', monospace;
    height: 100vh;        /* fallback for older browsers */
    height: 100dvh;       /* dynamic viewport height ‚Äî excludes iOS Safari browser chrome */
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  header {
    padding: 0.7rem 1.5rem;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-shrink: 0;
    z-index: 100;
    background: var(--bg);
  }

  /* Header rotation fade */
  header.hdr-fading .hdr-race-block,
  header.hdr-fading .header-countdown {
    opacity: 0;
    transition: opacity 0.3s;
  }

  h1 {
    font-family: 'Fraunces', serif;
    font-weight: 100;
    font-size: 1.5rem;
    letter-spacing: -0.02em;
    white-space: nowrap;
  }
  h1 em { font-style: italic; color: var(--accent); }

  .header-divider {
    width: 1px; height: 2rem;
    background: var(--border);
    flex-shrink: 0;
  }

  /* Next race block in header */
  .hdr-race-block {
    display: flex;
    flex-direction: column;
    gap: 0.1rem;
    cursor: pointer;
    padding: 0.3rem 0.5rem;
    border-radius: 4px;
    transition: background 0.15s, opacity 0.3s;
    flex-shrink: 0;
  }
  .hdr-race-block:hover { background: rgba(255,255,255,0.05); }
  .next-race {
    display: flex;
    flex-direction: column;
    gap: 0.1rem;
  }
  .next-race-label {
    font-size: 0.52rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--muted);
  }
  .next-race-name {
    font-family: 'Fraunces', serif;
    font-size: 1rem;
    font-weight: 300;
    color: var(--text);
    line-height: 1;
  }
  .next-race-location {
    font-size: 0.58rem;
    color: var(--muted);
  }

  .header-countdown {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 0.1rem;
  }
  .header-countdown-label {
    font-size: 0.52rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: rgba(255,100,100,0.7);
  }
  .header-countdown-value {
    font-size: 1.3rem;
    font-weight: 500;
    color: #ff6060;
    font-variant-numeric: tabular-nums;
    letter-spacing: 0.02em;
    line-height: 1;
    white-space: nowrap;
  }

  .hint {
    font-size: 0.55rem;
    color: var(--muted);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    white-space: nowrap;
  }

  /* ‚îÄ‚îÄ News bar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  #news-toggle {
    width: 100%;
    display: flex;
    align-items: center;
    gap: 0.6rem;
    padding: 0 1.2rem;
    background: var(--surface2);
    border: none;
    border-bottom: 1px solid var(--border);
    cursor: pointer;
    color: var(--muted);
    font-family: 'DM Mono', monospace;
    font-size: 0.58rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    flex-shrink: 0;
    height: 34px;
    z-index: 10;
    position: relative;
    transition: background 0.15s;
    overflow: hidden;
    user-select: none;
  }
  #news-filter-bar {
    display: flex;
    gap: 0.3rem;
    flex-shrink: 0;
    align-items: center;
  }
  #news-toggle:hover { background: rgba(255,255,255,0.05); }
  #news-toggle .nt-label {
    white-space: nowrap;
    flex-shrink: 0;
    color: var(--text);
  }
  #news-toggle .nt-divider {
    width: 1px; height: 14px; background: var(--border); flex-shrink: 0;
  }
  #news-toggle .nt-arrow {
    font-size: 0.5rem; transition: transform 0.3s; flex-shrink: 0; margin-left: 0.4rem;
  }
  #news-toggle.open .nt-arrow { transform: rotate(180deg); }
  #news-toggle .nt-dot {
    width: 6px; height: 6px; border-radius: 50%;
    background: var(--accent); flex-shrink: 0;
    box-shadow: 0 0 6px var(--accent);
    animation: dot-pulse 2s ease-in-out infinite;
  }
  @keyframes dot-pulse {
    0%, 100% { opacity: 1; } 50% { opacity: 0.3; }
  }

  /* Ticker ‚Äî scrolling strip of headlines, hidden when dropdown open */
  #news-ticker-wrap {
    flex: 1;
    overflow: hidden;
    height: 100%;
    display: flex;
    align-items: center;
    mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%);
    -webkit-mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%);
  }
  #news-ticker {
    display: flex;
    gap: 3rem;
    white-space: nowrap;
    animation: ticker-scroll 60s linear infinite;
    will-change: transform;
  }
  #news-ticker:hover { animation-play-state: paused; }
  @keyframes ticker-scroll {
    0%   { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }
  .ticker-item {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
    color: var(--muted);
    text-decoration: none;
    transition: color 0.15s;
  }
  .ticker-item:hover { color: var(--text); }
  .ticker-badge {
    font-size: 0.52rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 1px 5px;
    border-radius: 2px;
    flex-shrink: 0;
  }
  .ticker-badge.f1   { background: rgba(230,0,0,0.25);   color:#ff6060; }
  .ticker-badge.fe   { background: rgba(180,0,255,0.2);   color:#d070ff; }
  .ticker-badge.indy { background: rgba(255,220,0,0.2);   color:#ffe040; }
  .ticker-sep { color: var(--border); font-size: 0.8rem; }

  /* Collapsible dropdown */
  #news-bar {
    flex-shrink: 0;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    overflow: hidden;
    transition: max-height 0.35s ease;
    max-height: 0;
  }
  #news-bar.open { max-height: 268px; }

  #news-list {
    overflow-y: auto;
    max-height: 268px;
    padding: 0.4rem 0;
    scroll-behavior: smooth;
  }
  #news-list::-webkit-scrollbar { width: 3px; }
  #news-list::-webkit-scrollbar-thumb { background: var(--border); }

  .news-item {
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: start;
    gap: 0.4rem 0.9rem;
    padding: 0.8rem 1.5rem;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    text-decoration: none;
    transition: background 0.15s;
  }
  .news-item:last-child { border-bottom: none; }
  .news-item:hover { background: var(--surface2); }
  .news-badge {
    font-size: 0.58rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 3px 6px;
    border-radius: 2px;
    white-space: nowrap;
    grid-row: span 2;
    align-self: start;
    margin-top: 2px;
  }
  .news-badge.f1   { background: rgba(230,0,0,0.2);   color:#ff6060; border:1px solid rgba(230,0,0,0.4); }
  .news-badge.fe   { background: rgba(180,0,255,0.2);  color:#d070ff; border:1px solid rgba(180,0,255,0.4); }
  .news-badge.indy { background: rgba(255,220,0,0.2);  color:#ffe040; border:1px solid rgba(255,200,0,0.4); }
  .news-badge.moto { background: rgba(0,180,255,0.2);  color:#60d4ff; border:1px solid rgba(0,180,255,0.4); }
  .news-headline {
    font-size: 0.95rem;
    color: var(--text);
    line-height: 1.35;
    font-weight: 400;
  }
  .news-summary {
    grid-column: 2;
    font-size: 0.78rem;
    color: var(--muted);
    line-height: 1.5;
    margin-top: 0.25rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .news-meta {
    font-size: 0.65rem;
    color: var(--muted);
    white-space: nowrap;
    grid-row: span 2;
    align-self: start;
    text-align: right;
    padding-top: 3px;
  }
  .news-loading, .news-error {
    padding: 1.5rem;
    text-align: center;
    font-size: 0.78rem;
    color: var(--muted);
  }
  .news-error { color: #ff6060; }

  .main {
    display: flex;
    flex: 1;
    overflow: hidden;
    position: relative;
  }

  #globe-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    background: var(--bg);
    position: relative;
  }

  /* Banner row above the canvas ‚Äî in normal flow so it pushes canvas down */
  .ad-above-globe {
    flex-shrink: 0;
    height: 70px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 5px 8px;
    background: var(--bg);
    border-bottom: 1px solid var(--border);
    margin: 0 0 0 0;
  }

  /* Canvas wrapper ‚Äî fills remaining vertical space, canvas absolute inside */
  #canvas-wrapper {
    flex: 1;
    position: relative;
    cursor: grab;
    overflow: hidden;
  }
  #canvas-wrapper:active { cursor: grabbing; }

  canvas {
    position: absolute !important;
    top: 0; left: 0;
    width: 100% !important;
    height: 100% !important;
    display: block;
  }

  /* Tooltip ‚Äî simplified */
  #tooltip {
    position: absolute;
    pointer-events: none;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-left: 2px solid var(--accent);
    padding: 0.75rem 1rem;
    min-width: 200px;
    max-width: 260px;
    opacity: 0;
    transform: translateY(6px);
    transition: opacity 0.2s, transform 0.2s;
    z-index: 50;
  }
  #tooltip.visible { opacity: 1; transform: translateY(0); }
  .tt-region { font-size: 0.56rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--muted); margin-bottom: 0.2rem; }
  .tt-city { font-family: 'Fraunces', serif; font-size: 1.05rem; font-weight: 300; margin-bottom: 0.05rem; }
  .tt-country { font-size: 0.58rem; color: var(--muted); margin-bottom: 0.4rem; }
  .tt-time { font-size: 1.1rem; font-weight: 400; color: var(--accent); letter-spacing: 0.02em; font-variant-numeric: tabular-nums; line-height: 1; margin-bottom: 0.15rem; }
  .tt-date { font-size: 0.58rem; color: var(--muted); margin-bottom: 0.4rem; }
  .tt-meta { font-size: 0.56rem; color: var(--muted); display: flex; gap: 0.8rem; border-top: 1px solid var(--border); padding-top: 0.4rem; }

  .phase-dot { display: inline-block; width: 5px; height: 5px; border-radius: 50%; margin-right: 4px; vertical-align: middle; }
  .phase-dot.day { background: var(--accent); box-shadow: 0 0 4px var(--accent); }
  .phase-dot.night { background: #4a4a7a; }
  .phase-dot.dawn, .phase-dot.dusk { background: #ff9500; }

  /* ‚îÄ‚îÄ Session panel ‚Äî normal flex item between globe and sidebar ‚îÄ‚îÄ */
  #session-panel {
    width: 0;
    flex-shrink: 0;
    overflow: hidden;
    background: var(--surface);
    border-left: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    transition: width 0.3s ease;
    z-index: 20;
  }
  #session-panel.open { width: 260px; }
  /* Split panel into scrollable content + fixed footer ad */
  .sp-inner {
    width: 260px;
    display: flex;
    flex-direction: column;
    height: 100%;
    overflow: hidden;
  }
  .sp-scroll {
    flex: 1;
    overflow-y: auto;
    padding: 1rem 1.2rem;
    min-height: 0;
  }
  .sp-scroll::-webkit-scrollbar { width: 3px; }
  .sp-scroll::-webkit-scrollbar-thumb { background: var(--border); }
  /* Each dynamically-injected ad block in the session panel */
  .sp-ad-block {
    height: 120px;
    width: 100%;
    margin-top: 1rem;
    flex-shrink: 0;
  }
  .sp-close {
    position: absolute; top: 0.6rem; right: 0.6rem;
    width: 20px; height: 20px; border-radius: 50%;
    background: var(--border); border: none; cursor: pointer;
    color: var(--muted); font-size: 0.7rem; display: flex; align-items: center; justify-content: center;
    transition: background 0.15s;
  }
  .sp-close:hover { background: rgba(255,255,255,0.12); }
  .sp-round { font-size: 0.55rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--muted); margin-bottom: 0.3rem; }
  .sp-name { font-family: 'Fraunces', serif; font-size: 1.15rem; font-weight: 300; margin-bottom: 0.1rem; line-height: 1.2; }
  .sp-venue { font-size: 0.6rem; color: var(--muted); margin-bottom: 0.6rem; }
  .sp-badges { margin-bottom: 0.8rem; }
  .sp-section-title {
    font-size: 0.52rem; letter-spacing: 0.15em; text-transform: uppercase;
    color: var(--muted); margin-bottom: 0.4rem; padding-top: 0.7rem;
    border-top: 1px solid var(--border);
  }
  .sp-session-row {
    display: flex; justify-content: space-between; align-items: baseline;
    padding: 0.25rem 0; border-bottom: 1px solid rgba(255,255,255,0.04);
    gap: 0.4rem;
  }
  .sp-series-tag { font-size: 0.5rem; font-weight: 500; letter-spacing: 0.06em; flex-shrink: 0; min-width: 26px; }
  .sp-session-label { font-size: 0.6rem; color: var(--muted); flex-shrink: 0; }
  .sp-session-label.is-race { color: #ff6060; font-weight: 500; }
  .sp-session-time { font-size: 0.65rem; color: var(--text); font-variant-numeric: tabular-nums; text-align: right; }
  .sp-session-time.past { color: var(--muted); text-decoration: line-through; }
  .sp-session-time.upcoming { color: var(--accent); }
  .sp-countdown {
    margin-top: 0.8rem;
    background: rgba(230,0,0,0.08);
    border: 1px solid rgba(230,0,0,0.25);
    border-radius: 3px;
    padding: 0.5rem 0.7rem;
    text-align: center;
  }
  .sp-countdown-label { font-size: 0.5rem; letter-spacing: 0.12em; text-transform: uppercase; color: rgba(255,100,100,0.6); margin-bottom: 0.2rem; }
  .sp-countdown-value { font-size: 1.1rem; font-weight: 500; color: #ff6060; font-variant-numeric: tabular-nums; }
  .sp-countdown-done { font-size: 0.68rem; color: var(--muted); font-style: italic; }

  /* Sidebar */
  #sidebar-wrap {
    position: relative;
    display: flex;
    flex-shrink: 0;
  }
  .sidebar {
    width: 280px;
    flex-shrink: 0;
    background: var(--surface);
    border-left: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    transition: width 0.3s;
  }
  .sidebar.collapsed { width: 0 !important; }
  .sidebar-header {
    padding: 0.7rem 1rem;
    border-bottom: 1px solid var(--border);
    font-size: 0.56rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--muted);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
  }
  /* Series filter buttons */
  .filter-bar {
    padding: 0.5rem 1rem;
    border-bottom: 1px solid var(--border);
    display: flex;
    gap: 0.3rem;
    flex-wrap: wrap;
    flex-shrink: 0;
  }
  .filter-btn {
    font-family: 'DM Mono', monospace;
    font-size: 0.5rem;
    font-weight: 500;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding: 3px 8px;
    border-radius: 2px;
    border: 1px solid transparent;
    cursor: pointer;
    transition: all 0.15s;
    background: transparent;
  }
  .filter-btn.all { border-color: rgba(255,255,255,0.2); color: var(--muted); }
  .filter-btn.all.active { background: rgba(255,255,255,0.1); color: var(--text); border-color: rgba(255,255,255,0.3); }
  .filter-btn.f1  { border-color: rgba(230,0,0,0.4);   color: #ff6060; }
  .filter-btn.f2  { border-color: rgba(0,180,255,0.4); color: #60d4ff; }
  .filter-btn.f3  { border-color: rgba(0,220,120,0.4); color: #60ffb0; }
  .filter-btn.f1a { border-color: rgba(255,150,0,0.4); color: #ffb060; }
  .filter-btn.fe  { border-color: rgba(140,0,255,0.4); color: #bb80ff; }
  .filter-btn.indy{ border-color: rgba(255,200,0,0.4); color: #ffe040; }
.filter-btn.wec { border-color: rgba(0,200,180,0.4); color: #00e8cc; }
.filter-btn.wrc { border-color: rgba(255,80,40,0.4);  color: #ff6644; }
  .filter-btn.f1.active  { background: rgba(230,0,0,0.2); }
  .filter-btn.f2.active  { background: rgba(0,180,255,0.15); }
  .filter-btn.f3.active  { background: rgba(0,220,120,0.15); }
  .filter-btn.f1a.active { background: rgba(255,150,0,0.15); }
  .filter-btn.fe.active  { background: rgba(140,0,255,0.15); }
  .filter-btn.indy.active{ background: rgba(255,200,0,0.15); }
.filter-btn.wec.active { background: rgba(0,200,180,0.15); }
.filter-btn.wrc.active { background: rgba(255,80,40,0.15);  }

  .city-list { overflow-y: auto; flex: 1; width: 100%; }
  .city-list::-webkit-scrollbar { width: 3px; }
  .city-list::-webkit-scrollbar-thumb { background: var(--border); }

  .city-item {
    padding: 0.6rem 1rem;
    border-bottom: 1px solid var(--border);
    cursor: pointer;
    display: grid;
    grid-template-columns: 1fr auto;
    grid-template-rows: auto auto auto;
    gap: 0.05rem 0.6rem;
    transition: background 0.15s;
    position: relative;
  }
  .city-item::before {
    content: '';
    position: absolute;
    left: 0; top: 0; bottom: 0; width: 2px;
    background: var(--accent);
    opacity: 0;
    transition: opacity 0.15s;
  }
  .city-item:hover { background: var(--surface2); }
  .city-item:hover::before, .city-item.active::before { opacity: 1; }
  .city-item.active { background: var(--surface2); }
  .city-item.hidden { display: none; }

  .ci-name { font-family: 'Fraunces', serif; font-size: 0.9rem; font-weight: 300; grid-column:1; grid-row:1; }
  .ci-country { font-size: 0.56rem; color: var(--muted); grid-column:1; grid-row:2; }
  .ci-time { font-size: 0.72rem; font-weight: 500; color: var(--accent); text-align: right; grid-column:2; grid-row:1; font-variant-numeric: tabular-nums; white-space: nowrap; }
  .ci-date { font-size: 0.56rem; color: var(--muted); text-align: right; grid-column:2; grid-row:2; }

  .series-badges { display: flex; gap: 3px; flex-wrap: wrap; margin-top: 2px; grid-column:1; grid-row:3; }
  .badge {
    font-size: 0.44rem; font-weight: 500; letter-spacing: 0.08em;
    padding: 1px 4px; border-radius: 2px; text-transform: uppercase;
  }
  .badge-f1  { background: rgba(230,0,0,0.25);    color: #ff6060; border: 1px solid rgba(230,0,0,0.4); }
  .badge-f2  { background: rgba(0,180,255,0.2);   color: #60d4ff; border: 1px solid rgba(0,180,255,0.4); }
  .badge-f3  { background: rgba(0,220,120,0.2);   color: #60ffb0; border: 1px solid rgba(0,220,120,0.4); }
  .badge-f1a { background: rgba(255,150,0,0.2);   color: #ffb060; border: 1px solid rgba(255,150,0,0.4); }
  .badge-fe  { background: rgba(100,0,255,0.2);   color: #bb80ff; border: 1px solid rgba(140,0,255,0.4); }
  .badge-indy{ background: rgba(255,220,0,0.2);   color: #ffe040; border: 1px solid rgba(255,200,0,0.4); }
  .badge-fe  { background: rgba(180,0,255,0.2);   color: #d070ff; border: 1px solid rgba(180,0,255,0.4); }
  .badge-indy{ background: rgba(255,220,0,0.2);   color: #ffe040; border: 1px solid rgba(255,220,0,0.4); }
  .badge-wec { background: rgba(0,200,180,0.2);   color: #00e8cc; border: 1px solid rgba(0,200,180,0.4); }
  .badge-wrc { background: rgba(255,80,40,0.2);    color: #ff6644; border: 1px solid rgba(255,80,40,0.4); }

  @keyframes pulse-ring {
    0%   { transform: scale(1);   opacity: 0.9; }
    70%  { transform: scale(2.8); opacity: 0; }
    100% { transform: scale(2.8); opacity: 0; }
  }

  /* Ad placeholder boxes */
  .ad-placeholder {
    background: rgba(220,0,0,0.25);
    border: 2px dashed rgba(255,60,60,0.7);
    color: rgba(255,100,100,0.9);
    font-size: 0.55rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    text-align: center;
  }

  /* Skyscraper ‚Äî tall thin column to the LEFT of globe */
  .ad-skyscraper {
    width: 160px;
    flex-shrink: 0;
    height: 100%;
    display: flex;
    flex-direction: column;
    border-right: 1px solid var(--border);
    border-left: 1px solid var(--border);
    padding: 20px;
    box-sizing: border-box;
    background: var(--bg);
  }

  /* ‚îÄ‚îÄ MOBILE ‚îÄ‚îÄ */
  @media (max-width: 700px) {

    body { overflow: hidden; }

    /* Header ‚Äî compact, single line, no wrapping */
    header {
      padding: 0.5rem 1rem;
      gap: 0.6rem;
      flex-shrink: 0;
      flex-wrap: nowrap;
      overflow-x: hidden;
    }
    h1 { font-size: 1.1rem; }
    .next-race-name { font-size: 0.8rem; }
    .next-race-location { font-size: 0.52rem; }
    .next-race-label { font-size: 0.45rem; }
    .header-countdown-value { font-size: 1rem; }
    .header-countdown-label { font-size: 0.45rem; }
    .hint { display: none; }

    /* Mobile header countdown ‚Äî compact */
    .header-countdown-value { font-size: 0.95rem; }

    /* News toggle bar ‚Äî hide on mobile (news has its own full tab) */
    #news-toggle { display: none; }
    #news-bar    { display: none; }

    /* Main area ‚Äî stack vertically */
    .main { flex-direction: column; overflow: hidden; }

    /* Hide skyscraper and above-globe banner */
    .ad-skyscraper  { display: none; }
    .ad-above-globe { display: none; }

    /* Globe fills available space, padded for fixed bottom bars */
    #globe-container {
      flex: 1;
      min-height: 0;
      padding-bottom: calc(106px + env(safe-area-inset-bottom, 0px));
    }

    /* Mobile filter bar ‚Äî floating top-left over globe */
    #mobile-filter-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
      position: absolute;
      top: 0.5rem;
      left: 0.5rem;
      z-index: 50;
      pointer-events: all;
    }
    .mob-filter-btn {
      font-family: 'DM Mono', monospace;
      font-size: 0.48rem;
      padding: 3px 7px;
      border-radius: 4px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(7,7,15,0.75);
      color: rgba(232,232,240,0.6);
      cursor: pointer;
      letter-spacing: 0.05em;
      backdrop-filter: blur(4px);
    }
    .mob-filter-btn.active { color: #fff; }
    .mob-filter-btn.all.active  { background: rgba(255,255,255,0.15); border-color: rgba(255,255,255,0.4); }
    .mob-filter-btn.f1.active   { background: rgba(230,0,0,0.25);     border-color: rgba(230,0,0,0.7);   color:#ff6060; }
    .mob-filter-btn.f2.active   { background: rgba(0,180,255,0.2);    border-color: rgba(0,180,255,0.7); color:#00b4ff; }
    .mob-filter-btn.f3.active   { background: rgba(0,220,120,0.2);    border-color: rgba(0,220,120,0.7); color:#00dc78; }
    .mob-filter-btn.f1a.active  { background: rgba(255,150,0,0.2);    border-color: rgba(255,150,0,0.7); color:#ff9600; }
    .mob-filter-btn.fe.active   { background: rgba(140,0,255,0.2);    border-color: rgba(140,0,255,0.7); color:#bb80ff; }
    .mob-filter-btn.indy.active { background: rgba(255,200,0,0.2);    border-color: rgba(255,200,0,0.7); color:#ffe040; }
.mob-filter-btn.wec.active  { background: rgba(0,200,180,0.2);    border-color: rgba(0,200,180,0.7); color:#00e8cc; }
.mob-filter-btn.wrc.active  { background: rgba(255,80,40,0.2);    border-color: rgba(255,80,40,0.7);  color:#ff6644; }

    /* Hide desktop tooltip on mobile ‚Äî session panel replaces it */
    #tooltip { display: none !important; }

    /* Session panel ‚Äî bottom sheet, 50% height, sits above ad + tabs */
    /* mobile-ad = 50px, mobile-tabs ~56px ‚Üí bottom = 106px */
    #session-panel {
      position: fixed !important;
      left: 0; right: 0;
      bottom: calc(106px + env(safe-area-inset-bottom, 0px)); /* above ad + tabs + safe area */
      width: 100% !important;
      height: 0;
      max-height: 33vh;
      flex-direction: column;
      border-left: none;
      border-top: 1px solid var(--border);
      border-radius: 12px 12px 0 0;
      transition: height 0.3s ease !important;
      z-index: 180;        /* below tab bar z-index */
    }
    #session-panel.open {
      width: 100% !important;
      height: 33vh;
    }
    .sp-inner { width: 100%; }

    /* Sidebar ‚Äî hidden on mobile (including the wrap + toggle button) */
    .sidebar { display: none; }
    #sidebar-wrap { display: none; }

    /* Header ‚Äî no horizontal scroll on mobile, just clip */
    header { overflow-x: hidden; }

    /* Mobile tab bar */
    #mobile-tabs {
      position: fixed;
      bottom: 0;
      left: 0; right: 0;
      display: flex;
      flex-shrink: 0;
      background: var(--surface);
      border-top: 1px solid var(--border);
      z-index: 200;
      padding-bottom: env(safe-area-inset-bottom, 0px);
    }

    /* Mobile ad banner */
    #mobile-ad {
      position: fixed;
      bottom: calc(56px + env(safe-area-inset-bottom, 0px));
      left: 0; right: 0;
      display: flex;
      flex-shrink: 0;
      height: 50px;
      background: var(--bg);
      border-top: 1px solid var(--border);
      z-index: 200;
    }
    #mobile-ad .ad-placeholder {
      flex: 1; height: 100%;
      border-radius: 0; border: none;
      font-size: 0.5rem;
    }

    /* Race list overlay */
    #mobile-race-list {
      position: fixed;
      left: 0; right: 0;
      bottom: calc(106px + env(safe-area-inset-bottom, 0px));
      background: var(--surface);
      z-index: 150;
      flex-direction: column;
      overflow: hidden;
      display: none;
    }
    #mobile-race-list.visible { display: flex; }

    /* Full-screen news overlay for mobile news tab */
    #mobile-news {
      position: fixed;
      left: 0; right: 0;
      bottom: calc(106px + env(safe-area-inset-bottom, 0px));
      background: var(--surface);
      z-index: 150;
      flex-direction: column;
      overflow: hidden;
      display: none;
    }
    #mobile-news.visible { display: flex; }
    #mobile-news .news-item { padding: 0.9rem 1rem; }
    #mobile-news #news-list-mobile {
      flex: 1;
      overflow-y: auto;
      padding: 0.4rem 0;
    }
    #mobile-news #news-list-mobile::-webkit-scrollbar { width: 3px; }
    #mobile-news #news-list-mobile::-webkit-scrollbar-thumb { background: var(--border); }
    #mobile-news .mob-news-header {
      padding: 0.7rem 1rem;
      font-size: 0.55rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--muted);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-shrink: 0;
    }

    /* Mobile news filter buttons */
    .mob-news-filter {
      font-family: 'DM Mono', monospace;
      font-size: 0.55rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      padding: 4px 10px;
      border-radius: 3px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--muted);
      cursor: pointer;
      transition: all 0.15s;
    }
    .mob-news-filter.active {
      background: var(--accent);
      color: #000;
      border-color: var(--accent);
    }

    /* Globe centering ‚Äî pad bottom by session panel height when open */
    #globe-container { transition: padding-bottom 0.3s ease; }
    #session-panel.open ~ * { /* handled by JS nudging camera */ }

    /* Hide FE and IndyCar header blocks on mobile */
    .hdr-fe-indy { display: none; }
  }

  /* Desktop only ‚Äî hide mobile-only elements */
  @media (min-width: 701px) {
    #mobile-tabs     { display: none; }
    #mobile-ad       { display: none; }
    #mobile-race-list { display: none; }
    #mobile-news     { display: none; }
  }

  .mob-tab {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2px;
    padding: 0.5rem 0.3rem;
    background: none;
    border: none;
    cursor: pointer;
    color: var(--muted);
    font-family: 'DM Mono', monospace;
    font-size: 0.45rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    transition: color 0.15s, background 0.15s;
  }
  .mob-tab:active { background: var(--surface2); }
  .mob-tab.active { color: var(--accent); }
  /* ‚îÄ‚îÄ TABLET / iPad ‚îÄ‚îÄ */
  @media (min-width: 701px) and (max-width: 1024px) {
    /* Header ‚Äî compact for tablet */
    header { padding: 0.45rem 0.9rem; gap: 0.6rem; }
    h1 { font-size: 1.05rem; }
    .next-race-name { font-size: 0.75rem; }
    .next-race-location { font-size: 0.46rem; }
    .next-race-label { font-size: 0.42rem; }
    .header-countdown-value { font-size: 0.9rem; }
    .header-countdown-label { font-size: 0.42rem; }
    .hint { display: none; }

    /* Sidebar narrower */
    .sidebar { width: 210px; }
    #session-panel.open { width: 210px; }
    .sp-inner { width: 210px; }
    .sp-scroll { padding: 0.8rem 1rem; }
    .sp-name { font-size: 1.05rem; }

    /* Hide skyscraper ‚Äî not enough room on tablet */
    .ad-skyscraper { display: none; }

    /* News */
    #news-toggle { font-size: 0.52rem; height: 30px; }
    .ticker-item { font-size: 0.7rem; }
    .news-headline { font-size: 0.78rem; }
    .news-summary  { font-size: 0.65rem; }
    #news-filter-bar { padding: 0.4rem 0.8rem; gap: 0.35rem; }
    .news-filter-btn { font-size: 0.48rem; padding: 2px 8px; }
  }

  /* ‚îÄ‚îÄ Sidebar collapse toggle (desktop) ‚îÄ‚îÄ */
  #sidebar-collapse-btn {
    position: absolute;
    top: 50%;
    left: -20px;
    transform: translateY(-50%);
    width: 40px; height: 40px;
    border-radius: 50%;
    background: var(--surface2);
    border: 1px solid rgba(255,255,255,0.15);
    color: var(--text);
    font-size: 0.85rem;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    z-index: 200;
    transition: background 0.15s, color 0.15s, left 0.3s;
    flex-shrink: 0;
    box-shadow: 0 2px 10px rgba(0,0,0,0.5);
  }
  #sidebar-collapse-btn:hover { background: var(--accent); color: #000; border-color: var(--accent); }
  .sidebar.collapsed #sidebar-collapse-btn { left: -20px; }
  .sidebar { overflow: visible; }
  .sidebar.collapsed { width: 0 !important; }

  /* Pre-init: on mobile hide all header cards except F1 until JS rotation starts */
  @media (max-width: 700px) {
    header.hdr-init .hdr-race-block:not(#hdr-f1-block),
    header.hdr-init .header-countdown:not(.hdr-f1-countdown-static),
    header.hdr-init .header-divider:not(#hdr-h1-div),
    header.hdr-init .hdr-sub { display: none !important; }
  }
  @media (min-width: 701px) {
    #mobile-filter-bar { display: none; }
  }

  /* Tour play button */
  #tour-play-btn {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    z-index: 50;
    width: 2.4rem;
    height: 2.4rem;
    border-radius: 50%;
    border: 1px solid rgba(255,255,255,0.15);
    background: rgba(7,7,15,0.75);
    color: rgba(232,232,240,0.6);
    font-size: 0.9rem;
    cursor: pointer;
    backdrop-filter: blur(4px);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: border-color 0.2s, color 0.2s;
    padding-left: 2px; /* optical centre for ‚ñ∂ */
  }
  @media (max-width: 700px) {
    #tour-play-btn {
      bottom: auto;
      top: 0.5rem;
      right: 0.5rem;
    }
  }
  #tour-play-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
  }
  #tour-play-btn.tour-running {
    border-color: rgba(255,80,80,0.5);
    color: rgba(255,80,80,0.8);
  }
  #tour-play-btn.tour-running:hover {
    border-color: #ff5050;
    color: #ff5050;
  }

  /* INFO PANEL */
  #info-overlay {
    display: none;
    position: fixed;
    inset: 0;
    z-index: 1000;
    background: rgba(0,0,0,0.75);
    backdrop-filter: blur(6px);
    align-items: center;
    justify-content: center;
  }
  #info-overlay.open { display: flex; }
  #info-panel {
    position: relative;
    width: 70%;
    height: 70%;
    background: #0d0d1a;
    border: 1px solid rgba(200,255,0,0.18);
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    box-shadow: 0 0 80px rgba(200,255,0,0.05), 0 24px 80px rgba(0,0,0,0.7);
  }
  #info-panel-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1.2rem 1.6rem 0;
    flex-shrink: 0;
  }
  #info-panel-title {
    font-family: 'DM Mono', monospace;
    font-size: 0.6rem;
    letter-spacing: 0.2em;
    color: var(--accent);
    text-transform: uppercase;
    opacity: 0.7;
  }
  #info-close {
    background: none;
    border: 1px solid rgba(255,255,255,0.1);
    color: rgba(255,255,255,0.4);
    font-size: 0.85rem;
    width: 1.8rem;
    height: 1.8rem;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: border-color 0.2s, color 0.2s;
    font-family: 'DM Mono', monospace;
    line-height: 1;
  }
  #info-close:hover { border-color: var(--accent); color: var(--accent); }
  #info-tabs {
    display: flex;
    padding: 1rem 1.6rem 0;
    border-bottom: 1px solid rgba(255,255,255,0.07);
    flex-shrink: 0;
    gap: 0;
  }
  .info-tab {
    font-family: 'DM Mono', monospace;
    font-size: 0.55rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    padding: 0.5rem 1.1rem;
    background: none;
    border: none;
    border-bottom: 2px solid transparent;
    color: rgba(232,232,240,0.35);
    cursor: pointer;
    transition: color 0.2s, border-color 0.2s;
    margin-bottom: -1px;
  }
  .info-tab:hover { color: rgba(232,232,240,0.7); }
  .info-tab.active { color: var(--accent); border-bottom-color: var(--accent); }
  #info-content {
    flex: 1;
    overflow-y: auto;
    padding: 1.8rem 2rem;
    scrollbar-width: thin;
    scrollbar-color: rgba(200,255,0,0.2) transparent;
  }
  .info-pane { display: none; }
  .info-pane.active { display: block; }
  .info-pane h2 {
    font-family: 'DM Mono', monospace;
    font-size: 1rem;
    font-weight: 400;
    color: #e8e8f0;
    margin-bottom: 1rem;
    letter-spacing: 0.05em;
  }
  .info-pane h2 em { color: var(--accent); font-style: normal; }
  .info-pane h3 {
    font-family: 'DM Mono', monospace;
    font-size: 0.55rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--accent);
    opacity: 0.7;
    margin: 1.4rem 0 0.5rem;
  }
  .info-pane p {
    font-size: 0.65rem;
    line-height: 1.8;
    color: rgba(232,232,240,0.65);
    margin-bottom: 0.8rem;
  }
  .info-pane ul { list-style: none; margin-bottom: 0.8rem; }
  .info-pane ul li {
    font-size: 0.65rem;
    line-height: 1.8;
    color: rgba(232,232,240,0.65);
    padding-left: 1rem;
    position: relative;
  }
  .info-pane ul li::before { content: '¬∑'; position: absolute; left: 0; color: var(--accent); opacity: 0.6; }
  .info-contact-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.8rem; margin-top: 0.5rem; }
  .info-contact-card {
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: 8px;
    padding: 0.8rem 1rem;
    background: rgba(255,255,255,0.02);
  }
  .info-contact-card .label { font-size: 0.45rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--accent); opacity: 0.55; margin-bottom: 0.25rem; font-family: 'DM Mono', monospace; }
  .info-contact-card .value { font-size: 0.62rem; color: rgba(232,232,240,0.7); font-family: 'DM Mono', monospace; }
  .info-divider { height: 1px; background: rgba(255,255,255,0.06); margin: 1.2rem 0; }
  @media (max-width: 700px) {
    #info-panel { width: 92%; height: 85%; }
    #info-content { padding: 1.2rem; }
    .info-contact-grid { grid-template-columns: 1fr; }
    #info-tabs { padding: 0.8rem 1rem 0; }
    .info-tab { padding: 0.4rem 0.7rem; font-size: 0.5rem; }
  }

  /* Info button ‚Äî sits after hint, vertically centred by flexbox */
  #info-btn {
    flex-shrink: 0;
    background: none;
    border: 1px solid rgba(255,255,255,0.15);
    color: rgba(232,232,240,0.45);
    font-size: 1rem;
    width: 1.8rem;
    height: 1.8rem;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: border-color 0.2s, color 0.2s;
    z-index: 200;
    line-height: 1;
    font-family: serif;
  }
  #info-btn:hover { border-color: var(--accent); color: var(--accent); }
  @media (max-width: 700px) {
    #info-btn { font-size: 0.9rem; width: 1.6rem; height: 1.6rem; }
  }

  /* Language switcher */
  #lang-btn {
    flex-shrink: 0;
    background: none;
    border: 1px solid rgba(255,255,255,0.15);
    color: rgba(232,232,240,0.55);
    font-family: 'DM Mono', monospace;
    font-size: 0.5rem;
    letter-spacing: 0.08em;
    padding: 0 0.5rem;
    height: 1.8rem;
    border-radius: 4px;
    cursor: pointer;
    transition: border-color 0.2s, color 0.2s;
    position: relative;
  }
  #lang-btn:hover { border-color: var(--accent); color: var(--accent); }
  #lang-menu {
    display: none;
    position: fixed;
    top: auto;
    right: auto;
    background: #0d0d1a;
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 6px;
    overflow: hidden;
    z-index: 9999;
    min-width: 130px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
  }
  #lang-menu.open { display: block; }
  .lang-opt {
    display: block;
    width: 100%;
    padding: 0.5rem 0.9rem;
    background: none;
    border: none;
    color: rgba(232,232,240,0.55);
    font-family: 'DM Mono', monospace;
    font-size: 0.55rem;
    letter-spacing: 0.05em;
    cursor: pointer;
    text-align: left;
    transition: background 0.15s, color 0.15s;
  }
  .lang-opt:hover { background: rgba(255,255,255,0.05); color: #e8e8f0; }
  .lang-opt.active { color: var(--accent); }
  /* Position wrapper relatively so dropdown anchors correctly */
  #lang-wrap { position: relative; flex-shrink: 0; margin-left: auto; }
  @media (max-width: 700px) {
    #lang-btn { font-size: 0.45rem; height: 1.6rem; }
  }

  /* Bilingual terms */
  .terms-en-shadow {
    font-size: 0.52rem;
    color: rgba(232,232,240,0.35);
    font-style: italic;
    margin-top: 0.25rem;
    padding-left: 0.75rem;
    border-left: 1px solid rgba(255,255,255,0.08);
  }
  .terms-section { margin-bottom: 0.75rem; }
  #terms-bilingual-note {
    font-size: 0.55rem;
    color: rgba(200,255,0,0.7);
  }

  /* ‚îÄ‚îÄ Series Preferences Pane ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  .series-pref-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.8rem;
    margin-top: 1rem;
  }
  @media (max-width: 500px) { .series-pref-grid { grid-template-columns: 1fr; } }
  .series-toggle {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.7rem 1rem;
    border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.08);
    background: rgba(255,255,255,0.03);
    cursor: pointer;
    user-select: none;
    transition: background 0.15s, border-color 0.15s;
  }
  .series-toggle:hover { background: rgba(255,255,255,0.06); }
  .series-toggle.enabled { border-color: var(--series-col, rgba(200,255,0,0.3)); background: rgba(var(--series-col-rgb,200,255,0),0.06); }
  .series-toggle-dot {
    width: 10px; height: 10px; border-radius: 50%;
    background: var(--series-col, #888);
    flex-shrink: 0;
    box-shadow: 0 0 6px var(--series-col, #888);
    opacity: 0.4;
    transition: opacity 0.15s;
  }
  .series-toggle.enabled .series-toggle-dot { opacity: 1; }
  .series-toggle-name {
    flex: 1;
    font-family: 'DM Mono', monospace;
    font-size: 0.58rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: rgba(232,232,240,0.6);
    transition: color 0.15s;
  }
  .series-toggle.enabled .series-toggle-name { color: #e8e8f0; }
  .series-toggle-check {
    width: 18px; height: 18px; border-radius: 4px;
    border: 1px solid rgba(255,255,255,0.2);
    background: rgba(255,255,255,0.04);
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
    transition: background 0.15s, border-color 0.15s;
    font-size: 0.65rem;
  }
  .series-toggle.enabled .series-toggle-check {
    background: var(--series-col, #c8ff00);
    border-color: var(--series-col, #c8ff00);
    color: #000;
  }
  .series-pref-note {
    margin-top: 1.2rem;
    font-size: 0.52rem;
    color: var(--muted);
    letter-spacing: 0.05em;
    line-height: 1.6;
  }
  #series-reset-btn {
    margin-top: 1rem;
    padding: 0.4rem 1rem;
    font-family: 'DM Mono', monospace;
    font-size: 0.5rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    background: none;
    border: 1px solid rgba(255,255,255,0.15);
    color: var(--muted);
    border-radius: 6px;
    cursor: pointer;
    transition: border-color 0.15s, color 0.15s;
  }
  #series-reset-btn:hover { border-color: var(--accent); color: var(--accent); }

</style>
</head>
<body>

<header class="hdr-init">
  <div>
    <h1>Grid<em>Pulse</em></h1>
  </div>
  <div class="header-divider" id="hdr-h1-div"></div>

  <!-- F1 next race -->
  <div class="hdr-race-block" id="hdr-f1-block">
    <div class="next-race-label" id="hdr-f1-label" style="color:rgba(255,96,96,0.7)" data-i18n-prefix="next_f1">üèé Next F1</div>
    <div class="next-race-name" id="hdr-f1-name">‚Äî</div>
    <div class="next-race-location" id="hdr-f1-loc">‚Äî</div>
  </div>
  <div class="header-countdown">
    <div class="header-countdown-label" style="color:rgba(255,96,96,0.7)"><span data-i18n="starts_in">Starts in</span></div>
    <div class="header-countdown-value" id="hdr-f1-countdown" style="color:#ff6060">--:--:--</div>
  </div>

  <!-- F2 standalone next race (hidden when F2 supports next F1) -->
  <div class="header-divider hdr-sub" id="hdr-f2-div" style="display:none"></div>
  <div class="hdr-race-block hdr-sub" id="hdr-f2-block" style="display:none">
    <div class="next-race-label" style="color:rgba(255,160,50,0.8)" data-i18n-prefix="next_f2">üèé Next F2</div>
    <div class="next-race-name" id="hdr-f2-name">‚Äî</div>
    <div class="next-race-location" id="hdr-f2-loc">‚Äî</div>
  </div>
  <div class="header-countdown hdr-sub" id="hdr-f2-countdown-wrap" style="display:none">
    <div class="header-countdown-label" style="color:rgba(255,160,50,0.8)"><span data-i18n="starts_in">Starts in</span></div>
    <div class="header-countdown-value" id="hdr-f2-countdown" style="color:#ffa032">--:--:--</div>
  </div>

  <!-- F3 standalone next race (hidden when F3 supports next F1) -->
  <div class="header-divider hdr-sub" id="hdr-f3-div" style="display:none"></div>
  <div class="hdr-race-block hdr-sub" id="hdr-f3-block" style="display:none">
    <div class="next-race-label" style="color:rgba(50,200,255,0.8)" data-i18n-prefix="next_f3">üèé Next F3</div>
    <div class="next-race-name" id="hdr-f3-name">‚Äî</div>
    <div class="next-race-location" id="hdr-f3-loc">‚Äî</div>
  </div>
  <div class="header-countdown hdr-sub" id="hdr-f3-countdown-wrap" style="display:none">
    <div class="header-countdown-label" style="color:rgba(50,200,255,0.8)"><span data-i18n="starts_in">Starts in</span></div>
    <div class="header-countdown-value" id="hdr-f3-countdown" style="color:#32c8ff">--:--:--</div>
  </div>

  <!-- F1 Academy standalone next race (hidden when F1A supports next F1) -->
  <div class="header-divider hdr-sub" id="hdr-f1a-div" style="display:none"></div>
  <div class="hdr-race-block hdr-sub" id="hdr-f1a-block" style="display:none">
    <div class="next-race-label" style="color:rgba(255,100,200,0.8)" data-i18n-prefix="next_f1a">üèé Next F1 Academy</div>
    <div class="next-race-name" id="hdr-f1a-name">‚Äî</div>
    <div class="next-race-location" id="hdr-f1a-loc">‚Äî</div>
  </div>
  <div class="header-countdown hdr-sub" id="hdr-f1a-countdown-wrap" style="display:none">
    <div class="header-countdown-label" style="color:rgba(255,100,200,0.8)"><span data-i18n="starts_in">Starts in</span></div>
    <div class="header-countdown-value" id="hdr-f1a-countdown" style="color:#ff64c8">--:--:--</div>
  </div>

  <div class="header-divider" id="hdr-fe-pre-div" style="display:none"></div>

  <!-- Formula E next race -->
  <div class="hdr-race-block hdr-fe-indy" id="hdr-fe-block" style="display:none">
    <div class="next-race-label" style="color:rgba(187,128,255,0.7)" data-i18n-prefix="next_fe">‚ö° Next Formula E</div>
    <div class="next-race-name" id="hdr-fe-name">‚Äî</div>
    <div class="next-race-location" id="hdr-fe-loc">‚Äî</div>
  </div>
  <div class="header-countdown hdr-fe-indy" id="hdr-fe-countdown-wrap" style="display:none">
    <div class="header-countdown-label" style="color:rgba(187,128,255,0.7)"><span data-i18n="starts_in">Starts in</span></div>
    <div class="header-countdown-value" id="hdr-fe-countdown" style="color:#bb80ff">--:--:--</div>
  </div>

  <div class="header-divider hdr-fe-indy" id="hdr-indy-pre-div" style="display:none"></div>

  <!-- IndyCar next race -->
  <div class="hdr-race-block hdr-fe-indy" id="hdr-indy-block" style="display:none">
    <div class="next-race-label" style="color:rgba(255,224,64,0.7)" data-i18n-prefix="next_indy">üèÅ Next IndyCar</div>
    <div class="next-race-name" id="hdr-indy-name">‚Äî</div>
    <div class="next-race-location" id="hdr-indy-loc">‚Äî</div>
  </div>
  <div class="header-countdown hdr-fe-indy" id="hdr-indy-countdown-wrap" style="display:none">
    <div class="header-countdown-label" style="color:rgba(255,224,64,0.7)"><span data-i18n="starts_in">Starts in</span></div>
    <div class="header-countdown-value" id="hdr-indy-countdown" style="color:#ffe040">--:--:--</div>
  </div>

  <!-- WEC next race -->
  <div class="header-divider" id="hdr-wec-pre-div" style="display:none"></div>
  <div class="hdr-race-block" id="hdr-wec-block" style="display:none">
    <div class="next-race-label" style="color:rgba(0,232,204,0.7)" data-i18n-prefix="next_wec">üèÅ Next WEC</div>
    <div class="next-race-name" id="hdr-wec-name">‚Äî</div>
    <div class="next-race-location" id="hdr-wec-loc">‚Äî</div>
  </div>
  <div class="header-countdown" id="hdr-wec-countdown-wrap" style="display:none">
    <div class="header-countdown-label" style="color:rgba(0,232,204,0.7)"><span data-i18n="starts_in">Starts in</span></div>
    <div class="header-countdown-value" id="hdr-wec-countdown" style="color:#00e8cc">--:--:--</div>
  </div>

  <!-- WRC next round -->
  <div class="header-divider" id="hdr-wrc-pre-div" style="display:none"></div>
  <div class="hdr-race-block" id="hdr-wrc-block" style="display:none">
    <div class="next-race-label" style="color:rgba(255,102,68,0.7)" data-i18n-prefix="next_wrc">üèî Next WRC</div>
    <div class="next-race-name" id="hdr-wrc-name">‚Äî</div>
    <div class="next-race-location" id="hdr-wrc-loc">‚Äî</div>
  </div>
  <div class="header-countdown" id="hdr-wrc-countdown-wrap" style="display:none">
    <div class="header-countdown-label" style="color:rgba(255,102,68,0.7)"><span data-i18n="starts_in">Starts in</span></div>
    <div class="header-countdown-value" id="hdr-wrc-countdown" style="color:#ff6644">--:--:--</div>
  </div>

  <div class="header-divider hdr-fe-indy" id="hdr-hint-div"></div>
  <span class="hint" data-i18n="hint">Drag ¬∑ Scroll to zoom</span>
  <div id="lang-wrap">
    <button id="lang-btn">EN</button>
    <div id="lang-menu">
      <button class="lang-opt active" data-lang="en">üá¨üáß English</button>
      <button class="lang-opt" data-lang="fr">üá´üá∑ Fran√ßais</button>
      <button class="lang-opt" data-lang="es">üá™üá∏ Espa√±ol</button>
      <button class="lang-opt" data-lang="de">üá©üá™ Deutsch</button>
      <button class="lang-opt" data-lang="pl">üáµüá± Polski</button>
      <button class="lang-opt" data-lang="ja">üáØüáµ Êó•Êú¨Ë™û</button>
      <button class="lang-opt" data-lang="ko">üá∞üá∑ ÌïúÍµ≠Ïñ¥</button>
    </div>
  </div>
  <button id="info-btn" title="About GridPulse">&#x24D8;</button>

</header>

<!-- News toggle button ‚Äî always visible, contains ticker when closed -->
<div id="news-toggle">
  <span class="nt-dot"></span>
  <span class="nt-label" data-i18n="tab_news">News</span>
  <span class="nt-divider"></span>
  <!-- Filter buttons in ticker bar -->
  <div id="news-filter-bar">
    <span class="news-filter-btn active" data-filter="all" data-i18n="all">All</span>
    <span class="news-filter-btn" data-filter="f1">F1</span>
    <span class="news-filter-btn" data-filter="other" data-i18n="news_other">Other</span>
  </div>
  <span class="nt-divider"></span>
  <!-- Ticker scrolls when dropdown is closed -->
  <div id="news-ticker-wrap">
    <div id="news-ticker">
      <span id="news-loading-text" style="color:var(--muted);font-size:0.65rem;letter-spacing:0.05em">Loading news‚Ä¶</span>
    </div>
  </div>
  <span id="news-count" style="color:var(--muted);font-size:0.52rem;white-space:nowrap;flex-shrink:0"></span>
  <span class="nt-arrow">‚ñº</span>
</div>

<!-- News bar ‚Äî collapsible, shows top 3 stories -->
<div id="news-bar">
  <div id="news-list"></div>
</div>

<!-- AD SLOT 3 ‚Äî Below-header leaderboard (728√ó90) REMOVED -->

<div class="main">

  <!-- AD SLOT ‚Äî Skyscraper to the LEFT of globe (160√ó600) -->
  <div class="ad-skyscraper">
    <div class="ad-placeholder" style="flex:1;width:100%">
      üì¢ Ad<br>160√ó600<br>Skyscraper
    </div>
  </div>

  <div id="globe-container">

    <!-- Tour play button ‚Äî shown when tour is stopped -->
    <button id="tour-play-btn" title="Start tour"><span id="tour-btn-icon">&#9654;</span></button>

    <!-- Mobile filter bar ‚Äî floating top-left over globe -->
    <div id="mobile-filter-bar">
      <button class="mob-filter-btn all active" data-filter="all" data-i18n="all">All</button>
      <button class="mob-filter-btn f1"  data-filter="f1">F1</button>
      <button class="mob-filter-btn f2"  data-filter="f2">F2</button>
      <button class="mob-filter-btn f3"  data-filter="f3">F3</button>
      <button class="mob-filter-btn f1a" data-filter="f1a">F1A</button>
      <button class="mob-filter-btn fe"  data-filter="fe">FE</button>
      <button class="mob-filter-btn indy" data-filter="indy">Indy</button>
      <button class="mob-filter-btn wec"  data-filter="wec">WEC</button>
      <button class="mob-filter-btn wrc"  data-filter="wrc">WRC</button>
    </div>

    <!-- AD SLOT ‚Äî Above globe, centred (728√ó90) -->
    <div class="ad-above-globe">
      <div class="ad-placeholder" style="width:min(728px,100%);height:100%;border-radius:3px">
        üì¢ Ad ‚Äî 728√ó90 (Above Globe)
      </div>
    </div>

    <!-- Canvas wrapper ‚Äî fills remaining space, canvas is absolute inside here -->
    <div id="canvas-wrapper">
      <div id="tooltip">
        <div class="tt-region" id="tt-region"></div>
        <div class="tt-city" id="tt-city"></div>
        <div class="tt-country" id="tt-country"></div>
        <div class="series-badges" id="tt-badges" style="margin-bottom:0.4rem;"></div>
        <div class="tt-time" id="tt-time"></div>
        <div class="tt-date" id="tt-date"></div>
        <div class="tt-meta">
          <span><span class="phase-dot" id="tt-phase-dot"></span><span id="tt-phase"></span></span>
          <span id="tt-offset"></span>
        </div>
      </div>
    </div>
  </div>

  <!-- Session panel ‚Äî flex sibling between globe and sidebar.
       width:0 when closed, 260px when open. Globe shrinks naturally. -->
  <div id="session-panel">
    <div class="sp-inner" id="sp-inner">
      <div class="sp-scroll" id="sp-scroll">
        <div style="position:relative; min-height:24px;">
          <button class="sp-close" id="sp-close" data-i18n-title="close">‚úï</button>
        </div>
        <div class="sp-round" id="sp-round"></div>
        <div class="sp-name" id="sp-name"></div>
        <div class="sp-venue" id="sp-venue"></div>
        <div class="sp-badges" id="sp-badges"></div>
        <div id="sp-sessions"></div>
        <div class="sp-countdown" id="sp-countdown">
          <div class="sp-countdown-label">üèÅ F1 Race starts in</div>
          <div class="sp-countdown-value" id="sp-countdown-value">‚Äî</div>
        </div>
        <div id="sp-ads"></div>
      </div>
    </div>
  </div>

  <div id="sidebar-wrap">
  <button id="sidebar-collapse-btn" title="Toggle race list">‚óÄ</button>
  <div class="sidebar">
    <div class="sidebar-header">
      <span data-i18n="calendar_title">2026 Calendar</span>
      <span id="sidebar-count" style="color:var(--accent)">0</span>
    </div>
    <div class="filter-bar" id="filter-bar">
      <button class="filter-btn all active" data-filter="all" data-i18n="all">All</button>
      <button class="filter-btn f1" data-filter="f1">F1</button>
      <button class="filter-btn f2" data-filter="f2">F2</button>
      <button class="filter-btn f3" data-filter="f3">F3</button>
      <button class="filter-btn f1a" data-filter="f1a">F1 Academy</button>
      <button class="filter-btn fe" data-filter="fe">Formula E</button>
      <button class="filter-btn indy" data-filter="indy">IndyCar</button>
      <button class="filter-btn wec"  data-filter="wec">WEC</button>
      <button class="filter-btn wrc"  data-filter="wrc">WRC</button>
    </div>
    <div class="city-list" id="city-list"></div>
  </div>
</div>

</div>

<!-- Mobile: horizontal ad banner above tabs -->
<div id="mobile-ad">
  <div class="ad-placeholder">üì¢ Ad ‚Äî 320√ó50 Mobile Banner</div>
</div>

<!-- Mobile: tab bar at bottom -->
<div id="mobile-tabs">
  <button class="mob-tab active" id="tab-globe" onclick="mobileTab('globe')">
    <span class="mob-tab-icon">üåç</span><span data-i18n="tab_globe">Globe</span>
  </button>
  <button class="mob-tab" id="tab-list" onclick="mobileTab('list')">
    <span class="mob-tab-icon">üìÖ</span><span data-i18n="tab_calendar">Calendar</span>
  </button>
  <button class="mob-tab" id="tab-news" onclick="mobileTab('news')">
    <span class="mob-tab-icon">üì∞</span><span data-i18n="tab_news">News</span>
  </button>
</div>

<!-- Mobile: full-screen news overlay (News tab) -->
<div id="mobile-news">
  <div class="mob-news-header">
    <span style="width:6px;height:6px;border-radius:50%;background:var(--accent);box-shadow:0 0 6px var(--accent);flex-shrink:0"></span>
    <span data-i18n="tab_news">News</span>
    <span id="mob-news-count" style="color:var(--accent);margin-left:0.2rem"></span>
  </div>
  <div id="mob-news-filters" style="display:flex;gap:0.4rem;padding:0.5rem 1rem;border-bottom:1px solid var(--border);flex-shrink:0;">
    <button class="mob-news-filter active" data-filter="all" data-i18n="all">All</button>
    <button class="mob-news-filter" data-filter="f1">F1</button>
    <button class="mob-news-filter" data-filter="other" data-i18n="news_other">Other</button>
  </div>
  <div id="news-list-mobile">
    <div class="news-loading">Loading news‚Ä¶</div>
  </div>
</div>

<!-- Mobile: full-screen race list overlay (Calendar tab) -->
<div id="mobile-race-list"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
window.onerror = function(msg, src, line, col, err) {
  // Ignore uninformative cross-origin errors from CDN scripts
  if (msg === 'Script error.' || msg === 'Script error') return true;
  document.body.style.background = '#1a0000';
  var d = document.createElement('div');
  d.style.cssText = 'position:fixed;top:20px;left:20px;right:20px;padding:20px;background:#300;color:#f88;font-family:monospace;font-size:13px;z-index:99999;border-radius:8px;white-space:pre-wrap;border:1px solid #f44';
  d.textContent = 'JS ERROR:\n' + msg + '\nLine: ' + line + '\nFile: ' + src + '\n\n' + (err && err.stack ? err.stack : '');
  document.body.appendChild(d);
  return true;
};
window.addEventListener('unhandledrejection', function(e) {
  window.onerror('Unhandled Promise: ' + e.reason, '', 0, 0, e.reason);
});

// ‚îÄ‚îÄ‚îÄ INTERNATIONALISATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const TRANSLATIONS = {
  en: {
    next_f1:        'üèé Next F1',
    next_f1a:       'üèé Next F1 Academy',
    next_fe:        '‚ö° Next Formula E',
    next_indy:      'üèÅ Next IndyCar',
    next_f2:        'üèé Next F2',
    next_f3:        'üèé Next F3',
    starts_in:      'Starts in',
    on_now:         'On now!',
    hint:           'Drag ¬∑ Scroll to zoom',
    calendar_title: '2026 Calendar',
    all:            'All',
    tab_globe:      'Globe',
    tab_calendar:   'Calendar',
    tab_news:       'News',
    info_about:     'About',
    info_contact:   'Contact',
    info_terms:     'Terms of Use',
    close:          'Close',
    start_tour:     'Start tour',
    stop_tour:      'Stop tour',
    round:          'Round',
    race_starts:    'üèé F1 Race starts in',
    eprix_starts:   '‚ö° E-Prix starts in',
    indy_starts:    'üèé IndyCar Race starts in',
    race_done_f1:   'üèÅ F1 Race',
    race_done_fe:   '‚ö° E-Prix',
    race_done_indy: 'üèÅ IndyCar Race',
    race_completed: 'Race completed',
    news_loading:   'Loading latest motorsport news‚Ä¶',
    news_unavailable: '‚ö† News unavailable ‚Äî try disabling your ad blocker',
    news_error:     '‚ö† Could not load news feeds.',
    ad_block_note:  'Ad blockers can prevent RSS proxy requests.',
    no_stories:     'No stories in this category.',
    stories:        'stories',
    // Session labels
    s_fp1: 'Practice 1', s_fp2: 'Practice 2', s_fp3: 'Practice 3',
    s_sq: 'Sprint Quali', s_sprint: 'Sprint Race', s_quali: 'Qualifying', s_race: 'F1 Race',
    s_fe_race: 'E-Prix', s_fe_race2: 'E-Prix 2', s_fe_quali: 'Qualifying', s_fe_fp: 'Free Practice',
    s_indy_race: 'Race', s_indy_race2: 'Race 2', s_indy_quali: 'Qualifying', s_indy_fp: 'Practice',
    s_f2_fp: 'Free Practice', s_f2_quali: 'Qualifying', s_f2_sprint: 'Sprint Race', s_f2_feature: 'Feature Race',
    s_f3_fp: 'Practice', s_f3_quali: 'Qualifying', s_f3_sprint: 'Sprint Race', s_f3_feature: 'Feature Race',
    s_f1a_quali: 'Qualifying', s_f1a_r1: 'Race 1', s_f1a_r2: 'Race 2',
    news_loading_ticker: 'Loading news\u2026',
    info_h_covered: "What is covered",
    info_li_f1: "Formula 1 ‚Äî full season calendar with practice, qualifying and race sessions",
    info_li_f2f3: "Formula 2 & Formula 3 ‚Äî sprint and feature race sessions",
    info_li_f1a: "F1 Academy ‚Äî the all-female development series",
    info_li_fe: "Formula E ‚Äî electric street racing E-Prix calendar",
    info_li_indy: "IndyCar ‚Äî oval and road course championship calendar",
    info_h_how: "How to use it",
    info_how_1: "Drag the globe to rotate, scroll or pinch to zoom",
    info_how_2: "Click any race dot to open the full session schedule",
    info_how_3: "Use the series filter to focus on a single championship",
    info_how_4: "Press ‚ñ∂ to start the automatic race tour",
    info_how_5: "The header rotates through next-up races across all active series",
    info_h_data: "Data & updates",
    info_data_p: "Session times are sourced from official series calendars and displayed in your local time zone. News feeds are pulled live from Autosport and The Race.",
    info_disclaimer: "GridPulse is an independent fan project and is not affiliated with Formula One Management, Formula E Operations, IndyCar or any team or driver.",
    info_contact_intro: "Have a question, found a bug, or want to suggest a feature? We would love to hear from you.",
    info_contact_general: "General enquiries",
    info_email: "Email",
    info_response: "Response time",
    info_response_val: "2‚Äì3 business days",
    info_bugs: "Bug reports",
    info_feedback: "Feature requests",
    info_follow: "Follow us",
    terms_intro: "Last updated: January 2026. By accessing or using GridPulse you agree to these terms.",
    terms_h1: "1. Acceptance",
    terms_p1: "These terms govern your access to GridPulse. By using the Service you confirm you are at least 13 years old and agree to be bound by these terms. If you do not agree, please do not use the Service.",
    terms_h2: "2. Permitted use",
    terms_p2: "GridPulse is provided for personal, non-commercial use only. You may not reproduce, scrape, redistribute or commercially exploit any content, data or code from the Service without prior written permission.",
    terms_h3: "3. Accuracy of information",
    terms_p3: "While we strive to keep all session times and calendar data accurate, GridPulse does not guarantee the completeness or accuracy of information displayed. Always verify critical information with official series sources.",
    terms_h4: "4. Third-party content",
    terms_p4: "GridPulse aggregates news from third-party sources including Autosport and The Race. We are not responsible for the content of these external sources.",
    terms_h5: "5. Intellectual property",
    terms_p5: "All original content, design and code within GridPulse is the property of GridPulse and its creators. Series names, logos and trademarks referenced belong to their respective owners.",
    terms_h6: "6. Limitation of liability",
    terms_p6: "The Service is provided without warranties of any kind. To the fullest extent permitted by law, GridPulse shall not be liable for any direct, indirect, incidental or consequential damages from your use.",
    terms_h7: "7. Changes to terms",
    terms_p7: "We may update these terms from time to time. Continued use of the Service following any changes constitutes acceptance of the revised terms.",
    terms_h8: "8. Governing law",
    terms_p8: "These terms are governed by the laws of England and Wales. Any disputes shall be subject to the exclusive jurisdiction of the courts of England and Wales.",
    info_intro1: "GridPulse is a live motorsport calendar and race tracker built for fans who want to follow the full racing season ‚Äî across every series, on a single globe.",
    info_intro2: "Spin the globe, explore circuits, and see exactly what is racing where and when. Every round is plotted on an interactive 3D map with real-time countdowns to the next session.",
    info_contact_h2: "Get in <em>Touch</em>",
    info_terms_h2: "Terms of <em>Use</em>",
    terms_bilingual_note: "‚ö† These terms are legally binding in English only. The translation below is provided for reference alongside the official English version.",
    next_wec: "üèÅ Next WEC",
    next_wrc: "üèî Next WRC",
    wec_starts: "üèÅ Race starts in",
    wrc_starts: "üèî Rally starts in",
    race_done_wec: "üèÅ WEC Race",
    race_done_wrc: "üèî WRC Rally",
    s_wec_race: "Race Start",
    s_wrc_ps: "Power Stage",
    s_wrc_day1: "Day 1",
    news_other: "Other",
    cd_d: "d",
    cd_h: "h",
    cd_m: "m",
    info_series: "Series",
    info_series_h: "Series Settings",
    info_series_desc: "Choose which racing series are shown on the globe, calendar, and header.",
    info_series_note: "Your selection is saved in your browser and restored on every visit.",
    info_series_reset: "Reset to all series",
    race_done_short: "Done",
    day_singular: "day",
    day_plural: "days",
  },
  fr: {
    next_f1:        'üèé Prochain F1',
    next_f1a:       'üèé Prochain F1 Academy',
    next_fe:        '‚ö° Prochain Formula E',
    next_indy:      'üèÅ Prochain IndyCar',
    next_f2:        'üèé Prochain F2',
    next_f3:        'üèé Prochain F3',
    starts_in:      'Commence dans',
    on_now:         'En cours !',
    hint:           'Glisser ¬∑ D√©filer pour zoomer',
    calendar_title: 'Calendrier 2026',
    all:            'Tout',
    tab_globe:      'Globe',
    tab_calendar:   'Calendrier',
    tab_news:       'Actualit√©s',
    info_about:     '√Ä propos',
    info_contact:   'Contact',
    info_terms:     "Conditions d'utilisation",
    close:          'Fermer',
    start_tour:     'D√©marrer le tour',
    stop_tour:      'Arr√™ter le tour',
    round:          'Manche',
    race_starts:    'üèé Course F1 dans',
    eprix_starts:   '‚ö° E-Prix dans',
    indy_starts:    'üèé Course IndyCar dans',
    race_done_f1:   'üèÅ Course F1',
    race_done_fe:   '‚ö° E-Prix',
    race_done_indy: 'üèÅ Course IndyCar',
    race_completed: 'Course termin√©e',
    news_loading:   'Chargement des derni√®res actualit√©s‚Ä¶',
    news_unavailable: '‚ö† Actualit√©s indisponibles ‚Äî d√©sactivez votre bloqueur de publicit√©s',
    news_error:     "‚ö† Impossible de charger les flux d'actualit√©s.",
    ad_block_note:  'Les bloqueurs de publicit√©s peuvent bloquer les requ√™tes.',
    no_stories:     'Aucun article dans cette cat√©gorie.',
    stories:        'articles',
    // Session labels
    s_fp1: 'Essais Libres 1', s_fp2: 'Essais Libres 2', s_fp3: 'Essais Libres 3',
    s_sq: 'Sprint Qualif.', s_sprint: 'Course Sprint', s_quali: 'Qualifications', s_race: 'Course F1',
    s_fe_race: 'E-Prix', s_fe_race2: 'E-Prix 2', s_fe_quali: 'Qualifications', s_fe_fp: 'Essais Libres',
    s_indy_race: 'Course', s_indy_race2: 'Course 2', s_indy_quali: 'Qualifications', s_indy_fp: 'Essais',
    s_f2_fp: 'Essais Libres', s_f2_quali: 'Qualifications', s_f2_sprint: 'Course Sprint', s_f2_feature: 'Course Principale',
    s_f3_fp: 'Essais', s_f3_quali: 'Qualifications', s_f3_sprint: 'Course Sprint', s_f3_feature: 'Course Principale',
    s_f1a_quali: 'Qualifications', s_f1a_r1: 'Course 1', s_f1a_r2: 'Course 2',
    news_loading_ticker: 'Chargement\u2026',
    info_h_covered: "Ce qui est couvert",
    info_li_f1: "Formule 1 ‚Äî calendrier complet avec essais, qualifications et course",
    info_li_f2f3: "Formule 2 & Formule 3 ‚Äî courses sprint et course principale",
    info_li_f1a: "F1 Academy ‚Äî la s√©rie de d√©veloppement f√©minine",
    info_li_fe: "Formula E ‚Äî calendrier des E-Prix de course √©lectrique en ville",
    info_li_indy: "IndyCar ‚Äî calendrier du championnat sur ovals et circuits routiers",
    info_h_how: "Comment l'utiliser",
    info_how_1: "Faire glisser le globe pour pivoter, d√©filer ou pincer pour zoomer",
    info_how_2: "Cliquer sur un point de course pour voir le programme complet",
    info_how_3: "Utiliser le filtre pour se concentrer sur un seul championnat",
    info_how_4: "Appuyer sur ‚ñ∂ pour lancer le tour automatique",
    info_how_5: "L'en-t√™te tourne entre les prochaines courses de toutes les s√©ries",
    info_h_data: "Donn√©es & mises √† jour",
    info_data_p: "Les horaires de session proviennent des calendriers officiels des s√©ries et sont affich√©s dans votre fuseau horaire local. Les flux d'actualit√©s sont charg√©s en direct depuis Autosport et The Race.",
    info_disclaimer: "GridPulse est un projet de fan ind√©pendant et n'est pas affili√© √† Formula One Management, Formula E Operations, IndyCar ou √† une √©curie ou un pilote.",
    info_contact_intro: "Une question, un bug ou une suggestion ? Nous serions ravis de vous entendre.",
    info_contact_general: "Renseignements g√©n√©raux",
    info_email: "E-mail",
    info_response: "D√©lai de r√©ponse",
    info_response_val: "2‚Äì3 jours ouvrables",
    info_bugs: "Signaler un bug",
    info_feedback: "Suggestions de fonctionnalit√©s",
    info_follow: "Suivez-nous",
    terms_intro: "Derni√®re mise √† jour : janvier 2026. En acc√©dant √† GridPulse, vous acceptez ces conditions.",
    terms_h1: "1. Acceptation",
    terms_p1: "Ces conditions r√©gissent votre acc√®s √† GridPulse. En utilisant le service, vous confirmez avoir au moins 13 ans.",
    terms_h2: "2. Utilisation autoris√©e",
    terms_p2: "GridPulse est fourni pour un usage personnel non commercial uniquement. Toute reproduction ou exploitation commerciale est interdite sans autorisation √©crite pr√©alable.",
    terms_h3: "3. Exactitude des informations",
    terms_p3: "Bien que nous nous efforcions de maintenir l'exactitude des donn√©es, GridPulse ne garantit pas l'exhaustivit√© des informations affich√©es.",
    terms_h4: "4. Contenu tiers",
    terms_p4: "GridPulse agr√®ge des actualit√©s de sources tierces. Nous ne sommes pas responsables du contenu de ces sources externes.",
    terms_h5: "5. Propri√©t√© intellectuelle",
    terms_p5: "Tout le contenu original, le design et le code de GridPulse appartiennent √† ses cr√©ateurs. Les noms et logos des s√©ries appartiennent √† leurs propri√©taires respectifs.",
    terms_h6: "6. Limitation de responsabilit√©",
    terms_p6: "Le service est fourni sans garantie. Dans toute la mesure permise par la loi, GridPulse ne saurait √™tre tenu responsable des dommages d√©coulant de votre utilisation.",
    terms_h7: "7. Modifications des conditions",
    terms_p7: "Nous pouvons mettre √† jour ces conditions √† tout moment. L'utilisation continue du service vaut acceptation des conditions r√©vis√©es.",
    terms_h8: "8. Droit applicable",
    terms_p8: "Ces conditions sont r√©gies par le droit d'Angleterre et du Pays de Galles.",
    info_intro1: "GridPulse est un calendrier de sport automobile en direct con√ßu pour les fans souhaitant suivre toute la saison de course ‚Äî sur toutes les s√©ries, sur un seul globe.",
    info_intro2: "Faites tourner le globe, explorez les circuits et voyez exactement o√π et quand se d√©roulent les courses. Chaque manche est repr√©sent√©e sur une carte 3D interactive avec des comptes √† rebours en temps r√©el.",
    info_contact_h2: "Nous <em>Contacter</em>",
    info_terms_h2: "Conditions <em>d'utilisation</em>",
    terms_bilingual_note: "‚ö† Ces conditions sont juridiquement contraignantes en anglais uniquement. La traduction ci-dessous est fournie √† titre indicatif, avec la version officielle anglaise.",
    next_wec: "üèÅ Prochain WEC",
    next_wrc: "üèî Prochain WRC",
    wec_starts: "üèÅ Course dans",
    wrc_starts: "üèî Rallye dans",
    race_done_wec: "üèÅ Course WEC",
    race_done_wrc: "üèî Rallye WRC",
    s_wec_race: "D√©part course",
    s_wrc_ps: "Power Stage",
    s_wrc_day1: "Jour 1",
    news_other: "Autre",
    cd_d: "j",
    cd_h: "h",
    cd_m: "m",
    info_series: "S√©ries",
    info_series_h: "Param√®tres des S√©ries",
    info_series_desc: "Choisissez les s√©ries √† afficher sur le globe, le calendrier et l'en-t√™te.",
    info_series_note: "Votre s√©lection est sauvegard√©e dans votre navigateur.",
    info_series_reset: "R√©initialiser toutes les s√©ries",
    race_done_short: "Termin√©",
    day_singular: "jour",
    day_plural: "jours",
  },
  es: {
    next_f1:        'üèé Pr√≥xima F1',
    next_f1a:       'üèé Pr√≥xima F1 Academy',
    next_fe:        '‚ö° Pr√≥xima Formula E',
    next_indy:      'üèÅ Pr√≥xima IndyCar',
    next_f2:        'üèé Pr√≥xima F2',
    next_f3:        'üèé Pr√≥xima F3',
    starts_in:      'Comienza en',
    on_now:         '¬°En curso!',
    hint:           'Arrastrar ¬∑ Desplazar para zoom',
    calendar_title: 'Calendario 2026',
    all:            'Todo',
    tab_globe:      'Globo',
    tab_calendar:   'Calendario',
    tab_news:       'Noticias',
    info_about:     'Acerca de',
    info_contact:   'Contacto',
    info_terms:     'T√©rminos de uso',
    close:          'Cerrar',
    start_tour:     'Iniciar tour',
    stop_tour:      'Detener tour',
    round:          'Ronda',
    race_starts:    'üèé Carrera F1 en',
    eprix_starts:   '‚ö° E-Prix en',
    indy_starts:    'üèé Carrera IndyCar en',
    race_done_f1:   'üèÅ Carrera F1',
    race_done_fe:   '‚ö° E-Prix',
    race_done_indy: 'üèÅ Carrera IndyCar',
    race_completed: 'Carrera finalizada',
    news_loading:   'Cargando √∫ltimas noticias‚Ä¶',
    news_unavailable: '‚ö† Noticias no disponibles ‚Äî desactiva tu bloqueador de anuncios',
    news_error:     '‚ö† No se pudieron cargar los feeds de noticias.',
    ad_block_note:  'Los bloqueadores de anuncios pueden impedir las solicitudes.',
    no_stories:     'No hay art√≠culos en esta categor√≠a.',
    stories:        'art√≠culos',
    s_fp1: 'Pr√°ctica 1', s_fp2: 'Pr√°ctica 2', s_fp3: 'Pr√°ctica 3',
    s_sq: 'Clasif. Sprint', s_sprint: 'Carrera Sprint', s_quali: 'Clasificaci√≥n', s_race: 'Carrera F1',
    s_fe_race: 'E-Prix', s_fe_race2: 'E-Prix 2', s_fe_quali: 'Clasificaci√≥n', s_fe_fp: 'Pr√°ctica Libre',
    s_indy_race: 'Carrera', s_indy_race2: 'Carrera 2', s_indy_quali: 'Clasificaci√≥n', s_indy_fp: 'Pr√°ctica',
    s_f2_fp: 'Pr√°ctica Libre', s_f2_quali: 'Clasificaci√≥n', s_f2_sprint: 'Carrera Sprint', s_f2_feature: 'Carrera Principal',
    s_f3_fp: 'Pr√°ctica', s_f3_quali: 'Clasificaci√≥n', s_f3_sprint: 'Carrera Sprint', s_f3_feature: 'Carrera Principal',
    s_f1a_quali: 'Clasificaci√≥n', s_f1a_r1: 'Carrera 1', s_f1a_r2: 'Carrera 2',
    news_loading_ticker: 'Cargando‚Ä¶',
    info_h_covered: 'Qu√© se cubre',
    info_li_f1: 'F√≥rmula 1 ‚Äî calendario completo con pr√°cticas, clasificaci√≥n y carrera',
    info_li_f2f3: 'F√≥rmula 2 y F√≥rmula 3 ‚Äî carreras sprint y carrera principal',
    info_li_f1a: 'F1 Academy ‚Äî la serie de desarrollo femenina',
    info_li_fe: 'Formula E ‚Äî calendario de E-Prix en circuitos urbanos el√©ctricos',
    info_li_indy: 'IndyCar ‚Äî calendario del campeonato en ovacos y circuitos',
    info_h_how: 'C√≥mo usarlo',
    info_how_1: 'Arrastra el globo para girarlo, despl√°zate o pellizca para hacer zoom',
    info_how_2: 'Haz clic en cualquier punto de carrera para ver el programa completo',
    info_how_3: 'Usa el filtro de series para centrarte en un solo campeonato',
    info_how_4: 'Pulsa ‚ñ∂ para iniciar el tour autom√°tico',
    info_how_5: 'La cabecera rota entre las pr√≥ximas carreras de todas las series activas',
    info_h_data: 'Datos y actualizaciones',
    info_data_p: 'Los horarios de sesi√≥n provienen de los calendarios oficiales y se muestran en tu zona horaria local.',
    info_disclaimer: 'GridPulse es un proyecto de fan independiente y no est√° afiliado a Formula One Management, Formula E Operations, IndyCar ni a ning√∫n equipo o piloto.',
    info_contact_intro: '¬øTienes una pregunta, encontraste un error o quieres sugerir una funci√≥n?',
    info_contact_general: 'Consultas generales',
    info_email: 'Correo electr√≥nico', info_response: 'Tiempo de respuesta', info_response_val: '2‚Äì3 d√≠as h√°biles',
    info_bugs: 'Informar de errores', info_feedback: 'Solicitudes de funciones', info_follow: 'S√≠guenos',
    terms_intro: '√öltima actualizaci√≥n: enero de 2026. Al acceder a GridPulse, aceptas estos t√©rminos.',
    terms_h1: '1. Aceptaci√≥n', terms_p1: 'Estos t√©rminos rigen tu acceso a GridPulse. Al usar el servicio confirmas que tienes al menos 13 a√±os.',
    terms_h2: '2. Uso permitido', terms_p2: 'GridPulse se proporciona solo para uso personal no comercial.',
    terms_h3: '3. Exactitud', terms_p3: 'GridPulse no garantiza la integridad de la informaci√≥n mostrada.',
    terms_h4: '4. Contenido de terceros', terms_p4: 'No somos responsables del contenido de fuentes externas.',
    terms_h5: '5. Propiedad intelectual', terms_p5: 'Todo el contenido original de GridPulse pertenece a sus creadores.',
    terms_h6: '6. Limitaci√≥n de responsabilidad', terms_p6: 'En la medida permitida por la ley, GridPulse no ser√° responsable de los da√±os.',
    terms_h7: '7. Cambios en los t√©rminos', terms_p7: 'Podemos actualizar estos t√©rminos en cualquier momento.',
    terms_h8: '8. Legislaci√≥n aplicable', terms_p8: 'Estos t√©rminos se rigen por las leyes de Inglaterra y Gales.',
    info_intro1: "GridPulse es un calendario de motor en directo dise√±ado para los aficionados que quieren seguir toda la temporada ‚Äî en todas las series, en un solo globo.",
    info_intro2: "Gira el globo, explora los circuitos y ve exactamente d√≥nde y cu√°ndo se corre. Cada ronda est√° representada en un mapa 3D interactivo con cuenta regresiva en tiempo real.",
    info_contact_h2: "<em>Cont√°ctanos</em>",
    info_terms_h2: "T√©rminos de <em>Uso</em>",
    terms_p8: "Estos t√©rminos se rigen por las leyes de Inglaterra y Gales.",
    terms_bilingual_note: "‚ö† Estos t√©rminos son legalmente vinculantes solo en ingl√©s. La traducci√≥n se proporciona como referencia junto con la versi√≥n oficial en ingl√©s.",
    info_feedback: "Solicitudes de funciones",
    info_follow: "S√≠guenos",
    info_response: "Tiempo de respuesta",
    info_response_val: "2‚Äì3 d√≠as h√°biles",
    terms_p1: "Estos t√©rminos rigen tu acceso a GridPulse. Al usar el servicio confirmas que tienes al menos 13 a√±os.",
    terms_p2: "GridPulse se proporciona solo para uso personal no comercial. No puedes reproducir ni explotar comercialmente ning√∫n contenido sin permiso previo por escrito.",
    terms_p3: "Aunque nos esforzamos por mantener la exactitud, GridPulse no garantiza la integridad de la informaci√≥n mostrada.",
    terms_p4: "GridPulse agrega noticias de fuentes de terceros. No somos responsables del contenido de esas fuentes externas.",
    terms_p5: "Todo el contenido original, dise√±o y c√≥digo de GridPulse pertenece a sus creadores. Los nombres y logos de las series pertenecen a sus due√±os respectivos.",
    terms_p6: "El servicio se presta sin garant√≠as. En la medida permitida por la ley, GridPulse no ser√° responsable de los da√±os derivados del uso del servicio.",
    terms_p7: "Podemos actualizar estos t√©rminos en cualquier momento. El uso continuado del servicio implica la aceptaci√≥n de los t√©rminos revisados.",
    next_wec: "üèÅ Pr√≥ximo WEC",
    next_wrc: "üèî Pr√≥ximo WRC",
    wec_starts: "üèÅ Carrera en",
    wrc_starts: "üèî Rally en",
    race_done_wec: "üèÅ Carrera WEC",
    race_done_wrc: "üèî Rally WRC",
    s_wec_race: "Salida",
    s_wrc_ps: "Power Stage",
    s_wrc_day1: "D√≠a 1",
    news_other: "Otros",
    cd_d: "d",
    cd_h: "h",
    cd_m: "m",
    info_series: "Series",
    info_series_h: "Configuraci√≥n de Series",
    info_series_desc: "Elige qu√© series se muestran en el globo, el calendario y el encabezado.",
    info_series_note: "Tu selecci√≥n se guarda en tu navegador y se restaura en cada visita.",
    info_series_reset: "Restablecer todas las series",
    race_done_short: "Listo",
    day_singular: "d√≠a",
    day_plural: "d√≠as",
  },
    // Session labels
    s_fp1: 'Pr\u00e1ctica 1', s_fp2: 'Pr\u00e1ctica 2', s_fp3: 'Pr\u00e1ctica 3',
    s_sq: 'Clasif. Sprint', s_sprint: 'Carrera Sprint', s_quali: 'Clasificaci\u00f3n', s_race: 'Carrera F1',
    s_fe_race: 'E-Prix', s_fe_race2: 'E-Prix 2', s_fe_quali: 'Clasificaci\u00f3n', s_fe_fp: 'Pr\u00e1ctica Libre',
    s_indy_race: 'Carrera', s_indy_race2: 'Carrera 2', s_indy_quali: 'Clasificaci\u00f3n', s_indy_fp: 'Pr\u00e1ctica',
    s_f2_fp: 'Pr\u00e1ctica Libre', s_f2_quali: 'Clasificaci\u00f3n', s_f2_sprint: 'Carrera Sprint', s_f2_feature: 'Carrera Principal',
    s_f3_fp: 'Pr\u00e1ctica', s_f3_quali: 'Clasificaci\u00f3n', s_f3_sprint: 'Carrera Sprint', s_f3_feature: 'Carrera Principal',
    s_f1a_quali: 'Clasificaci\u00f3n', s_f1a_r1: 'Carrera 1', s_f1a_r2: 'Carrera 2',
    news_loading_ticker: 'Cargando\u2026',
    info_h_covered: "Qu√© se cubre",
    info_li_f1: "F√≥rmula 1 ‚Äî calendario completo con pr√°cticas, clasificaci√≥n y carrera",
    info_li_f2f3: "F√≥rmula 2 y F√≥rmula 3 ‚Äî carreras sprint y carrera principal",
    info_li_f1a: "F1 Academy ‚Äî la serie de desarrollo femenina",
    info_li_fe: "Formula E ‚Äî calendario de E-Prix en circuitos urbanos el√©ctricos",
    info_li_indy: "IndyCar ‚Äî calendario del campeonato en ovacos y circuitos",
    info_h_how: "C√≥mo usarlo",
    info_how_1: "Arrastra el globo para girarlo, despl√°zate o pellizca para hacer zoom",
    info_how_2: "Haz clic en cualquier punto de carrera para ver el programa completo",
    info_how_3: "Usa el filtro de series para centrarte en un solo campeonato",
    info_how_4: "Pulsa ‚ñ∂ para iniciar el tour autom√°tico",
    info_how_5: "La cabecera rota entre las pr√≥ximas carreras de todas las series activas",
    info_h_data: "Datos y actualizaciones",
    info_data_p: "Los horarios de sesi√≥n provienen de los calendarios oficiales de las series y se muestran en tu zona horaria local. Las noticias se cargan en directo desde Autosport y The Race.",
    info_disclaimer: "GridPulse es un proyecto de fan independiente y no est√° afiliado a Formula One Management, Formula E Operations, IndyCar ni a ning√∫n equipo o piloto.",
    info_contact_intro: "¬øTienes una pregunta, encontraste un error o quieres sugerir una funci√≥n? Nos encantar√≠a saber de ti.",
    info_contact_general: "Consultas generales",
    info_email: "Correo electr√≥nico",
    info_response: "Tiempo de respuesta",
    info_response_val: "2‚Äì3 d√≠as h√°biles",
    info_bugs: "Informar de errores",
    info_feedback: "Solicitudes de funciones",
    info_follow: "S√≠guenos",
    terms_intro: "√öltima actualizaci√≥n: enero de 2026. Al acceder a GridPulse, aceptas estos t√©rminos.",
    terms_h1: "1. Aceptaci√≥n",
    terms_p1: "Estos t√©rminos rigen tu acceso a GridPulse. Al usar el servicio confirmas que tienes al menos 13 a√±os.",
    terms_h2: "2. Uso permitido",
    terms_p2: "GridPulse se proporciona solo para uso personal no comercial. No puedes reproducir ni explotar comercialmente ning√∫n contenido sin permiso previo por escrito.",
    terms_h3: "3. Exactitud de la informaci√≥n",
    terms_p3: "Aunque nos esforzamos por mantener la exactitud, GridPulse no garantiza la integridad de la informaci√≥n mostrada.",
    terms_h4: "4. Contenido de terceros",
    terms_p4: "GridPulse agrega noticias de fuentes de terceros. No somos responsables del contenido de esas fuentes externas.",
    terms_h5: "5. Propiedad intelectual",
    terms_p5: "Todo el contenido original, dise√±o y c√≥digo de GridPulse pertenece a sus creadores. Los nombres y logos de las series pertenecen a sus due√±os respectivos.",
    terms_h6: "6. Limitaci√≥n de responsabilidad",
    terms_p6: "El servicio se presta sin garant√≠as. En la medida permitida por la ley, GridPulse no ser√° responsable de los da√±os derivados del uso del servicio.",
    terms_h7: "7. Cambios en los t√©rminos",
    terms_p7: "Podemos actualizar estos t√©rminos en cualquier momento. El uso continuado del servicio implica la aceptaci√≥n de los t√©rminos revisados.",
    terms_h8: "8. Legislaci√≥n aplicable",
    terms_p8: "Estos t√©rminos se rigen por las leyes de Inglaterra y Gales.",
  de: {
    next_f1:        'üèé N√§chste F1',
    next_f1a:       'üèé N√§chste F1 Academy',
    next_fe:        '‚ö° N√§chste Formula E',
    next_indy:      'üèÅ N√§chste IndyCar',
    next_f2:        'üèé N√§chste F2',
    next_f3:        'üèé N√§chste F3',
    starts_in:      'Beginnt in',
    on_now:         'L√§uft jetzt!',
    hint:           'Ziehen ¬∑ Scrollen zum Zoomen',
    calendar_title: 'Kalender 2026',
    all:            'Alle',
    tab_globe:      'Globus',
    tab_calendar:   'Kalender',
    tab_news:       'Nachrichten',
    info_about:     '√úber uns',
    info_contact:   'Kontakt',
    info_terms:     'Nutzungsbedingungen',
    close:          'Schlie√üen',
    start_tour:     'Tour starten',
    stop_tour:      'Tour stoppen',
    round:          'Runde',
    race_starts:    'üèé F1-Rennen beginnt in',
    eprix_starts:   '‚ö° E-Prix beginnt in',
    indy_starts:    'üèé IndyCar-Rennen beginnt in',
    race_done_f1:   'üèÅ F1-Rennen',
    race_done_fe:   '‚ö° E-Prix',
    race_done_indy: 'üèÅ IndyCar-Rennen',
    race_completed: 'Rennen beendet',
    news_loading:   'Neueste Nachrichten werden geladen‚Ä¶',
    news_unavailable: '‚ö† Nachrichten nicht verf√ºgbar ‚Äî deaktiviere deinen Werbeblocker',
    news_error:     '‚ö† Nachrichten-Feeds konnten nicht geladen werden.',
    ad_block_note:  'Werbeblocker k√∂nnen Anfragen blockieren.',
    no_stories:     'Keine Artikel in dieser Kategorie.',
    stories:        'Artikel',
    // Session labels
    s_fp1: 'Training 1', s_fp2: 'Training 2', s_fp3: 'Training 3',
    s_sq: 'Sprint-Quali.', s_sprint: 'Sprint-Rennen', s_quali: 'Qualifikation', s_race: 'F1-Rennen',
    s_fe_race: 'E-Prix', s_fe_race2: 'E-Prix 2', s_fe_quali: 'Qualifikation', s_fe_fp: 'Freies Training',
    s_indy_race: 'Rennen', s_indy_race2: 'Rennen 2', s_indy_quali: 'Qualifikation', s_indy_fp: 'Training',
    s_f2_fp: 'Freies Training', s_f2_quali: 'Qualifikation', s_f2_sprint: 'Sprint-Rennen', s_f2_feature: 'Hauptrennen',
    s_f3_fp: 'Training', s_f3_quali: 'Qualifikation', s_f3_sprint: 'Sprint-Rennen', s_f3_feature: 'Hauptrennen',
    s_f1a_quali: 'Qualifikation', s_f1a_r1: 'Rennen 1', s_f1a_r2: 'Rennen 2',
    news_loading_ticker: 'Wird geladen\u2026',
    info_h_covered: "Was abgedeckt wird",
    info_li_f1: "Formel 1 ‚Äî vollst√§ndiger Saisonkalender mit Training, Qualifying und Rennen",
    info_li_f2f3: "Formel 2 & Formel 3 ‚Äî Sprint- und Hauptrennen",
    info_li_f1a: "F1 Academy ‚Äî die rein weibliche Nachwuchsserie",
    info_li_fe: "Formula E ‚Äî E-Prix-Kalender des Elektro-Stra√üenrennens",
    info_li_indy: "IndyCar ‚Äî Meisterschaftskalender auf Ovalen und Stra√üenkursen",
    info_h_how: "So wird es verwendet",
    info_how_1: "Globus ziehen zum Drehen, scrollen oder zusammenkneifen zum Zoomen",
    info_how_2: "Auf einen Renndot klicken, um den vollst√§ndigen Sitzungsplan zu √∂ffnen",
    info_how_3: "Serienfilter verwenden, um sich auf eine Meisterschaft zu konzentrieren",
    info_how_4: "Dr√ºcken Sie ‚ñ∂, um die automatische Tour zu starten",
    info_how_5: "Die Kopfzeile rotiert durch die n√§chsten Rennen aller aktiven Serien",
    info_h_data: "Daten & Aktualisierungen",
    info_data_p: "Sitzungszeiten stammen aus offiziellen Serienkalendern und werden in Ihrer lokalen Zeitzone angezeigt. Nachrichtenfeeds werden live von Autosport und The Race geladen.",
    info_disclaimer: "GridPulse ist ein unabh√§ngiges Fan-Projekt und ist nicht mit Formula One Management, Formula E Operations, IndyCar oder einem Team oder Fahrer verbunden.",
    info_contact_intro: "Haben Sie eine Frage, einen Fehler gefunden oder m√∂chten Sie eine Funktion vorschlagen? Wir freuen uns von Ihnen zu h√∂ren.",
    info_contact_general: "Allgemeine Anfragen",
    info_email: "E-Mail",
    info_response: "Antwortzeit",
    info_response_val: "2‚Äì3 Werktage",
    info_bugs: "Fehler melden",
    info_feedback: "Funktionswunsche",
    info_follow: "Folgen Sie uns",
    terms_intro: "Zuletzt aktualisiert: Januar 2026. Durch den Zugriff auf GridPulse stimmen Sie diesen Bedingungen zu.",
    terms_h1: "1. Annahme",
    terms_p1: "Diese Bedingungen regeln Ihren Zugang zu GridPulse. Durch die Nutzung des Dienstes best√§tigen Sie, mindestens 13 Jahre alt zu sein.",
    terms_h2: "2. Erlaubte Nutzung",
    terms_p2: "GridPulse wird nur f√ºr den pers√∂nlichen, nicht kommerziellen Gebrauch bereitgestellt. Jede Reproduktion oder kommerzielle Nutzung ist ohne schriftliche Genehmigung untersagt.",
    terms_h3: "3. Genauigkeit der Informationen",
    terms_p3: "Obwohl wir uns bem√ºhen, die Genauigkeit der Daten zu gew√§hrleisten, gibt GridPulse keine Garantie f√ºr die Vollst√§ndigkeit der angezeigten Informationen.",
    terms_h4: "4. Inhalte Dritter",
    terms_p4: "GridPulse aggregiert Nachrichten aus Drittquellen. Wir sind nicht verantwortlich f√ºr den Inhalt dieser externen Quellen.",
    terms_h5: "5. Geistiges Eigentum",
    terms_p5: "Alle Original-Inhalte, das Design und der Code von GridPulse geh√∂ren seinen Erstellern. Seriennamen und Logos geh√∂ren ihren jeweiligen Eigent√ºmern.",
    terms_h6: "6. Haftungsbeschr√§nkung",
    terms_p6: "Der Dienst wird ohne Gew√§hrleistung bereitgestellt. Soweit gesetzlich zul√§ssig haftet GridPulse nicht f√ºr Sch√§den aus der Nutzung des Dienstes.",
    terms_h7: "7. √Ñnderungen der Bedingungen",
    terms_p7: "Wir k√∂nnen diese Bedingungen jederzeit aktualisieren. Die weitere Nutzung des Dienstes gilt als Zustimmung zu den ge√§nderten Bedingungen.",
    terms_h8: "8. Anwendbares Recht",
    terms_p8: "Diese Bedingungen unterliegen dem Recht von England und Wales.",
    info_intro1: "GridPulse ist ein Live-Motorsportkalender f√ºr Fans, die die gesamte Rennsaison ‚Äî √ºber alle Serien hinweg ‚Äî auf einem einzigen Globus verfolgen m√∂chten.",
    info_intro2: "Drehen Sie den Globus, erkunden Sie Rennstrecken und sehen Sie genau, wo und wann gefahren wird. Jede Runde ist auf einer interaktiven 3D-Karte mit Echtzeit-Countdowns dargestellt.",
    info_contact_h2: "<em>Kontakt</em> aufnehmen",
    info_terms_h2: "Nutzungs<em>bedingungen</em>",
    terms_bilingual_note: "‚ö† Diese Bedingungen sind rechtlich bindend nur auf Englisch. Die √úbersetzung wird als Referenz neben der offiziellen englischen Version bereitgestellt.",
    next_wec: "üèÅ N√§chstes WEC",
    next_wrc: "üèî N√§chste WRC",
    wec_starts: "üèÅ Rennen in",
    wrc_starts: "üèî Rallye in",
    race_done_wec: "üèÅ WEC-Rennen",
    race_done_wrc: "üèî WRC-Rallye",
    s_wec_race: "Rennstart",
    s_wrc_ps: "Power Stage",
    s_wrc_day1: "Tag 1",
    news_other: "Andere",
    cd_d: "T",
    cd_h: "Std",
    cd_m: "Min",
    info_series: "Serien",
    info_series_h: "Serien-Einstellungen",
    info_series_desc: "W√§hle, welche Rennserien auf dem Globus, Kalender und Header angezeigt werden.",
    info_series_note: "Deine Auswahl wird im Browser gespeichert und bei jedem Besuch wiederhergestellt.",
    info_series_reset: "Alle Serien zur√ºcksetzen",
    race_done_short: "Fertig",
    day_singular: "Tag",
    day_plural: "Tage",
  },

  pl: {
    next_f1: "üèé Nastƒôpne F1",
    next_f1a: "üèé Nastƒôpne F1 Academy",
    next_fe: "‚ö° Nastƒôpna Formula E",
    next_indy: "üèÅ Nastƒôpny IndyCar",
    next_f2: "üèé Nastƒôpne F2",
    next_f3: "üèé Nastƒôpne F3",
    starts_in: "Zaczyna siƒô za",
    on_now: "Trwa teraz!",
    hint: "PrzeciƒÖgnij ¬∑ Przewi≈Ñ, aby przybli≈ºyƒá",
    calendar_title: "Kalendarz 2026",
    all: "Wszystkie",
    tab_globe: "Globus",
    tab_calendar: "Kalendarz",
    tab_news: "Aktualno≈õci",
    info_about: "O nas",
    info_contact: "Kontakt",
    info_terms: "Warunki u≈ºytkowania",
    close: "Zamknij",
    start_tour: "Rozpocznij tour",
    stop_tour: "Zatrzymaj tour",
    round: "Runda",
    race_starts: "üèé Wy≈õcig F1 zaczyna siƒô za",
    eprix_starts: "‚ö° E-Prix zaczyna siƒô za",
    indy_starts: "üèé Wy≈õcig IndyCar zaczyna siƒô za",
    race_done_f1: "üèÅ Wy≈õcig F1",
    race_done_fe: "‚ö° E-Prix",
    race_done_indy: "üèÅ Wy≈õcig IndyCar",
    race_completed: "Wy≈õcig zako≈Ñczony",
    news_loading: "≈Åadowanie najnowszych wiadomo≈õci‚Ä¶",
    news_unavailable: "‚ö† Wiadomo≈õci niedostƒôpne ‚Äî wy≈ÇƒÖcz blokadƒô reklam",
    news_error: "‚ö† Nie mo≈ºna za≈Çadowaƒá kana≈Ç√≥w wiadomo≈õci.",
    ad_block_note: "Blokery reklam mogƒÖ uniemo≈ºliwiaƒá ≈ºƒÖdania.",
    no_stories: "Brak artyku≈Ç√≥w w tej kategorii.",
    stories: "artyku≈Ç√≥w",
    s_fp1: "Trening 1",
    s_fp2: "Trening 2",
    s_fp3: "Trening 3",
    s_sq: "Kwalifikacje sprintowe",
    s_sprint: "Sprint",
    s_quali: "Kwalifikacje",
    s_race: "Wy≈õcig F1",
    s_fe_race: "E-Prix",
    s_fe_race2: "E-Prix 2",
    s_fe_quali: "Kwalifikacje",
    s_fe_fp: "Trening wolny",
    s_indy_race: "Wy≈õcig",
    s_indy_race2: "Wy≈õcig 2",
    s_indy_quali: "Kwalifikacje",
    s_indy_fp: "Trening",
    s_f2_fp: "Trening wolny",
    s_f2_quali: "Kwalifikacje",
    s_f2_sprint: "Sprint",
    s_f2_feature: "Wy≈õcig g≈Ç√≥wny",
    s_f3_fp: "Trening",
    s_f3_quali: "Kwalifikacje",
    s_f3_sprint: "Sprint",
    s_f3_feature: "Wy≈õcig g≈Ç√≥wny",
    s_f1a_quali: "Kwalifikacje",
    s_f1a_r1: "Wy≈õcig 1",
    s_f1a_r2: "Wy≈õcig 2",
    news_loading_ticker: "≈Åadowanie‚Ä¶",
    info_intro1: "GridPulse to ≈ºywy kalendarz motorsportowy dla fan√≥w, kt√≥rzy chcƒÖ ≈úledziƒá ca≈Çy sezon wy≈õcigowy ‚Äî we wszystkich seriach na jednym globusie.",
    info_intro2: "Obr√≥ƒá globusem, eksploruj tory i see exactly where and when racing takes place. Ka≈ºda runda jest na interaktywnej mapie 3D z odliczaniem czasu.",
    info_contact_h2: "Skontaktuj <em>siƒô</em>",
    info_terms_h2: "Warunki <em>U≈ºytkowania</em>",
    info_h_covered: "Co jest uwzglƒôdnione",
    info_li_f1: "Formu≈Ça 1 ‚Äî pe≈Çny kalendarz sezonu z treningami, kwalifikacjami i wy≈õcigiem",
    info_li_f2f3: "Formu≈Ça 2 i Formu≈Ça 3 ‚Äî sprinty i wy≈õcigi g≈Ç√≥wne",
    info_li_f1a: "F1 Academy ‚Äî seria rozwoju dla kobiet",
    info_li_fe: "Formula E ‚Äî kalendarz E-Prix elektrycznych wy≈õcig√≥w ulicznych",
    info_li_indy: "IndyCar ‚Äî kalendarz mistrzostwa na owalach i torach drogowych",
    info_h_how: "Jak u≈ºywaƒá",
    info_how_1: "PrzeciƒÖgnij globus, aby go obr√≥ciƒá; przewi≈Ñ lub zsumuj, aby przybli≈ºyƒá",
    info_how_2: "Kliknij dowolny punkt wy≈õcigu, aby otworzyƒá pe≈Çny rozk≈Çad sesji",
    info_how_3: "U≈ºyj filtra serii, aby skupiƒá siƒô na jednym mistrzostwa",
    info_how_4: "Naci≈õnij ‚ñ∂, aby uruchomiƒá automatyczny tour",
    info_how_5: "Nag≈Ç√≥wek rotuje miƒôdzy nastƒôpnymi wy≈õcigami wszystkich aktywnych serii",
    info_h_data: "Dane i aktualizacje",
    info_data_p: "Godziny sesji pochodzƒÖ z oficjalnych kalendarzy serii i sƒÖ wy≈õwietlane w lokalnej strefie czasowej. Kana≈Çy wiadomo≈õci sƒÖ ≈Çadowane na ≈ºywo z Autosport i The Race.",
    info_disclaimer: "GridPulse to niezale≈ºny projekt fan√≥w i nie jest powiƒÖzany z Formula One Management, Formula E Operations, IndyCar ani ≈ºadnƒÖ ekipƒÖ lub kierowcƒÖ.",
    info_contact_intro: "Masz pytanie, znalaz≈Çe≈õ b≈ÇƒÖd lub chcesz zaproponowaƒá funkcjƒô? Chƒôtnie siƒô skontaktujemy.",
    info_contact_general: "Og√≥lne zapytania",
    info_email: "E-mail",
    info_response: "Czas odpowiedzi",
    info_response_val: "2‚Äì3 dni robocze",
    info_bugs: "Zg≈Çoszenia b≈Çƒôd√≥w",
    info_feedback: "Pro≈õby o funkcje",
    info_follow: "Obserwuj nas",
    terms_intro: "Ostatnia aktualizacja: stycze≈Ñ 2026. KorzystajƒÖc z GridPulse, akceptujesz niniejsze warunki.",
    terms_h1: "1. Akceptacja",
    terms_p1: "Niniejsze warunki regulujƒÖ dostƒôp do GridPulse. KorzystajƒÖc z us≈Çugi, potwierdzasz, ≈ºe masz co najmniej 13 lat.",
    terms_h2: "2. Dozwolone u≈ºytkowanie",
    terms_p2: "GridPulse jest udostƒôpniany wy≈ÇƒÖcznie do u≈ºytku osobistego, niekomercyjnego.",
    terms_h3: "3. Dok≈Çadno≈õƒá informacji",
    terms_p3: "GridPulse nie gwarantuje kompletno≈õci wy≈õwietlanych informacji.",
    terms_h4: "4. Tre≈õci stron trzecich",
    terms_p4: "GridPulse agreguje wiadomo≈õci ze ≈∫r√≥de≈Ç zewnƒôtrznych. Nie ponosimy odpowiedzialno≈õci za tre≈õci tych ≈∫r√≥de≈Ç.",
    terms_h5: "5. W≈Çasno≈õƒá intelektualna",
    terms_p5: "Wszelkie oryginalne tre≈õci, projekt i kod GridPulse nale≈ºƒÖ do jego tw√≥rc√≥w.",
    terms_h6: "6. Ograniczenie odpowiedzialno≈õci",
    terms_p6: "GridPulse nie ponosi odpowiedzialno≈õci za szkody wynikajƒÖce z korzystania z us≈Çugi.",
    terms_h7: "7. Zmiany warunk√≥w",
    terms_p7: "Mo≈ºemy aktualizowaƒá niniejsze warunki w dowolnym momencie.",
    terms_h8: "8. Prawo w≈Ça≈õciwe",
    terms_p8: "Niniejsze warunki podlegajƒÖ prawu Anglii i Walii.",
    terms_bilingual_note: "‚ö† Niniejsze warunki sƒÖ prawnie wiƒÖ≈ºƒÖce tylko w jƒôzyku angielskim. T≈Çumaczenie poni≈ºej jest udostƒôpnione w celach informacyjnych wraz z oficjalnƒÖ wersjƒÖ angielskƒÖ.",
    next_wec: "üèÅ Nastƒôpne WEC",
    next_wrc: "üèî Nastƒôpne WRC",
    wec_starts: "üèÅ Wy≈õcig za",
    wrc_starts: "üèî Rajd za",
    race_done_wec: "üèÅ Wy≈õcig WEC",
    race_done_wrc: "üèî Rajd WRC",
    s_wec_race: "Start wy≈õcigu",
    s_wrc_ps: "Power Stage",
    s_wrc_day1: "Dzie≈Ñ 1",
    news_other: "Inne",
    cd_d: "d",
    cd_h: "g",
    cd_m: "min",
    info_series: "Serie",
    info_series_h: "Ustawienia Serii",
    info_series_desc: "Wybierz, kt√≥re serie wy≈õcigowe sƒÖ wy≈õwietlane na globusie, kalendarzu i nag≈Ç√≥wku.",
    info_series_note: "Tw√≥j wyb√≥r jest zapisany w przeglƒÖdarce i przywracany przy ka≈ºdej wizycie.",
    info_series_reset: "Resetuj do wszystkich serii",
    race_done_short: "Koniec",
    day_singular: "dzie≈Ñ",
    day_plural: "dni",
  },
  ja: {
    next_f1: "üèé Ê¨°„ÅÆF1",
    next_f1a: "üèé Ê¨°„ÅÆF1„Ç¢„Ç´„Éá„Éü„Éº",
    next_fe: "‚ö° Ê¨°„ÅÆ„Éï„Ç©„Éº„Éü„É•„É©E",
    next_indy: "üèÅ Ê¨°„ÅÆ„Ç§„É≥„Éá„Ç£„Ç´„Éº",
    next_f2: "üèé Ê¨°„ÅÆF2",
    next_f3: "üèé Ê¨°„ÅÆF3",
    starts_in: "ÈñãÂßã„Åæ„Åß",
    on_now: "ÈñãÂÇ¨‰∏≠ÔºÅ",
    hint: "„Éâ„É©„ÉÉ„Ç∞„ÅßÂõûËª¢„Éª„Çπ„ÇØ„É≠„Éº„É´„Åß„Ç∫„Éº„É†",
    calendar_title: "2026Âπ¥„Ç´„É¨„É≥„ÉÄ„Éº",
    all: "„Åô„Åπ„Å¶",
    tab_globe: "„Ç∞„É≠„Éº„Éñ",
    tab_calendar: "„Ç´„É¨„É≥„ÉÄ„Éº",
    tab_news: "„Éã„É•„Éº„Çπ",
    info_about: "Ê¶ÇË¶Å",
    info_contact: "„ÅäÂïè„ÅÑÂêà„Çè„Åõ",
    info_terms: "Âà©Áî®Ë¶èÁ¥Ñ",
    close: "Èñâ„Åò„Çã",
    start_tour: "„ÉÑ„Ç¢„ÉºÈñãÂßã",
    stop_tour: "„ÉÑ„Ç¢„ÉºÂÅúÊ≠¢",
    round: "„É©„Ç¶„É≥„Éâ",
    race_starts: "üèé F1„É¨„Éº„ÇπÈñãÂßã„Åæ„Åß",
    eprix_starts: "‚ö° E-PrixÈñãÂßã„Åæ„Åß",
    indy_starts: "üèé „Ç§„É≥„Éá„Ç£„Ç´„Éº„É¨„Éº„ÇπÈñãÂßã„Åæ„Åß",
    race_done_f1: "üèÅ F1„É¨„Éº„Çπ",
    race_done_fe: "‚ö° E-Prix",
    race_done_indy: "üèÅ „Ç§„É≥„Éá„Ç£„Ç´„Éº„É¨„Éº„Çπ",
    race_completed: "„É¨„Éº„ÇπÁµÇ‰∫Ü",
    news_loading: "ÊúÄÊñ∞„É¢„Éº„Çø„Éº„Çπ„Éù„Éº„ÉÑ„Éã„É•„Éº„Çπ„ÇíË™≠„ÅøËæº„Åø‰∏≠‚Ä¶",
    news_unavailable: "‚ö† „Éã„É•„Éº„ÇπÂà©Áî®‰∏çÂèØ ‚Äî Â∫ÉÂëä„Éñ„É≠„ÉÉ„Ç´„Éº„ÇíÁÑ°Âäπ„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ",
    news_error: "‚ö† „Éã„É•„Éº„Çπ„Éï„Ç£„Éº„Éâ„ÇíË™≠„ÅøËæº„ÇÅ„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ",
    ad_block_note: "Â∫ÉÂëä„Éñ„É≠„ÉÉ„Ç´„Éº„Åå„É™„ÇØ„Ç®„Çπ„Éà„ÇíÂ¶®„Åí„ÇãÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ",
    no_stories: "„Åì„ÅÆ„Ç´„ÉÜ„Ç¥„É™„Å´Ë®ò‰∫ã„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ",
    stories: "‰ª∂",
    s_fp1: "„Éï„É™„ÉºËµ∞Ë°å1",
    s_fp2: "„Éï„É™„ÉºËµ∞Ë°å2",
    s_fp3: "„Éï„É™„ÉºËµ∞Ë°å3",
    s_sq: "„Çπ„Éó„É™„É≥„Éà‰∫àÈÅ∏",
    s_sprint: "„Çπ„Éó„É™„É≥„Éà„É¨„Éº„Çπ",
    s_quali: "‰∫àÈÅ∏",
    s_race: "F1„É¨„Éº„Çπ",
    s_fe_race: "E-Prix",
    s_fe_race2: "E-Prix 2",
    s_fe_quali: "‰∫àÈÅ∏",
    s_fe_fp: "„Éï„É™„ÉºËµ∞Ë°å",
    s_indy_race: "„É¨„Éº„Çπ",
    s_indy_race2: "„É¨„Éº„Çπ2",
    s_indy_quali: "‰∫àÈÅ∏",
    s_indy_fp: "Á∑¥ÁøíËµ∞Ë°å",
    s_f2_fp: "„Éï„É™„ÉºËµ∞Ë°å",
    s_f2_quali: "‰∫àÈÅ∏",
    s_f2_sprint: "„Çπ„Éó„É™„É≥„Éà",
    s_f2_feature: "„Éï„Ç£„Éº„ÉÅ„É£„Éº„É¨„Éº„Çπ",
    s_f3_fp: "Á∑¥ÁøíËµ∞Ë°å",
    s_f3_quali: "‰∫àÈÅ∏",
    s_f3_sprint: "„Çπ„Éó„É™„É≥„Éà",
    s_f3_feature: "„Éï„Ç£„Éº„ÉÅ„É£„Éº„É¨„Éº„Çπ",
    s_f1a_quali: "‰∫àÈÅ∏",
    s_f1a_r1: "„É¨„Éº„Çπ1",
    s_f1a_r2: "„É¨„Éº„Çπ2",
    news_loading_ticker: "Ë™≠„ÅøËæº„Åø‰∏≠‚Ä¶",
    info_intro1: "GridPulse„ÅØ„ÄÅ„Åô„Åπ„Å¶„ÅÆ„Ç∑„É™„Éº„Ç∫„Çí‰∏Ä„Å§„ÅÆÂú∞ÁêÉÂÑÄ„ÅßËøΩ„Åà„Çã„Éï„Ç°„É≥Âêë„Åë„ÅÆ„É©„Ç§„Éñ„É¢„Éº„Çø„Éº„Çπ„Éù„Éº„ÉÑ„Ç´„É¨„É≥„ÉÄ„Éº„Åß„Åô„ÄÇ",
    info_intro2: "Âú∞ÁêÉÂÑÄ„ÇíÂõû„Åó„Å¶„Çµ„Éº„Ç≠„ÉÉ„Éà„ÇíÊé¢Á¥¢„Åó„ÄÅ„Å©„Åì„Åß„ÅÑ„Å§„É¨„Éº„Çπ„ÅåË°å„Çè„Çå„Çã„Åã„Çí„É™„Ç¢„É´„Çø„Ç§„É†„ÅßÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô„ÄÇ",
    info_contact_h2: "<em>„ÅäÂïè„ÅÑÂêà„Çè„Åõ</em>",
    info_terms_h2: "Âà©Áî®<em>Ë¶èÁ¥Ñ</em>",
    info_h_covered: "ÂØæÂøú„Ç∑„É™„Éº„Ç∫",
    info_li_f1: "„Éï„Ç©„Éº„Éü„É•„É©1 ‚Äî Á∑¥ÁøíËµ∞Ë°å„Éª‰∫àÈÅ∏„ÉªÊ±∫Âãù„ÇíÂê´„ÇÄÂÖ®„Ç∑„Éº„Ç∫„É≥„Ç´„É¨„É≥„ÉÄ„Éº",
    info_li_f2f3: "„Éï„Ç©„Éº„Éü„É•„É©2 & „Éï„Ç©„Éº„Éü„É•„É©3 ‚Äî „Çπ„Éó„É™„É≥„Éà„Å®„Éï„Ç£„Éº„ÉÅ„É£„Éº„É¨„Éº„Çπ",
    info_li_f1a: "F1„Ç¢„Ç´„Éá„Éü„Éº ‚Äî Â•≥ÊÄß„Éâ„É©„Ç§„Éê„ÉºËÇ≤Êàê„Ç∑„É™„Éº„Ç∫",
    info_li_fe: "„Éï„Ç©„Éº„Éü„É•„É©E ‚Äî ÈõªÊ∞óËá™ÂãïËªäÂ∏ÇË°óÂú∞„É¨„Éº„ÇπE-Prix„Ç´„É¨„É≥„ÉÄ„Éº",
    info_li_indy: "„Ç§„É≥„Éá„Ç£„Ç´„Éº ‚Äî „Ç™„Éº„Éê„É´„Å®„É≠„Éº„Éâ„Ç≥„Éº„Çπ„ÅÆ„ÉÅ„É£„É≥„Éî„Ç™„É≥„Ç∑„ÉÉ„Éó",
    info_h_how: "‰Ωø„ÅÑÊñπ",
    info_how_1: "Âú∞ÁêÉÂÑÄ„Çí„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶ÂõûËª¢„ÄÅ„Çπ„ÇØ„É≠„Éº„É´„Åæ„Åü„ÅØ„Éî„É≥„ÉÅ„Åß„Ç∫„Éº„É†",
    info_how_2: "„É¨„Éº„Çπ„ÅÆ„Éâ„ÉÉ„Éà„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Çª„ÉÉ„Ç∑„Éß„É≥„Çπ„Ç±„Ç∏„É•„Éº„É´„ÇíË°®Á§∫",
    info_how_3: "„Ç∑„É™„Éº„Ç∫„Éï„Ç£„É´„Çø„Éº„ÅßÁâπÂÆö„ÅÆ„ÉÅ„É£„É≥„Éî„Ç™„É≥„Ç∑„ÉÉ„Éó„Å´Áµû„ÇäËæº„ÇÄ",
    info_how_4: "‚ñ∂„ÇíÊäº„Åó„Å¶Ëá™Âãï„ÉÑ„Ç¢„Éº„ÇíÈñãÂßã",
    info_how_5: "„Éò„ÉÉ„ÉÄ„Éº„ÅØÂÖ®„Ç∑„É™„Éº„Ç∫„ÅÆÊ¨°„ÅÆ„É¨„Éº„Çπ„ÇíÈ†ÜÁï™„Å´Ë°®Á§∫",
    info_h_data: "„Éá„Éº„Çø„ÉªÊõ¥Êñ∞",
    info_data_p: "„Çª„ÉÉ„Ç∑„Éß„É≥ÊôÇÂàª„ÅØÂÖ¨Âºè„Ç´„É¨„É≥„ÉÄ„Éº„Åã„ÇâÂèñÂæó„Åó„ÄÅÁèæÂú∞ÊôÇÈñì„ÅßË°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇ„Éã„É•„Éº„Çπ„ÅØAutosport„Å®The Race„Åã„Çâ„É©„Ç§„ÉñÈÖç‰ø°„Åï„Çå„Åæ„Åô„ÄÇ",
    info_disclaimer: "GridPulse„ÅØÁã¨Á´ã„Åó„Åü„Éï„Ç°„É≥„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Åß„ÅÇ„Çä„ÄÅFormula One Management„Éª„Éï„Ç©„Éº„Éü„É•„É©E„Éª„Ç§„É≥„Éá„Ç£„Ç´„Éº„Éª„ÅÑ„Åã„Å™„Çã„ÉÅ„Éº„É†„ÇÑ„Éâ„É©„Ç§„Éê„Éº„Å®„ÇÇÁÑ°Èñ¢‰øÇ„Åß„Åô„ÄÇ",
    info_contact_intro: "„ÅîË≥™Âïè„ÄÅ„Éê„Ç∞Â†±Âëä„ÄÅÊ©üËÉΩÊèêÊ°à„ÅØ„ÅäÊ∞óËªΩ„Å´„Å©„ÅÜ„Åû„ÄÇ",
    info_contact_general: "‰∏ÄËà¨„ÅäÂïè„ÅÑÂêà„Çè„Åõ",
    info_email: "„É°„Éº„É´",
    info_response: "ËøîÁ≠îÊôÇÈñì",
    info_response_val: "2„Äú3Âñ∂Ê•≠Êó•",
    info_bugs: "„Éê„Ç∞Â†±Âëä",
    info_feedback: "Ê©üËÉΩ„É™„ÇØ„Ç®„Çπ„Éà",
    info_follow: "„Éï„Ç©„É≠„Éº",
    terms_intro: "ÊúÄÁµÇÊõ¥Êñ∞Ôºö2026Âπ¥1Êúà„ÄÇGridPulse„ÇíÂà©Áî®„Åô„Çã„Åì„Å®„Åß„ÄÅÊú¨Ë¶èÁ¥Ñ„Å´ÂêåÊÑè„Åó„Åü„ÇÇ„ÅÆ„Å®„Åø„Å™„Åó„Åæ„Åô„ÄÇ",
    terms_h1: "1. ÂêåÊÑè",
    terms_p1: "Êú¨Ë¶èÁ¥Ñ„ÅØGridPulse„ÅÆÂà©Áî®„ÇíË¶èÂÆö„Åó„Åæ„Åô„ÄÇ„Çµ„Éº„Éì„Çπ„ÇíÂà©Áî®„Åô„Çã„Åì„Å®„Å´„Çà„Çä„ÄÅ13Ê≠≥‰ª•‰∏ä„Åß„ÅÇ„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç„Åó„ÄÅÊú¨Ë¶èÁ¥Ñ„Å´ÊãòÊùü„Åï„Çå„Çã„Åì„Å®„Å´ÂêåÊÑè„Åó„Åæ„Åô„ÄÇ",
    terms_h2: "2. Ë®±ÂèØ„Åï„Çå„ÇãÂà©Áî®",
    terms_p2: "GridPulse„ÅØÂÄã‰∫∫„ÉªÈùûÂïÜÊ•≠ÁõÆÁöÑ„ÅÆ„Åø„Å´Êèê‰æõ„Åï„Çå„Åæ„Åô„ÄÇÊõ∏Èù¢„Å´„Çà„Çã‰∫ãÂâçË®±ÂèØ„Å™„Åè„ÄÅ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆË§áË£Ω„ÉªÂïÜÊ•≠Âà©Áî®„ÅØÁ¶ÅÊ≠¢„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
    terms_h3: "3. ÊÉÖÂ†±„ÅÆÊ≠£Á¢∫ÊÄß",
    terms_p3: "GridPulse„ÅØË°®Á§∫ÊÉÖÂ†±„ÅÆÂÆåÂÖ®ÊÄß„Çí‰øùË®º„Åó„Åæ„Åõ„Çì„ÄÇÈáçË¶Å„Å™ÊÉÖÂ†±„ÅØÂÖ¨Âºè„ÇΩ„Éº„Çπ„ÅßÂøÖ„ÅöÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
    terms_h4: "4. „Çµ„Éº„Éâ„Éë„Éº„ÉÜ„Ç£„Ç≥„É≥„ÉÜ„É≥„ÉÑ",
    terms_p4: "GridPulse„ÅØÂ§ñÈÉ®„ÇΩ„Éº„Çπ„ÅÆ„Éã„É•„Éº„Çπ„ÇíÈõÜÁ¥Ñ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇÂ§ñÈÉ®„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆË≤¨‰ªª„ÅØË≤†„ÅÑ„Åæ„Åõ„Çì„ÄÇ",
    terms_h5: "5. Áü•ÁöÑË≤°Áî£Ê®©",
    terms_p5: "GridPulse„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Éª„Éá„Ç∂„Ç§„É≥„Éª„Ç≥„Éº„Éâ„ÅØ„Åù„ÅÆÂà∂‰ΩúËÄÖ„Å´Â∏∞Â±û„Åó„Åæ„Åô„ÄÇÂêÑ„Ç∑„É™„Éº„Ç∫„ÅÆÂêçÁß∞„Éª„É≠„Ç¥„ÅØ„Åù„Çå„Åû„Çå„ÅÆÊâÄÊúâËÄÖ„Å´Â∏∞Â±û„Åó„Åæ„Åô„ÄÇ",
    terms_h6: "6. Ë≤¨‰ªª„ÅÆÂà∂Èôê",
    terms_p6: "Ê≥ïÂæã„ÅåË™ç„ÇÅ„ÇãÊúÄÂ§ßÈôê„ÅÆÁØÑÂõ≤„Åß„ÄÅGridPulse„ÅØ„Çµ„Éº„Éì„ÇπÂà©Áî®„Åã„ÇâÁîü„Åò„ÇãÊêçÂÆ≥„Å´„Å§„ÅÑ„Å¶Ë≤¨‰ªª„ÇíË≤†„ÅÑ„Åæ„Åõ„Çì„ÄÇ",
    terms_h7: "7. Ë¶èÁ¥Ñ„ÅÆÂ§âÊõ¥",
    terms_p7: "Êú¨Ë¶èÁ¥Ñ„ÅØ„ÅÑ„Å§„Åß„ÇÇÊõ¥Êñ∞„Åï„Çå„ÇãÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÁ∂ôÁ∂öÂà©Áî®„ÅØÂ§âÊõ¥Âæå„ÅÆË¶èÁ¥Ñ„Å∏„ÅÆÂêåÊÑè„Å®„Åø„Å™„Åó„Åæ„Åô„ÄÇ",
    terms_h8: "8. Ê∫ñÊã†Ê≥ï",
    terms_p8: "Êú¨Ë¶èÁ¥Ñ„ÅØ„Ç§„É≥„Ç∞„É©„É≥„Éâ„Åä„Çà„Å≥„Ç¶„Çß„Éº„É´„Ç∫„ÅÆÊ≥ïÂæã„Å´Ê∫ñÊã†„Åó„Åæ„Åô„ÄÇ",
    terms_bilingual_note: "‚ö† Êú¨Ë¶èÁ¥Ñ„ÅØËã±Ë™ûÁâà„ÅÆ„Åø„ÅåÊ≥ïÁöÑÂäπÂäõ„ÇíÊåÅ„Å°„Åæ„Åô„ÄÇ‰ª•‰∏ã„ÅÆÁøªË®≥„ÅØÂèÇËÄÉÁõÆÁöÑ„Åß„ÅÇ„Çä„ÄÅÂÖ¨ÂºèËã±Ë™ûÁâà„Å®‰ΩµË®ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
    next_wec: "üèÅ Ê¨°„ÅÆWEC",
    next_wrc: "üèî Ê¨°„ÅÆWRC",
    wec_starts: "üèÅ „É¨„Éº„ÇπÈñãÂßã„Åæ„Åß",
    wrc_starts: "üèî „É©„É™„ÉºÈñãÂßã„Åæ„Åß",
    race_done_wec: "üèÅ WEC„É¨„Éº„Çπ",
    race_done_wrc: "üèî WRC„É©„É™„Éº",
    s_wec_race: "„É¨„Éº„Çπ„Çπ„Çø„Éº„Éà",
    s_wrc_ps: "„Éë„ÉØ„Éº„Çπ„ÉÜ„Éº„Ç∏",
    s_wrc_day1: "„Éá„Ç§1",
    news_other: "„Åù„ÅÆ‰ªñ",
    cd_d: "Êó•",
    cd_h: "ÊôÇ",
    cd_m: "ÂàÜ",
    info_series: "„Ç∑„É™„Éº„Ç∫",
    info_series_h: "„Ç∑„É™„Éº„Ç∫Ë®≠ÂÆö",
    info_series_desc: "Âú∞ÁêÉÂÑÄ„Éª„Ç´„É¨„É≥„ÉÄ„Éº„Éª„Éò„ÉÉ„ÉÄ„Éº„Å´Ë°®Á§∫„Åô„Çã„É¨„Éº„Çπ„Ç∑„É™„Éº„Ç∫„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
    info_series_note: "ÈÅ∏ÊäûÂÜÖÂÆπ„ÅØ„Éñ„É©„Ç¶„Ç∂„Å´‰øùÂ≠ò„Åï„Çå„ÄÅÊ¨°ÂõûË®™ÂïèÊôÇ„Å´Âæ©ÂÖÉ„Åï„Çå„Åæ„Åô„ÄÇ",
    info_series_reset: "„Åô„Åπ„Å¶„ÅÆ„Ç∑„É™„Éº„Ç∫„Å´„É™„Çª„ÉÉ„Éà",
    race_done_short: "ÁµÇ‰∫Ü",
    day_singular: "Êó•",
    day_plural: "Êó•",
  },
  ko: {
    next_f1: "üèé Îã§Ïùå F1",
    next_f1a: "üèé Îã§Ïùå F1 ÏïÑÏπ¥Îç∞ÎØ∏",
    next_fe: "‚ö° Îã§Ïùå Ìè¨ÎÆ¨Îü¨ E",
    next_indy: "üèÅ Îã§Ïùå Ïù∏ÎîîÏπ¥",
    next_f2: "üèé Îã§Ïùå F2",
    next_f3: "üèé Îã§Ïùå F3",
    starts_in: "ÏãúÏûëÍπåÏßÄ",
    on_now: "ÏßÑÌñâ Ï§ë!",
    hint: "ÎìúÎûòÍ∑∏Î°ú ÌöåÏ†Ñ ¬∑ Ïä§ÌÅ¨Î°§Î°ú ÌôïÎåÄ",
    calendar_title: "2026 Ï∫òÎ¶∞Îçî",
    all: "Ï†ÑÏ≤¥",
    tab_globe: "ÏßÄÍµ¨Î≥∏",
    tab_calendar: "Ï∫òÎ¶∞Îçî",
    tab_news: "Îâ¥Ïä§",
    info_about: "ÏÜåÍ∞ú",
    info_contact: "Î¨∏Ïùò",
    info_terms: "Ïù¥Ïö© ÏïΩÍ¥Ä",
    close: "Îã´Í∏∞",
    start_tour: "Ìà¨Ïñ¥ ÏãúÏûë",
    stop_tour: "Ìà¨Ïñ¥ Ï§ëÏßÄ",
    round: "ÎùºÏö¥Îìú",
    race_starts: "üèé F1 Î†àÏù¥Ïä§ ÏãúÏûëÍπåÏßÄ",
    eprix_starts: "‚ö° E-Prix ÏãúÏûëÍπåÏßÄ",
    indy_starts: "üèé Ïù∏ÎîîÏπ¥ Î†àÏù¥Ïä§ ÏãúÏûëÍπåÏßÄ",
    race_done_f1: "üèÅ F1 Î†àÏù¥Ïä§",
    race_done_fe: "‚ö° E-Prix",
    race_done_indy: "üèÅ Ïù∏ÎîîÏπ¥ Î†àÏù¥Ïä§",
    race_completed: "Î†àÏù¥Ïä§ Ï¢ÖÎ£å",
    news_loading: "ÏµúÏã† Î™®ÌÑ∞Ïä§Ìè¨Ï∏† Îâ¥Ïä§ Î∂àÎü¨Ïò§Îäî Ï§ë‚Ä¶",
    news_unavailable: "‚ö† Îâ¥Ïä§Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏùå ‚Äî Í¥ëÍ≥† Ï∞®Îã®Í∏∞Î•º ÎπÑÌôúÏÑ±ÌôîÌïòÏÑ∏Ïöî",
    news_error: "‚ö† Îâ¥Ïä§ ÌîºÎìúÎ•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.",
    ad_block_note: "Í¥ëÍ≥† Ï∞®Îã®Í∏∞Í∞Ä ÏöîÏ≤≠ÏùÑ Î∞©Ìï¥Ìï† Ïàò ÏûàÏäµÎãàÎã§.",
    no_stories: "Ïù¥ Ïπ¥ÌÖåÍ≥†Î¶¨Ïóê Í∏∞ÏÇ¨Í∞Ä ÏóÜÏäµÎãàÎã§.",
    stories: "Í±¥",
    s_fp1: "ÏûêÏú† Ïó∞Ïäµ 1",
    s_fp2: "ÏûêÏú† Ïó∞Ïäµ 2",
    s_fp3: "ÏûêÏú† Ïó∞Ïäµ 3",
    s_sq: "Ïä§ÌîÑÎ¶∞Ìä∏ ÏòàÏÑ†",
    s_sprint: "Ïä§ÌîÑÎ¶∞Ìä∏ Î†àÏù¥Ïä§",
    s_quali: "ÏòàÏÑ†",
    s_race: "F1 Î†àÏù¥Ïä§",
    s_fe_race: "E-Prix",
    s_fe_race2: "E-Prix 2",
    s_fe_quali: "ÏòàÏÑ†",
    s_fe_fp: "ÏûêÏú† Ïó∞Ïäµ",
    s_indy_race: "Î†àÏù¥Ïä§",
    s_indy_race2: "Î†àÏù¥Ïä§ 2",
    s_indy_quali: "ÏòàÏÑ†",
    s_indy_fp: "Ïó∞Ïäµ",
    s_f2_fp: "ÏûêÏú† Ïó∞Ïäµ",
    s_f2_quali: "ÏòàÏÑ†",
    s_f2_sprint: "Ïä§ÌîÑÎ¶∞Ìä∏",
    s_f2_feature: "ÌîºÏ≤ò Î†àÏù¥Ïä§",
    s_f3_fp: "Ïó∞Ïäµ",
    s_f3_quali: "ÏòàÏÑ†",
    s_f3_sprint: "Ïä§ÌîÑÎ¶∞Ìä∏",
    s_f3_feature: "ÌîºÏ≤ò Î†àÏù¥Ïä§",
    s_f1a_quali: "ÏòàÏÑ†",
    s_f1a_r1: "Î†àÏù¥Ïä§ 1",
    s_f1a_r2: "Î†àÏù¥Ïä§ 2",
    news_loading_ticker: "Î∂àÎü¨Ïò§Îäî Ï§ë‚Ä¶",
    info_intro1: "GridPulseÎäî Î™®Îì† ÏãúÎ¶¨Ï¶àÎ•º ÌïòÎÇòÏùò ÏßÄÍµ¨Î≥∏ÏóêÏÑú Îî∞ÎùºÍ∞à Ïàò ÏûàÎäî Ìå¨ÏùÑ ÏúÑÌïú ÎùºÏù¥Î∏å Î™®ÌÑ∞Ïä§Ìè¨Ï∏† Ï∫òÎ¶∞ÎçîÏûÖÎãàÎã§.",
    info_intro2: "ÏßÄÍµ¨Î≥∏ÏùÑ ÎèåÎ†§ ÏÑúÌÇ∑ÏùÑ ÌÉêÏÉâÌïòÍ≥†, Ïñ¥ÎîîÏÑú Ïñ∏Ï†ú Î†àÏù¥Ïä§Í∞Ä Ïó¥Î¶¨ÎäîÏßÄ Ïã§ÏãúÍ∞ÑÏúºÎ°ú ÌôïÏù∏ÌïòÏÑ∏Ïöî.",
    info_contact_h2: "<em>Î¨∏ÏùòÌïòÍ∏∞</em>",
    info_terms_h2: "Ïù¥Ïö© <em>ÏïΩÍ¥Ä</em>",
    info_h_covered: "Îã§Î£®Îäî ÏãúÎ¶¨Ï¶à",
    info_li_f1: "Ìè¨ÎÆ¨Îü¨ 1 ‚Äî Ïó∞Ïäµ¬∑ÏòàÏÑ†¬∑Í≤∞ÏäπÏùÑ Ìè¨Ìï®Ìïú Ï†ÑÏ≤¥ ÏãúÏ¶å Ï∫òÎ¶∞Îçî",
    info_li_f2f3: "Ìè¨ÎÆ¨Îü¨ 2 & Ìè¨ÎÆ¨Îü¨ 3 ‚Äî Ïä§ÌîÑÎ¶∞Ìä∏ Î∞è ÌîºÏ≤ò Î†àÏù¥Ïä§",
    info_li_f1a: "F1 ÏïÑÏπ¥Îç∞ÎØ∏ ‚Äî Ïó¨ÏÑ± ÎìúÎùºÏù¥Î≤Ñ Ïú°ÏÑ± ÏãúÎ¶¨Ï¶à",
    info_li_fe: "Ìè¨ÎÆ¨Îü¨ E ‚Äî Ï†ÑÍ∏∞ ÎèÑÏã¨ Î†àÏù¥Ïä§ E-Prix Ï∫òÎ¶∞Îçî",
    info_li_indy: "Ïù∏ÎîîÏπ¥ ‚Äî Ïò§Î≤åÍ≥º Î°úÎìú ÏΩîÏä§ Ï±îÌîºÏñ∏Ïã≠ Ï∫òÎ¶∞Îçî",
    info_h_how: "ÏÇ¨Ïö© Î∞©Î≤ï",
    info_how_1: "ÏßÄÍµ¨Î≥∏ÏùÑ ÎìúÎûòÍ∑∏ÌïòÏó¨ ÌöåÏ†Ñ, Ïä§ÌÅ¨Î°§ ÎòêÎäî ÌïÄÏπòÎ°ú ÌôïÎåÄ/Ï∂ïÏÜå",
    info_how_2: "Î†àÏù¥Ïä§ Ï†êÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ Ï†ÑÏ≤¥ ÏÑ∏ÏÖò ÏùºÏ†ï Î≥¥Í∏∞",
    info_how_3: "ÏãúÎ¶¨Ï¶à ÌïÑÌÑ∞Î°ú ÌäπÏ†ï Ï±îÌîºÏñ∏Ïã≠Ïóê ÏßëÏ§ë",
    info_how_4: "‚ñ∂Î•º ÎàåÎü¨ ÏûêÎèô Ìà¨Ïñ¥ ÏãúÏûë",
    info_how_5: "Ìó§ÎçîÍ∞Ä Î™®Îì† ÌôúÏÑ± ÏãúÎ¶¨Ï¶àÏùò Îã§Ïùå Î†àÏù¥Ïä§Î•º ÏàúÌôò ÌëúÏãú",
    info_h_data: "Îç∞Ïù¥ÌÑ∞ Î∞è ÏóÖÎç∞Ïù¥Ìä∏",
    info_data_p: "ÏÑ∏ÏÖò ÏãúÍ∞ÅÏùÄ Í≥µÏãù Ï∫òÎ¶∞ÎçîÏóêÏÑú Í∞ÄÏ†∏Ïò§Î©∞ ÌòÑÏßÄ ÏãúÍ∞ÑÎåÄÎ°ú ÌëúÏãúÎê©ÎãàÎã§. Îâ¥Ïä§Îäî AutosportÏôÄ The RaceÏóêÏÑú Ïã§ÏãúÍ∞ÑÏúºÎ°ú Ï†úÍ≥µÎê©ÎãàÎã§.",
    info_disclaimer: "GridPulseÎäî ÎèÖÎ¶ΩÏ†ÅÏù∏ Ìå¨ ÌîÑÎ°úÏ†ùÌä∏Ïù¥Î©∞ Formula One Management, Formula E Operations, IndyCar ÎòêÎäî Ïñ¥Îñ§ ÌåÄÏù¥ÎÇò ÎìúÎùºÏù¥Î≤ÑÏôÄÎèÑ Î¨¥Í¥ÄÌï©ÎãàÎã§.",
    info_contact_intro: "ÏßàÎ¨∏, Î≤ÑÍ∑∏ Ïã†Í≥† ÎòêÎäî Í∏∞Îä• Ï†úÏïàÏù¥ ÏûàÏúºÏãúÎ©¥ Ìé∏ÌïòÍ≤å Î¨∏ÏùòÌï¥ Ï£ºÏÑ∏Ïöî.",
    info_contact_general: "ÏùºÎ∞ò Î¨∏Ïùò",
    info_email: "Ïù¥Î©îÏùº",
    info_response: "ÏùëÎãµ ÏãúÍ∞Ñ",
    info_response_val: "2~3 ÏòÅÏóÖÏùº",
    info_bugs: "Î≤ÑÍ∑∏ Ïã†Í≥†",
    info_feedback: "Í∏∞Îä• ÏöîÏ≤≠",
    info_follow: "ÌåîÎ°úÏö∞",
    terms_intro: "ÏµúÏ¢Ö ÏóÖÎç∞Ïù¥Ìä∏: 2026ÎÖÑ 1Ïõî. GridPulseÎ•º Ïù¥Ïö©Ìï®ÏúºÎ°úÏç® Î≥∏ ÏïΩÍ¥ÄÏóê ÎèôÏùòÌï©ÎãàÎã§.",
    terms_h1: "1. ÎèôÏùò",
    terms_p1: "Î≥∏ ÏïΩÍ¥ÄÏùÄ GridPulse Ïù¥Ïö©ÏùÑ Í∑úÏ†ïÌï©ÎãàÎã§. ÏÑúÎπÑÏä§Î•º Ïù¥Ïö©Ìï®ÏúºÎ°úÏç® Îßå 13ÏÑ∏ Ïù¥ÏÉÅÏûÑÏùÑ ÌôïÏù∏ÌïòÍ≥† Î≥∏ ÏïΩÍ¥ÄÏóê ÎèôÏùòÌï©ÎãàÎã§.",
    terms_h2: "2. ÌóàÏö© ÏÇ¨Ïö©",
    terms_p2: "GridPulseÎäî Í∞úÏù∏Ï†Å¬∑ÎπÑÏÉÅÏóÖÏ†Å Î™©Ï†ÅÏúºÎ°úÎßå Ï†úÍ≥µÎê©ÎãàÎã§. ÏÇ¨Ï†Ñ ÏÑúÎ©¥ ÌóàÍ∞Ä ÏóÜÏù¥ ÏΩòÌÖêÏ∏†Ïùò Î≥µÏ†ú¬∑ÏÉÅÏóÖÏ†Å Ïù¥Ïö©ÏùÄ Í∏àÏßÄÎê©ÎãàÎã§.",
    terms_h3: "3. Ï†ïÎ≥¥Ïùò Ï†ïÌôïÏÑ±",
    terms_p3: "GridPulseÎäî ÌëúÏãú Ï†ïÎ≥¥Ïùò ÏôÑÏ†ÑÏÑ±ÏùÑ Î≥¥Ïû•ÌïòÏßÄ ÏïäÏäµÎãàÎã§. Ï§ëÏöîÌïú Ï†ïÎ≥¥Îäî Í≥µÏãù Ï∂úÏ≤òÏóêÏÑú Î∞òÎìúÏãú ÌôïÏù∏ÌïòÏÑ∏Ïöî.",
    terms_h4: "4. Ï†ú3Ïûê ÏΩòÌÖêÏ∏†",
    terms_p4: "GridPulseÎäî Ïô∏Î∂Ä Ï∂úÏ≤òÏùò Îâ¥Ïä§Î•º ÏßëÍ≥ÑÌï©ÎãàÎã§. Ïô∏Î∂Ä ÏΩòÌÖêÏ∏†Ïóê ÎåÄÌïú Ï±ÖÏûÑÏùÄ ÏßÄÏßÄ ÏïäÏäµÎãàÎã§.",
    terms_h5: "5. ÏßÄÏ†Å Ïû¨ÏÇ∞Í∂å",
    terms_p5: "GridPulseÏùò ÏΩòÌÖêÏ∏†¬∑ÎîîÏûêÏù∏¬∑ÏΩîÎìúÎäî Ï†úÏûëÏûêÏóêÍ≤å Í∑ÄÏÜçÎê©ÎãàÎã§. Í∞Å ÏãúÎ¶¨Ï¶àÏùò Î™ÖÏπ≠Í≥º Î°úÍ≥†Îäî Ìï¥Îãπ ÏÜåÏú†ÏûêÏóêÍ≤å Í∑ÄÏÜçÎê©ÎãàÎã§.",
    terms_h6: "6. Ï±ÖÏûÑ Ï†úÌïú",
    terms_p6: "Î≤ïÏù¥ ÌóàÏö©ÌïòÎäî ÏµúÎåÄÌïúÏùò Î≤îÏúÑÏóêÏÑú GridPulseÎäî ÏÑúÎπÑÏä§ Ïù¥Ïö©ÏúºÎ°ú Î∞úÏÉùÌïòÎäî ÏÜêÌï¥Ïóê ÎåÄÌï¥ Ï±ÖÏûÑÏùÑ ÏßÄÏßÄ ÏïäÏäµÎãàÎã§.",
    terms_h7: "7. ÏïΩÍ¥Ä Î≥ÄÍ≤Ω",
    terms_p7: "Î≥∏ ÏïΩÍ¥ÄÏùÄ Ïñ∏Ï†úÎì†ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏Îê† Ïàò ÏûàÏäµÎãàÎã§. Í≥ÑÏÜç Ïù¥Ïö©Ìï®ÏúºÎ°úÏç® Î≥ÄÍ≤ΩÎêú ÏïΩÍ¥ÄÏóê ÎèôÏùòÌïú Í≤ÉÏúºÎ°ú Í∞ÑÏ£ºÎê©ÎãàÎã§.",
    terms_h8: "8. Ï§ÄÍ±∞Î≤ï",
    terms_p8: "Î≥∏ ÏïΩÍ¥ÄÏùÄ ÏûâÍ∏ÄÎûúÎìú Î∞è Ïõ®ÏùºÏ¶à Î≤ïÎ•†Ïùò Ï†ÅÏö©ÏùÑ Î∞õÏäµÎãàÎã§.",
    terms_bilingual_note: "‚ö† Î≥∏ ÏïΩÍ¥ÄÏùÄ ÏòÅÏñ¥ Î≤ÑÏ†ÑÎßå Î≤ïÏ†Å Ìö®Î†•ÏùÑ Í∞ÄÏßëÎãàÎã§. ÏïÑÎûò Î≤àÏó≠ÏùÄ Í≥µÏãù ÏòÅÏñ¥ Î≤ÑÏ†ÑÍ≥º Ìï®Íªò Ï∞∏Í≥† Î™©Ï†ÅÏúºÎ°ú Ï†úÍ≥µÎê©ÎãàÎã§.",
    next_wec: "üèÅ Îã§Ïùå WEC",
    next_wrc: "üèî Îã§Ïùå WRC",
    wec_starts: "üèÅ Î†àÏù¥Ïä§ ÏãúÏûëÍπåÏßÄ",
    wrc_starts: "üèî Îû†Î¶¨ ÏãúÏûëÍπåÏßÄ",
    race_done_wec: "üèÅ WEC Î†àÏù¥Ïä§",
    race_done_wrc: "üèî WRC Îû†Î¶¨",
    s_wec_race: "Î†àÏù¥Ïä§ Ïä§ÌÉÄÌä∏",
    s_wrc_ps: "ÌååÏõå Ïä§ÌÖåÏù¥ÏßÄ",
    s_wrc_day1: "Îç∞Ïù¥ 1",
    news_other: "Í∏∞ÌÉÄ",
    cd_d: "Ïùº",
    cd_h: "Ïãú",
    cd_m: "Î∂Ñ",
    info_series: "ÏãúÎ¶¨Ï¶à",
    info_series_h: "ÏãúÎ¶¨Ï¶à ÏÑ§Ï†ï",
    info_series_desc: "ÏßÄÍµ¨Î≥∏, Ï∫òÎ¶∞Îçî, Ìó§ÎçîÏóê ÌëúÏãúÌï† Î†àÏù¥Ïä§ ÏãúÎ¶¨Ï¶àÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",
    info_series_note: "ÏÑ†ÌÉù Ìï≠Î™©ÏùÄ Î∏åÎùºÏö∞Ï†ÄÏóê Ï†ÄÏû•ÎêòÏñ¥ Îß§Î≤à Î∞©Î¨∏ Ïãú Î≥µÏõêÎê©ÎãàÎã§.",
    info_series_reset: "Î™®Îì† ÏãúÎ¶¨Ï¶àÎ°ú Ï¥àÍ∏∞Ìôî",
    race_done_short: "ÏôÑÎ£å",
    day_singular: "Ïùº",
    day_plural: "Ïùº",
  },
};

let currentLang = 'en';
const LANG_LOCALE = { en:'en-GB', fr:'fr-FR', es:'es-ES', de:'de-DE', pl:'pl-PL', ja:'ja-JP', ko:'ko-KR' };
function uiLocale() { return LANG_LOCALE[currentLang] || 'en-GB'; }

const COUNTRY_ISO = {
  'Australia':'AU','Austria':'AT','Azerbaijan':'AZ','Bahrain':'BH',
  'Belgium':'BE','Brazil':'BR','Canada':'CA','Chile':'CL','China':'CN',
  'Croatia':'HR','Estonia':'EE','Finland':'FI','France':'FR','Germany':'DE',
  'Greece':'GR','Hungary':'HU','Italy':'IT','Japan':'JP','Kenya':'KE',
  'Mexico':'MX','Monaco':'MC','Netherlands':'NL','Poland':'PL','Portugal':'PT',
  'Qatar':'QA','Saudi Arabia':'SA','Singapore':'SG','Spain':'ES','Sweden':'SE',
  'UAE':'AE','USA':'US','United Kingdom':'GB'
};
function localiseCountry(name) {
  const code = COUNTRY_ISO[name];
  if (!code) return name;
  try {
    return new Intl.DisplayNames([uiLocale()], { type:'region' }).of(code) || name;
  } catch(e) { return name; }
}


function t(key) {
  return (TRANSLATIONS[currentLang] || TRANSLATIONS.en)[key] || TRANSLATIONS.en[key] || key;
}

function applyTranslations() {
  const lang = currentLang;

  // 1. Static elements with data-i18n (textContent ‚Äî no child HTML tags)
  document.querySelectorAll('[data-i18n]').forEach(el => {
    el.textContent = t(el.dataset.i18n);
  });

  // 1b. Elements with data-i18n-html (may contain child tags like <em>)
  document.querySelectorAll('[data-i18n-html]').forEach(el => {
    el.innerHTML = t(el.dataset.i18nHtml);
  });

  // 2. Title attributes
  document.querySelectorAll('[data-i18n-title]').forEach(el => {
    el.title = t(el.dataset.i18nTitle);
  });

  // 2b. Bilingual terms ‚Äî show English shadow paragraphs when not English
  const isEnglish = lang === 'en';
  const termsNote = document.getElementById('terms-bilingual-note');
  if (termsNote) {
    if (isEnglish) {
      termsNote.style.display = 'none';
    } else {
      termsNote.style.display = 'block';
      termsNote.textContent = t('terms_bilingual_note');
    }
  }
  document.querySelectorAll('.terms-en-shadow').forEach(el => {
    if (isEnglish) {
      el.style.display = 'none';
    } else {
      el.style.display = 'block';
      el.textContent = TRANSLATIONS.en[el.dataset.enKey] || '';
    }
  });

  // 3. Header series labels
  const f1label = document.getElementById('hdr-f1-label');
  if (f1label && !f1label.textContent.includes('¬∑')) f1label.textContent = t('next_f1');
  ['f2','f3','f1a','fe','indy','wec','wrc'].forEach(k => {
    const el = document.querySelector('[data-i18n-prefix="next_' + k + '"]');
    if (el) el.textContent = t('next_' + k);
  });

  // 4. Header "Starts in" spans (set by tick but have data-i18n ‚Äî refresh now)
  document.querySelectorAll('.header-countdown-label span[data-i18n]').forEach(el => {
    el.textContent = t(el.dataset.i18n);
  });

  // 5. Session panel countdown label (if panel is open)
  if (activePanelCity >= 0) {
    const cdLabel = document.querySelector('.sp-countdown-label');
    if (cdLabel) {
      const c = cities[activePanelCity];
      const primaryS = c.series.includes('f1') ? 'f1' : c.series.includes('fe') ? 'fe' : c.series.includes('wec') ? 'wec' : c.series.includes('wrc') ? 'wrc' : 'indy';
      const raceMs = new Date(c.sessions.race) - Date.now();
      cdLabel.textContent = raceMs > 0
        ? { f1: t('race_starts'), fe: t('eprix_starts'), indy: t('indy_starts') }[primaryS]
        : { f1: t('race_done_f1'), fe: t('race_done_fe'), indy: t('race_done_indy') }[primaryS];
    }
  }

  // 6. Rebuild news ticker and dropdown with new language strings
  if (typeof buildTicker === 'function' && typeof getFilteredNews === 'function') {
    buildTicker(getFilteredNews());
    buildDropdown(getFilteredNews());
  }
  if (typeof populateMobileNews === 'function') {
    populateMobileNews();
  }

  // 7. Sidebar count (already a number, no translation needed)
  // But re-run applyFilter to update the count label text if needed
  // applyFilter just sets a number so nothing to translate

  // 8. Tour button title
  const tourBtn = document.getElementById('tour-play-btn');
  if (tourBtn) tourBtn.title = tourActive ? t('stop_tour') : t('start_tour');

  // 9. Language button label + active state
  const langBtnEl = document.getElementById('lang-btn');
  if (langBtnEl) langBtnEl.textContent = lang.toUpperCase();
  document.querySelectorAll('.lang-opt').forEach(b => b.classList.toggle('active', b.dataset.lang === lang));

  // 10. News loading placeholder text
  const newsLoadingEl = document.getElementById('news-loading-text');
  if (newsLoadingEl) newsLoadingEl.textContent = t('news_loading_ticker');

  // 10a. Sidebar city dates and country names ‚Äî reformat with current locale
  document.querySelectorAll('.ci-country-name[data-country]').forEach(el => {
    el.textContent = localiseCountry(el.dataset.country);
  });
  document.querySelectorAll('.ci-date[data-race-date]').forEach(el => {
    const d = new Date(el.dataset.raceDate);
    el.textContent = new Intl.DateTimeFormat(uiLocale(), { day:'numeric', month:'short' }).format(d);
  });

  // 10b. News story count (re-render with translated 'stories' word)
  const newsCountEl = document.getElementById('news-count');
  if (newsCountEl && typeof allNewsItems !== 'undefined' && allNewsItems.length > 0) {
    newsCountEl.textContent = `${allNewsItems.length} ${t('stories')}`;
  }
  // Also update mobile news count
  const mobNewsCountEl = document.getElementById('mob-news-count');
  if (mobNewsCountEl && typeof allNewsItems !== 'undefined' && allNewsItems.length > 0) {
    const mobItems = typeof mobNewsFilter !== 'undefined' && mobNewsFilter === 'f1'
      ? allNewsItems.filter(i => i.badge === 'f1')
      : typeof mobNewsFilter !== 'undefined' && mobNewsFilter === 'other'
      ? allNewsItems.filter(i => i.badge !== 'f1')
      : allNewsItems;
    mobNewsCountEl.textContent = `¬∑ ${mobItems.length} ${t('stories')}`;
  }

  // 11. Session panel: re-render round label + session rows if panel is open
  if (activePanelCity >= 0 && typeof openSessionPanel === 'function') {
    openSessionPanel(activePanelCity);
  }

  // 12. Force tick() to re-render countdowns immediately
  if (typeof tick === 'function') tick();
}

// Language switcher wiring
document.addEventListener('DOMContentLoaded', function() {
  const langBtn  = document.getElementById('lang-btn');
  const langMenu = document.getElementById('lang-menu');

  langBtn.addEventListener('click', e => {
    e.stopPropagation();
    const isOpen = langMenu.classList.toggle('open');
    if (isOpen) {
      const r = langBtn.getBoundingClientRect();
      langMenu.style.top  = (r.bottom + 4) + 'px';
      langMenu.style.left = (r.right - langMenu.offsetWidth || r.left) + 'px';
      // Re-measure after display:block
      requestAnimationFrame(() => {
        langMenu.style.left = (r.right - langMenu.offsetWidth) + 'px';
      });
    }
  });
  document.addEventListener('click', () => langMenu.classList.remove('open'));

  document.querySelectorAll('.lang-opt').forEach(btn => {
    btn.addEventListener('click', e => {
      e.stopPropagation();
      currentLang = btn.dataset.lang;
      langMenu.classList.remove('open');
      applyTranslations();
    });
  });

  // Apply default language on load
  applyTranslations();
});


// F1 2026 Season ‚Äî 24 rounds with all series session times (UTC ISO strings)
// F1 sessions confirmed from The Race; F2/F3 from official FIA sites; F1A from f1academy.com
// Support series times are based on confirmed Melbourne slots + standard weekend patterns
// ‚îÄ‚îÄ‚îÄ UTILITY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const isMobile = () => window.innerWidth <= 700;
const isTablet = () => window.innerWidth > 700 && window.innerWidth <= 1024;

const cities = [
  // R1 Australia (F1+F2+F3) ‚Äì confirmed from gpblog.com official schedule
  { city: 'Albert Park', country: 'Australia', region: 'Australian GP', round:1, series:['f1','f2','f3'], tz:'Australia/Melbourne', lat:-37.84, lng:144.97,
    sessions:{ fp1:'2026-03-06T01:30Z', fp2:'2026-03-06T05:00Z', fp3:'2026-03-07T02:30Z', quali:'2026-03-07T05:00Z', race:'2026-03-08T04:00Z' },
    f3Sessions:{ fp:'2026-03-05T21:50Z', quali:'2026-03-06T03:00Z', sprint:'2026-03-07T00:15Z', feature:'2026-03-07T22:05Z' },
    f2Sessions:{ fp:'2026-03-05T23:00Z', quali:'2026-03-06T03:55Z', sprint:'2026-03-07T03:10Z', feature:'2026-03-08T00:25Z' } },

  // R2 China Sprint (F1+F1A) ‚Äì F1A times TBC, using standard Friday/Sat/Sun slots CST(UTC+8)
  { city: 'Shanghai Int\'l Circuit', country: 'China', region: 'Chinese GP', round:2, series:['f1','f1a'], tz:'Asia/Shanghai', lat:31.34, lng:121.22,
    sessions:{ fp1:'2026-03-13T03:30Z', sq:'2026-03-13T07:30Z', sprint:'2026-03-14T03:00Z', quali:'2026-03-14T07:00Z', race:'2026-03-15T07:00Z' },
    f1aSessions:{ quali:'2026-03-13T09:00Z', race1:'2026-03-14T01:30Z', race2:'2026-03-15T00:00Z' } },

  // R3 Japan (F1 only)
  { city: 'Suzuka Circuit', country: 'Japan', region: 'Japanese GP', round:3, series:['f1'], tz:'Asia/Tokyo', lat:34.84, lng:136.54,
    sessions:{ fp1:'2026-03-27T02:30Z', fp2:'2026-03-27T06:00Z', fp3:'2026-03-28T03:00Z', quali:'2026-03-28T07:00Z', race:'2026-03-29T05:00Z' } },

  // R4 Bahrain (F1+F2+F3) ‚Äì evening races, local times AST(UTC+3)
  { city: 'Bahrain Int\'l Circuit', country: 'Bahrain', region: 'Bahrain GP', round:4, series:['f1','f2','f3'], tz:'Asia/Bahrain', lat:26.03, lng:50.51,
    sessions:{ fp1:'2026-04-10T09:30Z', fp2:'2026-04-10T13:00Z', fp3:'2026-04-11T10:30Z', quali:'2026-04-11T14:00Z', race:'2026-04-12T15:00Z' },
    f3Sessions:{ fp:'2026-04-10T07:00Z', quali:'2026-04-10T11:30Z', sprint:'2026-04-11T08:30Z', feature:'2026-04-12T07:30Z' },
    f2Sessions:{ fp:'2026-04-10T08:00Z', quali:'2026-04-10T12:30Z', sprint:'2026-04-11T11:30Z', feature:'2026-04-12T09:30Z' } },

  // R5 Saudi (F1+F2+F1A) ‚Äì night race, AST(UTC+3)
  { city: 'Jeddah Corniche Circuit', country: 'Saudi Arabia', region: 'Saudi Arabian GP', round:5, series:['f1','f2','f1a'], tz:'Asia/Riyadh', lat:21.63, lng:39.10,
    sessions:{ fp1:'2026-04-17T15:00Z', fp2:'2026-04-17T18:30Z', fp3:'2026-04-18T16:30Z', quali:'2026-04-18T17:00Z', race:'2026-04-19T17:00Z' },
    f2Sessions:{ fp:'2026-04-17T12:00Z', quali:'2026-04-17T15:30Z', sprint:'2026-04-18T12:30Z', feature:'2026-04-19T11:30Z' },
    f1aSessions:{ quali:'2026-04-17T17:00Z', race1:'2026-04-18T14:30Z', race2:'2026-04-19T13:00Z' } },

  // R6 Miami Sprint (F1 only)
  { city: 'Miami Int\'l Autodrome', country: 'USA', region: 'Miami GP', round:6, series:['f1'], tz:'America/New_York', lat:25.96, lng:-80.24,
    sessions:{ fp1:'2026-05-01T16:30Z', sq:'2026-05-01T20:30Z', sprint:'2026-05-02T15:30Z', quali:'2026-05-02T19:00Z', race:'2026-05-03T20:00Z' } },

  // R7 Canada Sprint (F1+F1A) ‚Äì EDT(UTC-4)
  { city: 'Circuit Gilles Villeneuve', country: 'Canada', region: 'Canadian GP', round:7, series:['f1','f1a'], tz:'America/Toronto', lat:45.50, lng:-73.52,
    sessions:{ fp1:'2026-05-22T17:30Z', sq:'2026-05-22T21:30Z', sprint:'2026-05-23T16:30Z', quali:'2026-05-23T20:00Z', race:'2026-05-24T20:00Z' },
    f1aSessions:{ quali:'2026-05-22T22:30Z', race1:'2026-05-23T14:00Z', race2:'2026-05-24T13:00Z' } },

  // R8 Monaco (F1+F2+F3) ‚Äì CEST(UTC+2)
  { city: 'Circuit de Monaco', country: 'Monaco', region: 'Monaco GP', round:8, series:['f1','f2','f3'], tz:'Europe/Monaco', lat:43.74, lng:7.43,
    sessions:{ fp1:'2026-06-05T11:30Z', fp2:'2026-06-05T15:00Z', fp3:'2026-06-06T10:30Z', quali:'2026-06-06T13:00Z', race:'2026-06-07T13:00Z' },
    f3Sessions:{ fp:'2026-06-05T09:00Z', quali:'2026-06-05T13:00Z', sprint:'2026-06-06T08:30Z', feature:'2026-06-07T07:30Z' },
    f2Sessions:{ fp:'2026-06-05T10:00Z', quali:'2026-06-05T14:00Z', sprint:'2026-06-06T11:00Z', feature:'2026-06-07T09:30Z' } },

  // R9 Barcelona (F1+F2+F3) ‚Äì CEST(UTC+2)
  { city: 'Circuit de Barcelona-Catalunya', country: 'Spain', region: 'Spanish GP', round:9, series:['f1','f2','f3'], tz:'Europe/Madrid', lat:41.57, lng:2.26,
    sessions:{ fp1:'2026-06-12T11:30Z', fp2:'2026-06-12T15:00Z', fp3:'2026-06-13T10:30Z', quali:'2026-06-13T13:00Z', race:'2026-06-14T13:00Z' },
    f3Sessions:{ fp:'2026-06-12T09:00Z', quali:'2026-06-12T13:00Z', sprint:'2026-06-13T08:45Z', feature:'2026-06-14T07:30Z' },
    f2Sessions:{ fp:'2026-06-12T10:00Z', quali:'2026-06-12T14:00Z', sprint:'2026-06-13T11:00Z', feature:'2026-06-14T09:30Z' } },

  // R10 Austria (F1+F2+F3) ‚Äì CEST(UTC+2)
  { city: 'Red Bull Ring', country: 'Austria', region: 'Austrian GP', round:10, series:['f1','f2','f3'], tz:'Europe/Vienna', lat:47.22, lng:14.76,
    sessions:{ fp1:'2026-06-26T11:30Z', fp2:'2026-06-26T15:00Z', fp3:'2026-06-27T10:30Z', quali:'2026-06-27T13:00Z', race:'2026-06-28T13:00Z' },
    f3Sessions:{ fp:'2026-06-26T09:00Z', quali:'2026-06-26T13:00Z', sprint:'2026-06-27T08:45Z', feature:'2026-06-28T07:30Z' },
    f2Sessions:{ fp:'2026-06-26T10:00Z', quali:'2026-06-26T14:00Z', sprint:'2026-06-27T11:00Z', feature:'2026-06-28T09:30Z' } },

  // R11 Britain Sprint (F1+F2+F3+F1A) ‚Äì BST(UTC+1)
  { city: 'Silverstone Circuit', country: 'United Kingdom', region: 'British GP', round:11, series:['f1','f2','f3','f1a'], tz:'Europe/London', lat:52.07, lng:-1.02,
    sessions:{ fp1:'2026-07-03T10:30Z', sq:'2026-07-03T14:30Z', sprint:'2026-07-04T11:00Z', quali:'2026-07-04T14:00Z', race:'2026-07-05T14:00Z' },
    f3Sessions:{ fp:'2026-07-03T08:30Z', quali:'2026-07-03T13:00Z', sprint:'2026-07-04T08:30Z', feature:'2026-07-05T08:30Z' },
    f2Sessions:{ fp:'2026-07-03T09:30Z', quali:'2026-07-03T14:00Z', sprint:'2026-07-04T09:45Z', feature:'2026-07-05T10:00Z' },
    f1aSessions:{ quali:'2026-07-03T15:30Z', race1:'2026-07-04T07:30Z', race2:'2026-07-05T07:00Z' } },

  // R12 Belgium (F1+F2+F3) ‚Äì CEST(UTC+2)
  { city: 'Circuit de Spa-Francorchamps', country: 'Belgium', region: 'Belgian GP', round:12, series:['f1','f2','f3'], tz:'Europe/Brussels', lat:50.44, lng:5.97,
    sessions:{ fp1:'2026-07-17T11:30Z', fp2:'2026-07-17T15:00Z', fp3:'2026-07-18T10:30Z', quali:'2026-07-18T13:00Z', race:'2026-07-19T13:00Z' },
    f3Sessions:{ fp:'2026-07-17T09:00Z', quali:'2026-07-17T13:00Z', sprint:'2026-07-18T08:45Z', feature:'2026-07-19T07:30Z' },
    f2Sessions:{ fp:'2026-07-17T10:00Z', quali:'2026-07-17T14:00Z', sprint:'2026-07-18T11:00Z', feature:'2026-07-19T09:30Z' } },

  // R13 Hungary (F1+F2+F3) ‚Äì CEST(UTC+2)
  { city: 'Hungaroring', country: 'Hungary', region: 'Hungarian GP', round:13, series:['f1','f2','f3'], tz:'Europe/Budapest', lat:47.58, lng:19.25,
    sessions:{ fp1:'2026-07-24T11:30Z', fp2:'2026-07-24T15:00Z', fp3:'2026-07-25T10:30Z', quali:'2026-07-25T13:00Z', race:'2026-07-26T13:00Z' },
    f3Sessions:{ fp:'2026-07-24T09:00Z', quali:'2026-07-24T13:00Z', sprint:'2026-07-25T08:45Z', feature:'2026-07-26T07:30Z' },
    f2Sessions:{ fp:'2026-07-24T10:00Z', quali:'2026-07-24T14:00Z', sprint:'2026-07-25T11:00Z', feature:'2026-07-26T09:30Z' } },

  // R14 Netherlands Sprint (F1+F1A) ‚Äì CEST(UTC+2)
  { city: 'Circuit Zandvoort', country: 'Netherlands', region: 'Dutch GP', round:14, series:['f1','f1a'], tz:'Europe/Amsterdam', lat:52.39, lng:4.54,
    sessions:{ fp1:'2026-08-21T10:30Z', sq:'2026-08-21T14:30Z', sprint:'2026-08-22T11:00Z', quali:'2026-08-22T14:00Z', race:'2026-08-23T13:00Z' },
    f1aSessions:{ quali:'2026-08-21T15:30Z', race1:'2026-08-22T07:30Z', race2:'2026-08-23T07:30Z' } },

  // R15 Italy (F1+F2+F3) ‚Äì CEST(UTC+2)
  { city: 'Autodromo Nazionale Monza', country: 'Italy', region: 'Italian GP', round:15, series:['f1','f2','f3'], tz:'Europe/Rome', lat:45.62, lng:9.28,
    sessions:{ fp1:'2026-09-04T11:30Z', fp2:'2026-09-04T15:00Z', fp3:'2026-09-05T10:30Z', quali:'2026-09-05T13:00Z', race:'2026-09-06T13:00Z' },
    f3Sessions:{ fp:'2026-09-04T09:00Z', quali:'2026-09-04T13:00Z', sprint:'2026-09-05T08:45Z', feature:'2026-09-06T07:30Z' },
    f2Sessions:{ fp:'2026-09-04T10:00Z', quali:'2026-09-04T14:00Z', sprint:'2026-09-05T11:00Z', feature:'2026-09-06T09:30Z' } },

  // R16 Madrid (F1+F2+F3) ‚Äì CEST(UTC+2)
  { city: 'Madrid Street Circuit (IFEMA)', country: 'Spain', region: 'Spanish GP (Madrid)', round:16, series:['f1','f2','f3'], tz:'Europe/Madrid', lat:40.47, lng:-3.69,
    sessions:{ fp1:'2026-09-11T11:30Z', fp2:'2026-09-11T15:00Z', fp3:'2026-09-12T10:30Z', quali:'2026-09-12T13:00Z', race:'2026-09-13T13:00Z' },
    f3Sessions:{ fp:'2026-09-11T09:00Z', quali:'2026-09-11T13:00Z', sprint:'2026-09-12T08:45Z', feature:'2026-09-13T07:30Z' },
    f2Sessions:{ fp:'2026-09-11T10:00Z', quali:'2026-09-11T14:00Z', sprint:'2026-09-12T11:00Z', feature:'2026-09-13T09:30Z' } },

  // R17 Baku SAT race (F1+F2) ‚Äì AZT(UTC+4)
  { city: 'Baku City Circuit', country: 'Azerbaijan', region: 'Azerbaijan GP', round:17, series:['f1','f2'], tz:'Asia/Baku', lat:40.37, lng:49.85,
    sessions:{ fp1:'2026-09-25T09:00Z', fp2:'2026-09-25T12:30Z', quali:'2026-09-25T10:00Z', race:'2026-09-26T11:00Z' },
    f2Sessions:{ fp:'2026-09-24T07:00Z', quali:'2026-09-24T11:30Z', sprint:'2026-09-25T07:30Z', feature:'2026-09-26T07:30Z' } },

  // R18 Singapore Sprint (F1 only)
  { city: 'Marina Bay Circuit', country: 'Singapore', region: 'Singapore GP', round:18, series:['f1'], tz:'Asia/Singapore', lat:1.29, lng:103.86,
    sessions:{ fp1:'2026-10-09T09:30Z', sq:'2026-10-09T13:30Z', sprint:'2026-10-10T10:00Z', quali:'2026-10-10T13:00Z', race:'2026-10-11T12:00Z' } },

  // R19 USA (F1+F1A) ‚Äì CDT(UTC-5)
  { city: 'Circuit of the Americas', country: 'USA', region: 'US GP', round:19, series:['f1','f1a'], tz:'America/Chicago', lat:30.13, lng:-97.64,
    sessions:{ fp1:'2026-10-23T16:30Z', fp2:'2026-10-23T20:00Z', fp3:'2026-10-24T16:30Z', quali:'2026-10-24T20:00Z', race:'2026-10-25T20:00Z' },
    f1aSessions:{ quali:'2026-10-23T22:00Z', race1:'2026-10-24T14:00Z', race2:'2026-10-25T13:30Z' } },

  // R20 Mexico (F1 only)
  { city: 'Autodromo Hermanos Rodriguez', country: 'Mexico', region: 'Mexico City GP', round:20, series:['f1','fe'], tz:'America/Mexico_City', lat:19.40, lng:-99.09,
    sessions:{ fp1:'2026-10-30T17:30Z', fp2:'2026-10-30T21:00Z', fp3:'2026-10-31T17:30Z', quali:'2026-10-31T21:00Z', race:'2026-11-01T20:00Z' } },

  // R21 Brazil (F1 only)
  { city: 'Autodromo Jose Carlos Pace', country: 'Brazil', region: 'S√£o Paulo GP', round:21, series:['f1'], tz:'America/Sao_Paulo', lat:-23.70, lng:-46.70,
    sessions:{ fp1:'2026-11-06T14:30Z', fp2:'2026-11-06T18:00Z', fp3:'2026-11-07T14:30Z', quali:'2026-11-07T18:00Z', race:'2026-11-08T17:00Z' } },

  // R22 Las Vegas SAT race (F1+F1A) ‚Äì PST(UTC-8)
  { city: 'Las Vegas Strip Circuit', country: 'USA', region: 'Las Vegas GP', round:22, series:['f1','f1a'], tz:'America/Los_Angeles', lat:36.11, lng:-115.17,
    sessions:{ fp1:'2026-11-20T07:00Z', fp2:'2026-11-20T11:00Z', quali:'2026-11-21T06:00Z', race:'2026-11-22T04:00Z' },
    f1aSessions:{ quali:'2026-11-20T13:00Z', race1:'2026-11-21T03:30Z', race2:'2026-11-22T02:00Z' } },

  // R23 Qatar (F1+F2) ‚Äì AST(UTC+3)
  { city: 'Lusail Circuit', country: 'Qatar', region: 'Qatar GP', round:23, series:['f1','f2'], tz:'Asia/Qatar', lat:25.49, lng:51.45,
    sessions:{ fp1:'2026-11-27T12:30Z', fp2:'2026-11-27T16:00Z', fp3:'2026-11-28T12:30Z', quali:'2026-11-28T15:00Z', race:'2026-11-29T16:00Z' },
    f2Sessions:{ fp:'2026-11-27T10:00Z', quali:'2026-11-27T13:30Z', sprint:'2026-11-28T10:00Z', feature:'2026-11-29T11:30Z' } },

  // R24 Abu Dhabi (F1+F2) ‚Äì GST(UTC+4)
  { city: 'Yas Marina Circuit', country: 'UAE', region: 'Abu Dhabi GP', round:24, series:['f1','f2'], tz:'Asia/Dubai', lat:24.47, lng:54.60,
    sessions:{ fp1:'2026-12-04T10:30Z', fp2:'2026-12-04T14:00Z', fp3:'2026-12-05T10:30Z', quali:'2026-12-05T12:00Z', race:'2026-12-06T13:00Z' },
    f2Sessions:{ fp:'2026-12-04T08:00Z', quali:'2026-12-04T11:30Z', sprint:'2026-12-05T08:00Z', feature:'2026-12-06T09:30Z' } },

  // ‚îÄ‚îÄ FORMULA E 2025/26 SEASON 12 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // Venues not shared with F1. FE race UTC times from fiaformulae.com / e-formula.news
  // Standard FE race start: ~14:00-15:00 local. Using confirmed times where available.
  // Jeddah, Monaco, Miami, Mexico City, Shanghai are shared with F1 entries above.

  // R1 FE S√£o Paulo ‚Äì 6 Dec 2025 ~14:00 BRT (UTC-3) = 17:00Z
  { city: 'Sambadrome', country: 'Brazil', region: 'S√£o Paulo E-Prix', round:'FE-1', series:['fe'], tz:'America/Sao_Paulo', lat:-23.49, lng:-46.63,
    sessions:{ race:'2025-12-06T17:00Z' } },

  // R3 FE Miami ‚Äì 31 Jan 2026 ~14:00 EST (UTC-5) = 19:00Z  (Miami Int'l Autodrome ‚Äî shared venue with F1 R6)
  // Already added 'fe' to Miami F1 entry above. No separate dot needed.

  // R4+5 FE Jeddah ‚Äì 13-14 Feb 2026 20:05 AST (UTC+3) = 17:05Z confirmed
  // Already added 'fe' to Jeddah F1 entry above.

  // R6 FE Madrid/Jarama ‚Äì 21 Mar 2026 ~14:00 CET (UTC+1) = 13:00Z
  { city: 'Circuito de Madrid-Jarama', country: 'Spain', region: 'Madrid E-Prix', round:'FE-6', series:['fe'], tz:'Europe/Madrid', lat:40.62, lng:-3.59,
    sessions:{ race:'2026-03-21T13:00Z' } },

  // R7+8 FE Berlin ‚Äì 2-3 May 2026 ~14:00 CEST (UTC+2) = 12:00Z
  { city: 'Tempelhof Airport', country: 'Germany', region: 'Berlin E-Prix', round:'FE-7', series:['fe'], tz:'Europe/Berlin', lat:52.47, lng:13.40,
    sessions:{ race:'2026-05-02T12:00Z', race2:'2026-05-03T12:00Z' } },

  // R9+10 FE Monaco ‚Äì 16-17 May 2026  (shared with F1 R8 ‚Äî already added 'fe')

  // R11 FE Sanya ‚Äì 20 Jun 2026 ~14:00 CST (UTC+8) = 06:00Z
  { city: 'Sanya Street Circuit', country: 'China', region: 'Sanya E-Prix', round:'FE-11', series:['fe'], tz:'Asia/Shanghai', lat:18.26, lng:109.51,
    sessions:{ race:'2026-06-20T06:00Z' } },

  // R12+13 FE Shanghai ‚Äì 4-5 Jul 2026  (shared with F1 R2 ‚Äî already added 'fe')

  // R14+15 FE Tokyo ‚Äì 25-26 Jul 2026 ~14:00 JST (UTC+9) = 05:00Z
  { city: 'Tokyo Street Circuit', country: 'Japan', region: 'Tokyo E-Prix', round:'FE-14', series:['fe'], tz:'Asia/Tokyo', lat:35.67, lng:139.77,
    sessions:{ race:'2026-07-25T05:00Z', race2:'2026-07-26T05:00Z' } },

  // R16+17 FE London ‚Äì 15-16 Aug 2026 ~15:00 BST (UTC+1) = 14:00Z
  { city: 'ExCeL London', country: 'United Kingdom', region: 'London E-Prix', round:'FE-16', series:['fe'], tz:'Europe/London', lat:51.51, lng:0.03,
    sessions:{ race:'2026-08-15T14:00Z', race2:'2026-08-16T14:00Z' } },

  // ‚îÄ‚îÄ INDYCAR 2026 SEASON ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // 18 races. Race UTC times from indycar.com official schedule (ET broadcast times).
  // ET = UTC-5 (standard) or UTC-4 (daylight). US DST starts Mar 8, ends Nov 1.

  // R1 St. Petersburg ‚Äì Sun 1 Mar, 12:00 ET (EST UTC-5) = 17:00Z
  { city: 'Streets of St. Petersburg', country: 'USA', region: 'Grand Prix of St. Petersburg', round:'IC-1', series:['indy'], tz:'America/New_York', lat:27.77, lng:-82.64,
    sessions:{ race:'2026-03-01T17:00Z' } },

  // R2 Phoenix ‚Äì Sat 7 Mar, 15:00 ET (MST UTC-7, no DST) = 22:00Z
  { city: 'Phoenix Raceway', country: 'USA', region: 'Grand Prix of Phoenix', round:'IC-2', series:['indy'], tz:'America/Phoenix', lat:33.37, lng:-112.31,
    sessions:{ race:'2026-03-07T22:00Z' } },

  // R3 Arlington ‚Äì Sun 15 Mar, 12:30 ET (CDT UTC-5 after DST Mar 8) = 17:30Z
  { city: 'Streets of Arlington', country: 'USA', region: 'Grand Prix of Arlington', round:'IC-3', series:['indy'], tz:'America/Chicago', lat:32.75, lng:-97.09,
    sessions:{ race:'2026-03-15T17:30Z' } },

  // R4 Barber ‚Äì Sun 29 Mar, 13:00 ET (EDT UTC-4) = 17:00Z
  { city: 'Barber Motorsports Park', country: 'USA', region: 'Honda Indy Grand Prix of Alabama', round:'IC-4', series:['indy'], tz:'America/New_York', lat:33.56, lng:-86.44,
    sessions:{ race:'2026-03-29T17:00Z' } },

  // R5 Long Beach ‚Äì Sun 19 Apr, 17:30 ET (EDT UTC-4) = 21:30Z
  { city: 'Streets of Long Beach', country: 'USA', region: 'Acura Grand Prix of Long Beach', round:'IC-5', series:['indy'], tz:'America/Los_Angeles', lat:33.76, lng:-118.19,
    sessions:{ race:'2026-04-19T21:30Z' } },

  // R6 IMS Road Course ‚Äì Sat 9 May, 16:30 ET (EDT UTC-4) = 20:30Z
  { city: 'IMS Road Course', country: 'USA', region: 'Sonsio Grand Prix at IMS', round:'IC-6', series:['indy'], tz:'America/New_York', lat:39.79, lng:-86.24,
    sessions:{ race:'2026-05-09T20:30Z' } },

  // R7 Indianapolis 500 ‚Äì Sun 24 May, ~12:00 ET (EDT UTC-4) = 16:00Z
  { city: 'Indianapolis Motor Speedway', country: 'USA', region: '110th Indianapolis 500', round:'IC-7', series:['indy'], tz:'America/New_York', lat:39.79, lng:-86.24,
    sessions:{ race:'2026-05-24T16:00Z' } },

  // R8 Detroit ‚Äì Sun 31 May, 10:30 ET (EDT UTC-4) = 14:30Z
  { city: 'Streets of Detroit', country: 'USA', region: 'Detroit Grand Prix', round:'IC-8', series:['indy'], tz:'America/New_York', lat:42.33, lng:-83.05,
    sessions:{ race:'2026-05-31T14:30Z' } },

  // R9 Gateway (WWT Raceway) ‚Äì Sat 6 Jun, 17:30 ET (CDT UTC-5) = 22:30Z
  { city: 'World Wide Technology Raceway', country: 'USA', region: 'Bommarito Automotive Group 500', round:'IC-9', series:['indy'], tz:'America/Chicago', lat:38.64, lng:-90.16,
    sessions:{ race:'2026-06-06T22:30Z' } },

  // R10 Road America ‚Äì Sat 20 Jun, 12:30 ET (CDT UTC-5) = 17:30Z
  { city: 'Road America', country: 'USA', region: 'REV Group Grand Prix', round:'IC-10', series:['indy'], tz:'America/Chicago', lat:43.80, lng:-87.99,
    sessions:{ race:'2026-06-20T17:30Z' } },

  // R11 Mid-Ohio ‚Äì Sat 4 Jul, 13:00 ET (EDT UTC-4) = 17:00Z
  { city: 'Mid-Ohio Sports Car Course', country: 'USA', region: 'Honda Indy 200 at Mid-Ohio', round:'IC-11', series:['indy'], tz:'America/New_York', lat:40.69, lng:-82.65,
    sessions:{ race:'2026-07-04T17:00Z' } },

  // R12 Nashville ‚Äì Sat 19 Jul, TBD ET ~20:00 (CDT UTC-5) = ~01:00Z Sun
  { city: 'Nashville Superspeedway', country: 'USA', region: 'Music City Grand Prix', round:'IC-12', series:['indy'], tz:'America/Chicago', lat:36.18, lng:-86.26,
    sessions:{ race:'2026-07-20T01:00Z' } },

  // R13 Portland ‚Äì Sun 9 Aug, 14:00 ET (PDT UTC-7) = 21:00Z
  { city: 'Portland International Raceway', country: 'USA', region: 'Grand Prix of Portland', round:'IC-13', series:['indy'], tz:'America/Los_Angeles', lat:45.60, lng:-122.69,
    sessions:{ race:'2026-08-09T21:00Z' } },

  // R14 Markham (Canada) ‚Äì Sun 16 Aug, 12:00 ET (EDT UTC-4) = 16:00Z
  { city: 'Streets of Markham', country: 'Canada', region: 'Honda Indy Toronto (Markham)', round:'IC-14', series:['indy'], tz:'America/Toronto', lat:43.86, lng:-79.34,
    sessions:{ race:'2026-08-16T16:00Z' } },

  // R15 Milwaukee ‚Äì Sat 29 Aug, 14:30 ET (CDT UTC-5) = 19:30Z (race 1)
  { city: 'Milwaukee Mile', country: 'USA', region: 'Hy-Vee Milwaukee Mile 250s', round:'IC-15', series:['indy'], tz:'America/Chicago', lat:43.01, lng:-88.02,
    sessions:{ race:'2026-08-29T19:30Z', race2:'2026-08-30T18:00Z' } },

  // R16 Freedom 250 Washington D.C. ‚Äì Sun 23 Aug, ~13:00 ET (EDT UTC-4) = 17:00Z
  { city: 'National Mall Circuit', country: 'USA', region: 'Freedom 250 Grand Prix', round:'IC-16', series:['indy'], tz:'America/New_York', lat:38.89, lng:-77.03,
    sessions:{ race:'2026-08-23T17:00Z' } },

  // R17 Laguna Seca ‚Äì Sun 6 Sep, 14:30 ET (PDT UTC-7) = 21:30Z
  { city: 'WeatherTech Raceway Laguna Seca', country: 'USA', region: 'Firestone Grand Prix of Monterey', round:'IC-17', series:['indy'], tz:'America/Los_Angeles', lat:36.58, lng:-121.75,
    sessions:{ race:'2026-09-06T21:30Z' } },

  // ‚îÄ‚îÄ WEC 2026 FIA WORLD ENDURANCE CHAMPIONSHIP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // 8 rounds. Race start UTC times (approximate from official schedule).
  // Qatar 1812km ‚Äì Jan 2026 / Sebring 1000 Miles ‚Äì Mar / Portim√£o 6h ‚Äì Apr /
  // Spa 6h ‚Äì May / Le Mans 24h ‚Äì Jun / Monza 6h ‚Äì Jul /
  // S√£o Paulo 6h ‚Äì Sep / Bahrain 8h ‚Äì Nov

  // R1 WEC Qatar ‚Äì 24 Jan 2026 ~16:00 AST (UTC+3) = 13:00Z (1812 km)
  { city: 'Lusail International Circuit', country: 'Qatar', region: 'Qatar 1812km', round:'WEC-1', series:['wec'], tz:'Asia/Qatar', lat:25.49, lng:51.45,
    sessions:{ race:'2026-01-24T13:00Z' } },

  // R2 WEC Sebring ‚Äì 14 Mar 2026 ~12:00 EDT (UTC-4) = 16:00Z (1000 Miles)
  { city: 'Sebring International Raceway', country: 'USA', region: 'Sebring 1000 Miles', round:'WEC-2', series:['wec'], tz:'America/New_York', lat:27.45, lng:-81.35,
    sessions:{ race:'2026-03-14T16:00Z' } },

  // R3 WEC Portim√£o ‚Äì 12 Apr 2026 ~12:00 WEST (UTC+1) = 11:00Z (6 Hours)
  { city: 'Algarve International Circuit', country: 'Portugal', region: 'Portim√£o 6 Hours', round:'WEC-3', series:['wec'], tz:'Europe/Lisbon', lat:37.23, lng:-8.63,
    sessions:{ race:'2026-04-12T11:00Z' } },

  // R4 WEC Spa ‚Äì 2 May 2026 ~14:00 CEST (UTC+2) = 12:00Z (6 Hours)
  { city: 'Circuit de Spa-Francorchamps', country: 'Belgium', region: 'Spa 6 Hours', round:'WEC-4', series:['wec'], tz:'Europe/Brussels', lat:50.44, lng:5.97,
    sessions:{ race:'2026-05-02T12:00Z' } },

  // R5 WEC Le Mans ‚Äì 13 Jun 2026 ~16:00 CEST (UTC+2) = 14:00Z (24 Hours ‚Äî finishes Sun 15 Jun)
  { city: 'Circuit de la Sarthe', country: 'France', region: 'Le Mans 24 Hours', round:'WEC-5', series:['wec'], tz:'Europe/Paris', lat:47.95, lng:0.21,
    sessions:{ race:'2026-06-13T14:00Z' } },

  // R6 WEC Monza ‚Äì 12 Jul 2026 ~12:00 CEST (UTC+2) = 10:00Z (6 Hours)
  { city: 'Autodromo Nazionale Monza', country: 'Italy', region: 'Monza 6 Hours', round:'WEC-6', series:['wec'], tz:'Europe/Rome', lat:45.62, lng:9.28,
    sessions:{ race:'2026-07-12T10:00Z' } },

  // R7 WEC S√£o Paulo ‚Äì 13 Sep 2026 ~13:00 BRT (UTC-3) = 16:00Z (6 Hours)
  { city: 'Aut√≥dromo Jos√© Carlos Pace', country: 'Brazil', region: 'S√£o Paulo 6 Hours', round:'WEC-7', series:['wec'], tz:'America/Sao_Paulo', lat:-23.70, lng:-46.70,
    sessions:{ race:'2026-09-13T16:00Z' } },

  // R8 WEC Bahrain ‚Äì 14 Nov 2026 ~17:00 AST (UTC+3) = 14:00Z (8 Hours)
  { city: 'Bahrain International Circuit', country: 'Bahrain', region: 'Bahrain 8 Hours', round:'WEC-8', series:['wec'], tz:'Asia/Bahrain', lat:26.03, lng:50.51,
    sessions:{ race:'2026-11-14T14:00Z' } },

  // ‚îÄ‚îÄ WRC 2026 FIA WORLD RALLY CHAMPIONSHIP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // 13 rounds. "race" = Power Stage Sunday (final competitive stage).
  // Times are approximate SS start times converted to UTC.
  // Sources: WRC official 2026 calendar

  // R1 WRC Monte Carlo ‚Äì 22-25 Jan 2026. Power Stage Sun 25 Jan ~13:00 CET (UTC+1) = 12:00Z
  { city: 'Monte Carlo', country: 'Monaco', region: 'Rally Monte Carlo', round:'WRC-1', series:['wrc'], tz:'Europe/Monaco', lat:43.74, lng:7.43,
    sessions:{ race:'2026-01-25T12:00Z' } },

  // R2 WRC Sweden ‚Äì 12-15 Feb 2026. Power Stage Sun 15 Feb ~13:00 CET (UTC+1) = 12:00Z
  { city: 'Ume√•', country: 'Sweden', region: 'Rally Sweden', round:'WRC-2', series:['wrc'], tz:'Europe/Stockholm', lat:63.82, lng:20.26,
    sessions:{ race:'2026-02-15T12:00Z' } },

  // R3 WRC Safari Kenya ‚Äì 26 Feb‚Äì1 Mar 2026. Power Stage Sun 1 Mar ~11:00 EAT (UTC+3) = 08:00Z
  { city: 'Nairobi', country: 'Kenya', region: 'Safari Rally Kenya', round:'WRC-3', series:['wrc'], tz:'Africa/Nairobi', lat:-1.29, lng:36.82,
    sessions:{ race:'2026-03-01T08:00Z' } },

  // R4 WRC Croatia ‚Äì 23-26 Apr 2026. Power Stage Sun 26 Apr ~13:00 CEST (UTC+2) = 11:00Z
  { city: 'Zagreb', country: 'Croatia', region: 'Rally Croatia', round:'WRC-4', series:['wrc'], tz:'Europe/Zagreb', lat:45.81, lng:15.98,
    sessions:{ race:'2026-04-26T11:00Z' } },

  // R5 WRC Portugal ‚Äì 21-24 May 2026. Power Stage Sun 24 May ~14:30 WEST (UTC+1) = 13:30Z
  { city: 'Matosinhos', country: 'Portugal', region: 'Rally de Portugal', round:'WRC-5', series:['wrc'], tz:'Europe/Lisbon', lat:41.18, lng:-8.69,
    sessions:{ race:'2026-05-24T13:30Z' } },

  // R6 WRC Sardinia ‚Äì 4-7 Jun 2026. Power Stage Sun 7 Jun ~14:00 CEST (UTC+2) = 12:00Z
  { city: 'Alghero', country: 'Italy', region: 'Rally Italia Sardegna', round:'WRC-6', series:['wrc'], tz:'Europe/Rome', lat:40.56, lng:8.32,
    sessions:{ race:'2026-06-07T12:00Z' } },

  // R7 WRC Poland ‚Äì 25-28 Jun 2026. Power Stage Sun 28 Jun ~13:00 CEST (UTC+2) = 11:00Z
  { city: 'Miko≈Çajki', country: 'Poland', region: 'Rally Poland', round:'WRC-7', series:['wrc'], tz:'Europe/Warsaw', lat:53.79, lng:21.57,
    sessions:{ race:'2026-06-28T11:00Z' } },

  // R8 WRC Estonia ‚Äì 16-19 Jul 2026. Power Stage Sun 19 Jul ~14:00 EEST (UTC+3) = 11:00Z
  { city: 'Tartu', country: 'Estonia', region: 'Rally Estonia', round:'WRC-8', series:['wrc'], tz:'Europe/Tallinn', lat:58.37, lng:26.73,
    sessions:{ race:'2026-07-19T11:00Z' } },

  // R9 WRC Finland ‚Äì 30 Jul‚Äì2 Aug 2026. Power Stage Sun 2 Aug ~14:00 EEST (UTC+3) = 11:00Z
  { city: 'Jyv√§skyl√§', country: 'Finland', region: 'Rally Finland', round:'WRC-9', series:['wrc'], tz:'Europe/Helsinki', lat:62.24, lng:25.75,
    sessions:{ race:'2026-08-02T11:00Z' } },

  // R10 WRC Greece ‚Äì 3-6 Sep 2026. Power Stage Sun 6 Sep ~14:00 EEST (UTC+3) = 11:00Z
  { city: 'Lamia', country: 'Greece', region: 'Acropolis Rally Greece', round:'WRC-10', series:['wrc'], tz:'Europe/Athens', lat:38.90, lng:22.43,
    sessions:{ race:'2026-09-06T11:00Z' } },

  // R11 WRC Chile ‚Äì 24-27 Sep 2026. Power Stage Sun 27 Sep ~14:00 CLT (UTC-3) = 17:00Z
  { city: 'Concepci√≥n', country: 'Chile', region: 'Rally Chile Bio B√≠o', round:'WRC-11', series:['wrc'], tz:'America/Santiago', lat:-36.82, lng:-73.04,
    sessions:{ race:'2026-09-27T17:00Z' } },

  // R12 WRC Japan ‚Äì 29 Oct‚Äì1 Nov 2026. Power Stage Sun 1 Nov ~13:00 JST (UTC+9) = 04:00Z
  { city: 'Toyota City', country: 'Japan', region: 'Rally Japan', round:'WRC-12', series:['wrc'], tz:'Asia/Tokyo', lat:35.08, lng:137.16,
    sessions:{ race:'2026-11-01T04:00Z' } },

  // R13 WRC Central Europe ‚Äì 19-22 Nov 2026. Power Stage Sun 22 Nov ~13:00 CET (UTC+1) = 12:00Z
  { city: 'Passau', country: 'Germany', region: 'Rally Central Europe', round:'WRC-13', series:['wrc'], tz:'Europe/Berlin', lat:48.57, lng:13.45,
    sessions:{ race:'2026-11-22T12:00Z' } },

];


// Time formatters
const timeFmt = {}, dateFmt = {};
cities.forEach(c => {
  timeFmt[c.tz] = new Intl.DateTimeFormat('en-GB', { timeZone: c.tz, hour:'2-digit', minute:'2-digit', second:'2-digit', hour12: false });
  dateFmt[c.tz] = new Intl.DateTimeFormat('en-GB', { timeZone: c.tz, weekday:'short', day:'numeric', month:'short' });
});

function getPhase(tz) {
  const h = parseInt(new Intl.DateTimeFormat('en-GB', { timeZone: tz, hour:'numeric', hour12:false }).format(new Date()));
  if (h >= 6 && h < 8) return 'dawn';
  if (h >= 8 && h < 18) return 'day';
  if (h >= 18 && h < 20) return 'dusk';
  return 'night';
}
function phaseLabel(p) { return {day:'Day',night:'Night',dawn:'Dawn',dusk:'Dusk'}[p]; }
function getOffset(tz) {
  const parts = new Intl.DateTimeFormat('en',{timeZone:tz,timeZoneName:'shortOffset'}).formatToParts(new Date());
  return parts.find(p=>p.type==='timeZoneName')?.value||'';
}

// ‚îÄ‚îÄ‚îÄ THREE.JS GLOBE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const container = document.getElementById('canvas-wrapper');
const W = () => container.clientWidth;
const H = () => container.clientHeight;

const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
renderer.setPixelRatio(window.devicePixelRatio);
renderer.setSize(W(), H());
renderer.setClearColor(0x000000, 0);
container.appendChild(renderer.domElement);

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(45, W() / H(), 0.1, 1000);
camera.position.z = 3.2;

// Stars background
const starGeo = new THREE.BufferGeometry();
const starCount = 2000;
const starPos = new Float32Array(starCount * 3);
for (let i = 0; i < starCount * 3; i++) starPos[i] = (Math.random() - 0.5) * 200;
starGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
const starMat = new THREE.PointsMaterial({ color: 0xffffff, size: 0.12, transparent: true, opacity: 0.5 });
scene.add(new THREE.Points(starGeo, starMat));

// Globe sphere
const globeRadius = 1.0;
const sphereGeo = new THREE.SphereGeometry(globeRadius, 64, 64);

// Load real Earth textures from public CDN
const texLoader = new THREE.TextureLoader();

// We'll use Natural Earth II styled textures from a reliable public source
// These are the NASA Blue Marble / Natural Earth textures
const EARTH_DAY   = 'https://cdn.jsdelivr.net/npm/three-globe/example/img/earth-blue-marble.jpg';
const EARTH_BUMP  = 'https://cdn.jsdelivr.net/npm/three-globe/example/img/earth-topology.png';
const EARTH_SPEC  = 'https://cdn.jsdelivr.net/npm/three-globe/example/img/earth-water.png';
const EARTH_NIGHT = 'https://cdn.jsdelivr.net/npm/three-globe/example/img/earth-night.jpg';

// Show loading indicator
const loadingEl = document.createElement('div');
loadingEl.id = 'loading';
loadingEl.innerHTML = `<div style="
  position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  font-family:'DM Mono',monospace;font-size:0.7rem;letter-spacing:0.15em;
  text-transform:uppercase;color:rgba(200,255,0,0.6);text-align:center;
">
  <div style="margin-bottom:0.5rem">Loading globe textures‚Ä¶</div>
  <div style="width:120px;height:2px;background:rgba(255,255,255,0.1);margin:0 auto;overflow:hidden">
    <div id="load-bar" style="width:0%;height:100%;background:#c8ff00;transition:width 0.3s"></div>
  </div>
</div>`;
loadingEl.style.cssText = 'position:absolute;inset:0;z-index:20;pointer-events:none;';
document.getElementById('globe-container').appendChild(loadingEl);

let loadedCount = 0;
function onTexLoaded() {
  loadedCount++;
  const pct = (loadedCount / 4) * 100;
  const bar = document.getElementById('load-bar');
  if (bar) bar.style.width = pct + '%';
  if (loadedCount === 4) {
    setTimeout(() => {
      loadingEl.style.transition = 'opacity 0.5s';
      loadingEl.style.opacity = '0';
      setTimeout(() => loadingEl.remove(), 500);
    }, 200);
  }
}

const dayTex   = texLoader.load(EARTH_DAY,   onTexLoaded, undefined, onTexLoaded);
const bumpTex  = texLoader.load(EARTH_BUMP,  onTexLoaded, undefined, onTexLoaded);
const specTex  = texLoader.load(EARTH_SPEC,  onTexLoaded, undefined, onTexLoaded);
const nightTex = texLoader.load(EARTH_NIGHT, onTexLoaded, undefined, onTexLoaded);

// Custom shader material that blends day/night based on sun angle
const globeMat = new THREE.ShaderMaterial({
  uniforms: {
    dayTexture:   { value: dayTex },
    nightTexture: { value: nightTex },
    bumpTexture:  { value: bumpTex },
    specTexture:  { value: specTex },
    sunDirection: { value: new THREE.Vector3(1, 0.3, 1).normalize() },
  },
  vertexShader: `
    varying vec2 vUv;
    varying vec3 vNormal;
    varying vec3 vWorldNormal;
    void main() {
      vUv = uv;
      vNormal = normalMatrix * normal;
      vWorldNormal = (modelMatrix * vec4(normal, 0.0)).xyz;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,
  fragmentShader: `
    uniform sampler2D dayTexture;
    uniform sampler2D nightTexture;
    uniform sampler2D bumpTexture;
    uniform sampler2D specTexture;
    uniform vec3 sunDirection;
    varying vec2 vUv;
    varying vec3 vNormal;
    varying vec3 vWorldNormal;

    void main() {
      vec3 norm = normalize(vWorldNormal);
      float sunDot = dot(norm, normalize(sunDirection));

      // Sample textures
      vec4 day   = texture2D(dayTexture,   vUv);
      vec4 night = texture2D(nightTexture, vUv);
      vec4 spec  = texture2D(specTexture,  vUv); // water mask

      // Blend day/night with a soft terminator
      float blend = smoothstep(-0.1, 0.35, sunDot);

      // Darken land on night side, keep city lights from night map
      vec4 color = mix(night * 1.2, day, blend);

      // Add slight specular highlight on water (spec map is white on water)
      float waterMask = spec.r;
      float specular = pow(max(0.0, dot(norm, normalize(sunDirection + vec3(0,0,1)))), 20.0);
      color.rgb += waterMask * specular * 0.3 * blend;

      // Subtle atmosphere limb darkening
      float limb = 1.0 - abs(dot(normalize(vNormal), vec3(0,0,1)));
      color.rgb = mix(color.rgb, color.rgb * 0.6, limb * 0.3);

      gl_FragColor = color;
    }
  `,
});

const globe = new THREE.Mesh(sphereGeo, globeMat);
scene.add(globe);

// Atmosphere glow ‚Äî thicker, more beautiful limb glow
const atmGeo = new THREE.SphereGeometry(globeRadius * 1.025, 64, 64);
const atmMat = new THREE.ShaderMaterial({
  uniforms: {
    sunDirection: { value: new THREE.Vector3(1, 0.3, 1).normalize() },
  },
  vertexShader: `
    varying vec3 vNormal;
    varying vec3 vWorldNormal;
    void main() {
      vNormal = normalMatrix * normal;
      vWorldNormal = (modelMatrix * vec4(normal, 0.0)).xyz;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,
  fragmentShader: `
    uniform vec3 sunDirection;
    varying vec3 vNormal;
    varying vec3 vWorldNormal;
    void main() {
      float intensity = pow(0.65 - dot(normalize(vNormal), vec3(0,0,1)), 4.0);
      float sunDot = dot(normalize(vWorldNormal), normalize(sunDirection));
      vec3 atmColor = mix(vec3(0.1, 0.3, 0.9), vec3(0.2, 0.6, 1.0), max(0.0, sunDot));
      gl_FragColor = vec4(atmColor, intensity * 0.7);
    }
  `,
  side: THREE.FrontSide,
  transparent: true,
  depthWrite: false,
  blending: THREE.AdditiveBlending,
});
scene.add(new THREE.Mesh(atmGeo, atmMat));

// Subtle ambient so scene isn't too dark
scene.add(new THREE.AmbientLight(0x111122, 0.4));

// Convert lat/lng to 3D position on sphere
function latLngTo3D(lat, lng, r) {
  const phi = (90 - lat) * (Math.PI / 180);
  const theta = (lng + 180) * (Math.PI / 180);
  return new THREE.Vector3(
    -r * Math.sin(phi) * Math.cos(theta),
     r * Math.cos(phi),
     r * Math.sin(phi) * Math.sin(theta)
  );
}

// City dot colours
function phaseColor(phase) {
  return { day: 0xc8ff00, dawn: 0xff9500, dusk: 0xff6b35, night: 0x6666bb }[phase];
}

// City markers on globe
const cityMeshes = [];
const dotGeo = new THREE.SphereGeometry(0.018, 10, 10);

// Pulse ring for selected city ‚Äî a flat torus that scales out and fades
const ringMeshes = [];
const ringGeo = new THREE.RingGeometry(0.018, 0.028, 32);
let selectedCityIdx = -1;
let pulseT = 0; // 0..1 animation progress, loops

cities.forEach((c, i) => {
  const phase = getPhase(c.tz);
  const mat = new THREE.MeshBasicMaterial({ color: phaseColor(phase) });
  const dot = new THREE.Mesh(dotGeo, mat);
  const pos = latLngTo3D(c.lat, c.lng, globeRadius + 0.012);
  dot.position.copy(pos);
  dot.userData = { cityIndex: i };
  globe.add(dot);
  cityMeshes.push(dot);

  // Ring sits at same position, faces outward (lookAt from globe centre)
  const ringMat = new THREE.MeshBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0, side: THREE.DoubleSide, depthWrite: false });
  const ring = new THREE.Mesh(ringGeo, ringMat);
  ring.position.copy(pos);
  // Orient ring to face outward (normal = pos direction)
  ring.quaternion.setFromUnitVectors(new THREE.Vector3(0,0,1), pos.clone().normalize());
  ring.visible = false;
  globe.add(ring);
  ringMeshes.push(ring);
});

// Raycaster for click/hover
const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();

// Drag rotation
let isDragging = false;
let prevMouse = { x: 0, y: 0 };
let rotVel = { x: 0, y: 0 };
let autoRotate = true;

container.addEventListener('mousedown', e => {
  isDragging = true;
  autoRotate = false;
  prevMouse = { x: e.clientX, y: e.clientY };
  rotVel = { x: 0, y: 0 };
});

container.addEventListener('mousemove', e => {
  if (isDragging) {
    const dx = e.clientX - prevMouse.x;
    const dy = e.clientY - prevMouse.y;
    rotVel.x = dy * 0.005;
    rotVel.y = dx * 0.005;
    globe.rotation.x += rotVel.x;
    globe.rotation.y += rotVel.y;
    prevMouse = { x: e.clientX, y: e.clientY };
    hideTooltip();
    return;
  }

  // Hover detection
  const rect = container.getBoundingClientRect();
  mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
  mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;
  raycaster.setFromCamera(mouse, camera);
  const hits = raycaster.intersectObjects(cityMeshes);
  if (hits.length > 0) {
    container.style.cursor = 'pointer';
    const idx = hits[0].object.userData.cityIndex;
    showTooltip(idx, e.clientX - rect.left, e.clientY - rect.top);
    highlightSidebar(idx);
  } else {
    container.style.cursor = isDragging ? 'grabbing' : 'grab';
    hideTooltip();
  }
});

container.addEventListener('mouseup', e => {
  if (!isDragging) return;
  isDragging = false;
  // Always hide tooltip on click
  hideTooltip();
  // Click detection ‚Äî only fire if mouse barely moved (not a drag)
  const rect = container.getBoundingClientRect();
  mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
  mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;
  raycaster.setFromCamera(mouse, camera);
  const hits = raycaster.intersectObjects(cityMeshes);
  if (hits.length > 0) {
    const idx = hits[0].object.userData.cityIndex;
    highlightSidebar(idx);
    openSessionPanel(idx);
  }
});


container.addEventListener('mouseleave', () => { isDragging = false; });

// Touch support
let lastTouch = null;
container.addEventListener('touchstart', e => {
  isDragging = true; autoRotate = false;
  lastTouch = { x: e.touches[0].clientX, y: e.touches[0].clientY };
  rotVel = { x: 0, y: 0 };
});
container.addEventListener('touchmove', e => {
  e.preventDefault();
  if (!isDragging || !lastTouch) return;
  const dx = e.touches[0].clientX - lastTouch.x;
  const dy = e.touches[0].clientY - lastTouch.y;
  rotVel.x = dy * 0.005;
  rotVel.y = dx * 0.005;
  globe.rotation.x += rotVel.x;
  globe.rotation.y += rotVel.y;
  lastTouch = { x: e.touches[0].clientX, y: e.touches[0].clientY };
}, { passive: false });
container.addEventListener('touchend', e => {
  isDragging = false;
  if (!lastTouch) return;
  // Tap detection ‚Äî only fire if finger barely moved (not a drag)
  const touch = e.changedTouches[0];
  const dx = touch.clientX - lastTouch.x;
  const dy = touch.clientY - lastTouch.y;
  if (Math.abs(dx) > 10 || Math.abs(dy) > 10) return; // was a drag, not a tap
  const rect = container.getBoundingClientRect();
  mouse.x = ((touch.clientX - rect.left) / rect.width) * 2 - 1;
  mouse.y = -((touch.clientY - rect.top) / rect.height) * 2 + 1;
  raycaster.setFromCamera(mouse, camera);
  const hits = raycaster.intersectObjects(cityMeshes);
  if (hits.length > 0) {
    const idx = hits[0].object.userData.cityIndex;
    // If this city's panel is already open, close it; otherwise open the new one
    if (activePanelCity === idx && sessionPanel.classList.contains('open')) {
      closeSessionPanel();
    } else {
      highlightSidebar(idx);
      openSessionPanel(idx);
    }
  } else if (sessionPanel.classList.contains('open')) {
    closeSessionPanel();
  }
});

// Scroll to zoom
container.addEventListener('wheel', e => {
  // Don't zoom if the scroll originated inside the session panel
  if (e.target.closest('#session-panel')) return;
  camera.position.z = Math.max(1.5, Math.min(5, camera.position.z + e.deltaY * 0.003));
});

// ‚îÄ‚îÄ‚îÄ BADGE HELPER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function seriesBadgesHTML(series) {
  const labels = { f1: 'F1', f2: 'F2', f3: 'F3', f1a: 'F1 Academy', fe: 'Formula E', indy: 'IndyCar', wec: 'WEC', wrc: 'WRC' };
  return series.filter(s => isSeriesEnabled(s)).map(s => `<span class="badge badge-${s}">${labels[s]}</span>`).join('');
}

// ‚îÄ‚îÄ‚îÄ SESSION HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SESSION_LABELS = () => ({
  fp1:t('s_fp1'), fp2:t('s_fp2'), fp3:t('s_fp3'),
  sq:t('s_sq'), sprint:t('s_sprint'),
  quali:t('s_quali'), race:t('s_race')
});
const SESSION_ORDER = ['fp1','fp2','sq','fp3','sprint','quali','race'];

const localSessionFmt = new Intl.DateTimeFormat('en-GB', {
  weekday:'short', month:'short', day:'numeric',
  hour:'2-digit', minute:'2-digit', hour12:false
});
function fmtLocal(utcStr) { return localSessionFmt.format(new Date(utcStr)); }

function formatCountdown(ms, shortForm) {
  if (ms <= 0) return null;
  const totalSec = Math.floor(ms / 1000);
  const d = Math.floor(totalSec / 86400);
  const h = Math.floor((totalSec % 86400) / 3600);
  const m = Math.floor((totalSec % 3600) / 60);
  const s = totalSec % 60;
  const D = t('cd_d'), H = t('cd_h'), M = t('cd_m');
  if (shortForm && d > 0) return `${d}${D}`;
  if (d > 0) return `${d}${D} ${String(h).padStart(2,'0')}${H} ${String(m).padStart(2,'0')}${M}`;
  return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

function daysUntilRace(utcStr) {
  const ms = new Date(utcStr) - Date.now();
  if (ms <= 0) return t('race_done_short');
  const days = Math.ceil(ms / 86400000);
  if (days === 1) return `1 ${t('day_singular')}`;
  return `${days} ${t('day_plural')}`;
}

// ‚îÄ‚îÄ‚îÄ FIND NEXT RACES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getNextOf(seriesKey) {
  const now = Date.now();
  const venues = cities.filter(c => c.series.includes(seriesKey));
  // For FE, use feSessions.race if available (shared venues with F1), else sessions.race
  const getDate = c => {
    if (seriesKey === 'fe' && c.feSessions && c.feSessions.race) return new Date(c.feSessions.race);
    return new Date(c.sessions.race);
  };
  // Sort by race date to get chronological order
  const sorted = [...venues].sort((a, b) => getDate(a) - getDate(b));
  return sorted.find(c => getDate(c).getTime() > now) || sorted[sorted.length - 1];
}

// Find the index of a city in the cities array matching a getNextOf result
function cityIndexOf(c) { return cities.indexOf(c); }

function initHeader() {
  const nf1  = getNextOf('f1');
  const nfe  = getNextOf('fe');
  const nind = getNextOf('indy');
  document.getElementById('hdr-f1-name').textContent   = nf1  ? nf1.region  : '‚Äî';
  document.getElementById('hdr-f1-loc').textContent    = nf1  ? `${nf1.city} ¬∑ ${nf1.country}`  : '‚Äî';
  document.getElementById('hdr-fe-name').textContent   = nfe  ? nfe.region  : '‚Äî';
  document.getElementById('hdr-fe-loc').textContent    = nfe  ? `${nfe.city} ¬∑ ${nfe.country}`  : '‚Äî';
  document.getElementById('hdr-indy-name').textContent = nind ? nind.region : '‚Äî';
  document.getElementById('hdr-indy-loc').textContent  = nind ? `${nind.city} ¬∑ ${nind.country}` : '‚Äî';
  const nwec  = getNextOf('wec');
  const nwrc  = getNextOf('wrc');
  document.getElementById('hdr-wec-name').textContent  = nwec  ? nwec.region  : '‚Äî';
  document.getElementById('hdr-wec-loc').textContent   = nwec  ? `${nwec.city} ¬∑ ${nwec.country}`  : '‚Äî';
  document.getElementById('hdr-wrc-name').textContent  = nwrc  ? nwrc.region  : '‚Äî';
  document.getElementById('hdr-wrc-loc').textContent   = nwrc  ? `${nwrc.city} ¬∑ ${nwrc.country}`  : '‚Äî';
}
initHeader();

// Make header race blocks clickable ‚Äî spin globe and open session panel
[['hdr-f1-block','f1'],['hdr-fe-block','fe'],['hdr-indy-block','indy'],['hdr-wec-block','wec'],['hdr-wrc-block','wrc']].forEach(([id, key]) => {
  const el = document.getElementById(id);
  if (!el) return;
  el.style.cursor = 'pointer';
  el.addEventListener('click', () => {
    const c = getNextOf(key);
    if (!c) return;
    const idx = cityIndexOf(c);
    if (idx < 0) return;
    highlightSidebar(idx);
    openSessionPanel(idx);
  });
});

// ‚îÄ‚îÄ‚îÄ FILTERING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// ‚îÄ‚îÄ Series prefs early bootstrap (full logic defined later) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const _SERIES_PREFS_BOOT_KEY = 'gridpulse_series_prefs';
const _ALL_SERIES_KEYS = ['f1','f2','f3','f1a','fe','indy','wec','wrc'];
let enabledSeries = (() => {
  try {
    const raw = localStorage.getItem(_SERIES_PREFS_BOOT_KEY);
    if (!raw) return new Set(_ALL_SERIES_KEYS);
    const arr = JSON.parse(raw);
    const s = new Set(arr.filter(k => _ALL_SERIES_KEYS.includes(k)));
    return s.size > 0 ? s : new Set(_ALL_SERIES_KEYS);
  } catch(e) { return new Set(_ALL_SERIES_KEYS); }
})();
function isSeriesEnabled(key) { return enabledSeries.has(key); }
let activeFilter = 'all';

function setActiveFilter(f) {
  activeFilter = f;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.toggle('active', b.dataset.filter === f));
  document.querySelectorAll('.mob-filter-btn').forEach(b => b.classList.toggle('active', b.dataset.filter === f));
  applyFilter();

  // If no city is currently selected, or selected city isn't in this filter,
  // spin to the next upcoming race for the selected series
  if (f === 'all' || tourActive) return;
  const currentOk = activePanelCity >= 0 && cities[activePanelCity].series.includes(f);
  if (!currentOk) {
    const next = f === 'fe' || f === 'indy' ? getNextOf(f)
               : f === 'f2' || f === 'f3' || f === 'f1a' ? getNextOfSub(f)
               : getNextOf(f);
    if (!next) return;
    const idx = cityIndexOf(next);
    if (idx < 0) return;
    highlightSidebar(idx);
    setSelectedCity(idx);
    spinToCity(idx);
  }
}

document.getElementById('filter-bar').addEventListener('click', e => {
  const btn = e.target.closest('.filter-btn');
  if (!btn) return;
  setActiveFilter(btn.dataset.filter);
});

document.getElementById('mobile-filter-bar').addEventListener('click', e => {
  const btn = e.target.closest('.mob-filter-btn');
  if (!btn) return;
  setActiveFilter(btn.dataset.filter);
});

function applyFilter() {
  let visible = 0;
  cities.forEach((c, i) => {
    const seriesOk = c.series.some(s => isSeriesEnabled(s));
    const show = seriesOk && (activeFilter === 'all' || c.series.includes(activeFilter));
    const item = document.getElementById(`ci-${i}`);
    if (item) item.classList.toggle('hidden', !show);
    // Update globe dot visibility
    if (cityMeshes[i]) cityMeshes[i].visible = show;
    if (show) visible++;
    else {
      // If this city was highlighted or had its panel open, clear it
      if (activeCity === i) hideTooltip();
      if (activePanelCity === i) closeSessionPanel();
      // Remove sidebar active highlight
      const item2 = document.getElementById(`ci-${i}`);
      if (item2) item2.classList.remove('active');
    }
  });
  document.getElementById('sidebar-count').textContent = visible;
}

// ‚îÄ‚îÄ‚îÄ TOOLTIP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const tooltip = document.getElementById('tooltip');
let activeCity = -1;

function showTooltip(idx, x, y) {
  if (activeFilter !== 'all' && !cities[idx].series.includes(activeFilter)) return;
  activeCity = idx;
  const c = cities[idx];
  const now = new Date();
  const phase = getPhase(c.tz);
  document.getElementById('tt-region').textContent = `Round ${c.round} ¬∑ ${c.region}`;
  document.getElementById('tt-city').textContent = c.city;
  document.getElementById('tt-country').textContent = c.country;
  document.getElementById('tt-badges').innerHTML = seriesBadgesHTML(c.series);
  document.getElementById('tt-time').textContent = daysUntilRace(c.sessions.race);
  document.getElementById('tt-date').textContent = dateFmt[c.tz].format(now);
  document.getElementById('tt-phase').textContent = phaseLabel(phase);
  document.getElementById('tt-offset').textContent = getOffset(c.tz);
  document.getElementById('tt-phase-dot').className = `phase-dot ${phase}`;

  const cw = container.clientWidth, ch = container.clientHeight;
  let tx = x + 14, ty = y - 16;
  if (tx + 270 > cw) tx = x - 275;
  if (ty + 200 > ch) ty = Math.max(8, ch - 205);
  tooltip.style.left = tx + 'px';
  tooltip.style.top = ty + 'px';
  tooltip.classList.add('visible');
}

function hideTooltip() {
  activeCity = -1;
  tooltip.classList.remove('visible');
}

// ‚îÄ‚îÄ‚îÄ SESSION PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let activePanelCity = -1;
const sessionPanel = document.getElementById('session-panel');

document.getElementById('sp-close').addEventListener('click', closeSessionPanel);

function openSessionPanel(idx) {
  activePanelCity = idx;
  setSelectedCity(idx);
  switchFilterToCity(idx);
  const c = cities[idx];
  document.getElementById('sp-round').textContent = `${t('round')} ${c.round}`;
  document.getElementById('sp-name').textContent = c.region;
  document.getElementById('sp-venue').textContent = `${c.city} ¬∑ ${localiseCountry(c.country)}`;
  document.getElementById('sp-badges').innerHTML = seriesBadgesHTML(c.series);

  const now = Date.now();

  // Build a combined session list grouped by day, with each series colour-coded
  // Collect all sessions across all series into a flat array sorted by time
  const allSessions = [];

  // F1 sessions (only if this venue hosts F1)
  if (c.series.includes('f1')) {
    SESSION_ORDER.forEach(key => {
      if (!c.sessions[key]) return;
      allSessions.push({ time: new Date(c.sessions[key]), series: 'f1', key, label: SESSION_LABELS()[key] });
    });
  }

  // Formula E / IndyCar standalone venues ‚Äî map their sessions as the primary series
  const FE_LABELS   = { race: t('s_fe_race'), race2: t('s_fe_race2'), quali: t('s_fe_quali'), fp: t('s_fe_fp') };
  const INDY_LABELS = { race: t('s_indy_race'), race2: t('s_indy_race2'), quali: t('s_indy_quali'), fp: t('s_indy_fp') };
  if (!c.series.includes('f1')) {
    const primarySeries = c.series.includes('fe') ? 'fe' : c.series.includes('indy') ? 'indy' : c.series.includes('wec') ? 'wec' : c.series.includes('wrc') ? 'wrc' : null;
    const primaryLabels = primarySeries === 'fe' ? FE_LABELS : INDY_LABELS;
    if (primarySeries) {
      Object.entries(c.sessions).forEach(([key, utc]) => {
        if (utc) allSessions.push({ time: new Date(utc), series: primarySeries, key, label: primaryLabels[key] || key });
      });
    }
  } else {
    // For shared F1+FE venues, also add FE badge sessions if any explicit feSessions exist
    if (c.feSessions && isSeriesEnabled('fe')) {
      Object.entries(c.feSessions).forEach(([key, utc]) => {
        allSessions.push({ time: new Date(utc), series: 'fe', key, label: FE_LABELS[key] || key });
      });
    }
  }

  // F2
  const F2_LABELS = { fp: t('s_f2_fp'), quali: t('s_f2_quali'), sprint: t('s_f2_sprint'), feature: t('s_f2_feature') };
  if (c.f2Sessions && isSeriesEnabled('f2')) {
    Object.entries(c.f2Sessions).forEach(([key, utc]) => {
      allSessions.push({ time: new Date(utc), series: 'f2', key, label: F2_LABELS[key] || key });
    });
  }

  // F3
  const F3_LABELS = { fp: t('s_f3_fp'), quali: t('s_f3_quali'), sprint: t('s_f3_sprint'), feature: t('s_f3_feature') };
  if (c.f3Sessions && isSeriesEnabled('f3')) {
    Object.entries(c.f3Sessions).forEach(([key, utc]) => {
      allSessions.push({ time: new Date(utc), series: 'f3', key, label: F3_LABELS[key] || key });
    });
  }

  // F1 Academy
  const F1A_LABELS = { quali: t('s_f1a_quali'), race1: t('s_f1a_r1'), race2: t('s_f1a_r2') };
  if (c.f1aSessions && isSeriesEnabled('f1a')) {
    Object.entries(c.f1aSessions).forEach(([key, utc]) => {
      allSessions.push({ time: new Date(utc), series: 'f1a', key, label: F1A_LABELS[key] || key });
    });
  }


  // WEC ‚Äî standalone endurance venues
  const WEC_LABELS = { race: t('s_wec_race'), practice: t('s_fp1'), quali: t('s_quali') };
  if (!c.series.includes('f1') && c.series.includes('wec')) {
    Object.entries(c.sessions).forEach(([key, utc]) => {
      if (utc) allSessions.push({ time: new Date(utc), series: 'wec', key, label: WEC_LABELS[key] || key });
    });
  }

  // WRC ‚Äî standalone rally venues (ss1 = day 1 start, race = Power Stage)
  const WRC_LABELS = { race: t('s_wrc_ps'), ss1: t('s_wrc_day1'), ss2: 'Day 2', ss3: 'Day 3' };
  if (!c.series.includes('f1') && c.series.includes('wrc')) {
    Object.entries(c.sessions).forEach(([key, utc]) => {
      if (utc) allSessions.push({ time: new Date(utc), series: 'wrc', key, label: WRC_LABELS[key] || key });
    });
  }

  // Sort by time
  allSessions.sort((a, b) => a.time - b.time);

  // Group by local date
  const byDay = {};
  allSessions.forEach(s => {
    const dayKey = new Intl.DateTimeFormat(uiLocale(), { weekday:'long', day:'numeric', month:'short', timeZone: c.tz }).format(s.time);
    if (!byDay[dayKey]) byDay[dayKey] = [];
    byDay[dayKey].push(s);
  });

  const seriesColour = { f1: '#ff6060', f2: '#60d4ff', f3: '#60ffb0', f1a: '#ffb060', fe: '#bb80ff', indy: '#ffe040', wec: '#00e8cc', wrc: '#ff6644' };
  const seriesLabel  = { f1: 'F1', f2: 'F2', f3: 'F3', f1a: 'F1A', fe: 'FE', indy: 'INDY', wec: 'WEC', wrc: 'WRC' };

  let html = '';
  Object.entries(byDay).forEach(([day, sessions]) => {
    html += `<div class="sp-section-title">${day}</div>`;
    sessions.forEach(s => {
      const isPast = s.time.getTime() < now;
      const timeStr = new Intl.DateTimeFormat(uiLocale(), { hour:'2-digit', minute:'2-digit', hour12:false }).format(s.time);
      const isMainRace = s.key === 'race' || s.key === 'feature';
      const raceEmoji = s.series === 'fe' ? '‚ö°' : 'üèÅ';
      const col = seriesColour[s.series];
      html += `<div class="sp-session-row">
        <span class="sp-series-tag" style="color:${col};min-width:28px;font-size:0.5rem;font-weight:500">${seriesLabel[s.series]}</span>
        <span class="sp-session-label${isMainRace ? ' is-race' : ''}" style="flex:1">${isMainRace ? raceEmoji + ' ' : ''}${s.label}</span>
        <span class="sp-session-time${isPast ? ' past' : ''}">${timeStr}</span>
      </div>`;
    });
  });
  document.getElementById('sp-sessions').innerHTML = html;

  // Race countdown
  const raceMs = new Date(c.sessions.race) - Date.now();
  const cdEl = document.getElementById('sp-countdown');
  const cdVal = document.getElementById('sp-countdown-value');
  const primaryS = c.series.includes('f1') ? 'f1' : c.series.includes('fe') ? 'fe' : c.series.includes('wec') ? 'wec' : c.series.includes('wrc') ? 'wrc' : 'indy';
  const startLabel = { f1: t('race_starts'), fe: t('eprix_starts'), indy: t('indy_starts'), wec: t('wec_starts'), wrc: t('wrc_starts') }[primaryS];
  const doneLabel  = { f1: t('race_done_f1'), fe: t('race_done_fe'), indy: t('race_done_indy'), wec: t('race_done_wec'), wrc: t('race_done_wrc') }[primaryS];
  if (raceMs > 0) {
    cdEl.style.display = 'block';
    cdVal.innerHTML = `<span>${formatCountdown(raceMs)}</span>`;
    document.querySelector('.sp-countdown-label').textContent = startLabel;
  } else {
    cdEl.style.display = 'block';
    cdVal.innerHTML = `<span class="sp-countdown-done">Race completed</span>`;
    document.querySelector('.sp-countdown-label').textContent = doneLabel;
  }

  sessionPanel.classList.add('open');
  if (typeof nudgeGlobeForPanel === 'function') nudgeGlobeForPanel(true);
  setTimeout(() => {
    updateCameraOffset();
    if (idx !== undefined) spinToCity(idx);
  }, 320);
  setTimeout(injectSessionPanelAds, 380);
}

// Inject ad blocks that fully fit in the visible space below the session content
function injectSessionPanelAds() {
  const scroll = document.getElementById('sp-scroll');
  const adsContainer = document.getElementById('sp-ads');
  if (!scroll || !adsContainer) return;

  adsContainer.innerHTML = '';

  requestAnimationFrame(() => requestAnimationFrame(() => {
    const AD_HEIGHT = 120;
    const AD_GAP    = 16;  // margin-top per block
    const BLOCK     = AD_HEIGHT + AD_GAP;

    // Measure how far down the actual content (above the ads div) reaches
    // relative to the scroll container's top
    const scrollTop  = scroll.getBoundingClientRect().top;
    const adsTop     = adsContainer.getBoundingClientRect().top;
    const contentH   = adsTop - scrollTop; // px of real content above the ads slot
    const visibleH   = scroll.clientHeight;

    const spare = visibleH - contentH;
    if (spare < BLOCK) return; // not even one full ad fits

    const count = Math.min(3, Math.floor(spare / BLOCK));
    adsContainer.innerHTML = Array.from({ length: count }, () =>
      `<div class="sp-ad-block ad-placeholder">üì¢ Ad ‚Äî Session Panel 250√ó120</div>`
    ).join('');
  }));
}

function closeSessionPanel() {
  activePanelCity = -1;
  setSelectedCity(-1);
  sessionPanel.classList.remove('open');
  if (typeof nudgeGlobeForPanel === 'function') nudgeGlobeForPanel(false);
  setTimeout(updateCameraOffset, 320);
}

// ‚îÄ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const cityListEl = document.getElementById('city-list');
cities.forEach((c, i) => {
  const raceDate = new Date(c.sessions.race);
  const item = document.createElement('div');
  item.className = 'city-item';
  item.id = `ci-${i}`;
  item.dataset.idx = i;
  item.innerHTML = `
    <div class="ci-name">${c.region}</div>
    <div class="ci-country">
      <span style="color:var(--accent);font-size:0.5rem;letter-spacing:0.1em;margin-right:3px">R${c.round}</span>
      <span class="ci-country-name" data-country="${c.country}">${c.country}</span>
    </div>
    <div class="series-badges">${seriesBadgesHTML(c.series)}</div>
    <div class="ci-time" id="cit-${i}">--:--</div>
    <div class="ci-date" id="cid-${i}" data-race-date="${c.sessions.race}"></div>
  `;
  item.addEventListener('click', () => {
    highlightSidebar(i);
    openSessionPanel(i);
  });
  cityListEl.appendChild(item);
});
applyFilter(); // initialise count and visibility
// Initial country + date render for sidebar (will be re-rendered by applyTranslations on lang change)
document.querySelectorAll('.ci-country-name[data-country]').forEach(el => {
  el.textContent = localiseCountry(el.dataset.country);
});
// Initial date render
document.querySelectorAll('.ci-date[data-race-date]').forEach(el => {
  const d = new Date(el.dataset.raceDate);
  el.textContent = new Intl.DateTimeFormat(uiLocale(), { day:'numeric', month:'short' }).format(d);
});

function highlightSidebar(idx) {
  document.querySelectorAll('.city-item').forEach(el => el.classList.remove('active'));
  const el = document.getElementById(`ci-${idx}`);
  if (el) { el.classList.add('active'); el.scrollIntoView({ behavior:'smooth', block:'nearest' }); }
}

// Set/clear the pulsing selected city dot
function setSelectedCity(idx) {
  // Hide previous ring
  if (selectedCityIdx >= 0 && ringMeshes[selectedCityIdx]) {
    ringMeshes[selectedCityIdx].visible = false;
  }
  selectedCityIdx = idx;
  pulseT = 0;
  if (idx >= 0 && ringMeshes[idx]) {
    ringMeshes[idx].visible = true;
  }
}

// Auto-switch filter to match the selected race's primary series, make its dot visible
function switchFilterToCity(idx) {
  if (tourActive) return; // tour manages its own filter
  const c = cities[idx];
  const primarySeries = c.series.includes('f1') ? 'f1'
    : c.series.includes('fe') ? 'fe'
    : c.series.includes('indy') ? 'indy'
    : c.series[0];
  if (activeFilter !== 'all' && !c.series.includes(activeFilter)) {
    setActiveFilter(primarySeries);
    const el = document.getElementById(`ci-${idx}`);
    if (el) el.scrollIntoView({ behavior:'smooth', block:'nearest' });
  }
}

// ‚îÄ‚îÄ‚îÄ SPIN GLOBE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function spinToCity(idx) {
  const c = cities[idx];
  autoRotate = false;

  // Compute the dot's 3D position using the same formula as latLngTo3D,
  // then derive the rotation targets so that position faces the camera (+Z)
  const phi = (90 - c.lat) * (Math.PI / 180);
  const theta = (c.lng + 180) * (Math.PI / 180);
  const dx = -Math.sin(phi) * Math.cos(theta);
  const dy =  Math.cos(phi);
  const dz =  Math.sin(phi) * Math.sin(theta);

  // targetY: rotate so dx‚Üí0, dz‚Üímax (faces +Z). atan2(-dx, dz) gives the Y rotation needed.
  let targetY = Math.atan2(-dx, dz);

  // targetX: tilt so the point is at equator height facing camera.
  // After targetY, point is at (0, dy, horizDist). To centre vertically (y‚Üí0):
  // rotation.x = +atan2(dy, horizDist) ‚Äî positive brings northern cities down to centre
  const horizDist = Math.sqrt(dx * dx + dz * dz);
  let targetX = Math.atan2(dy, horizDist);
  targetX = Math.max(-Math.PI / 2.2, Math.min(Math.PI / 2.2, targetX));

  // Shortest-path wrap for Y so globe spins the short way around
  let curY = globe.rotation.y;
  while (curY - targetY > Math.PI)  targetY += Math.PI * 2;
  while (targetY - curY > Math.PI)  targetY -= Math.PI * 2;

  animateTo(targetX, targetY);
}

let animTarget = null;
function animateTo(tx, ty) { animTarget = { x: tx, y: ty }; }

// Camera centering: shift lookAt left when session panel is open
// so the visible centre of the globe aligns with the visible canvas area
const cameraLookAt = new THREE.Vector3(0, 0, 0);

function updateCameraOffset() {
  // Session panel is now inside the sidebar column, not overlapping the canvas
  // Globe always centres in the full canvas area
  cameraLookAt.x = 0;
  camera.lookAt(cameraLookAt);
}

// Resize ‚Äî renderer reads container's CSS dimensions each frame via W()/H()
function onResize() {
  renderer.setSize(W(), H(), false);
  camera.aspect = W() / H();
  camera.updateProjectionMatrix();
  updateCameraOffset();
}
window.addEventListener('resize', onResize);

// Also watch canvas-wrapper directly so we catch flex layout shifts
// (e.g. session panel opening/closing shrinks globe-container width)
new ResizeObserver(onResize).observe(document.getElementById('canvas-wrapper'));

// ‚îÄ‚îÄ‚îÄ ANIMATION LOOP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const BASE_CAM_Z = 3.2; // initial camera distance ‚Äî dots calibrated at this zoom
function animate() {
  requestAnimationFrame(animate);

  if (animTarget) {
    globe.rotation.x += (animTarget.x - globe.rotation.x) * 0.06;
    globe.rotation.y += (animTarget.y - globe.rotation.y) * 0.06;
    if (Math.abs(animTarget.x - globe.rotation.x) < 0.001 &&
        Math.abs(animTarget.y - globe.rotation.y) < 0.001) animTarget = null;
  } else if (!isDragging) {
    if (autoRotate) {
      globe.rotation.y += 0.0015;
    } else {
      globe.rotation.x += rotVel.x;
      globe.rotation.y += rotVel.y;
      rotVel.x *= 0.92;
      rotVel.y *= 0.92;
    }
  }
  globe.rotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, globe.rotation.x));

  // Keep dots constant screen size regardless of zoom level
  const dotScale = camera.position.z / BASE_CAM_Z;
  cityMeshes.forEach(m => m.scale.setScalar(dotScale));

  // Animate pulse ring on selected city
  if (selectedCityIdx >= 0) {
    pulseT = (pulseT + 0.012) % 1;
    const ring = ringMeshes[selectedCityIdx];
    if (ring && ring.visible) {
      const s = dotScale * (1 + pulseT * 3.5);
      ring.scale.setScalar(s);
      ring.material.opacity = (1 - pulseT) * 0.85;
      // Colour matches the dot
      ring.material.color.copy(cityMeshes[selectedCityIdx].material.color);
    }
  }

  camera.lookAt(cameraLookAt);
  renderer.render(scene, camera);
}
animate();

// ‚îÄ‚îÄ‚îÄ TICK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// ‚îÄ‚îÄ‚îÄ HEADER ROTATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Strategy: use a ResizeObserver on the header. On every resize (and on init),
// measure whether all 3 blocks fit. If not, start rotating. If they do, stop.

let headerRotateTimer  = null;
let headerRotateIndex  = 0;
// HDR_SERIES is computed dynamically so it includes standalone sub-series cards
const HDR_SERIES_BASE = ['f1', 'f2', 'f3', 'f1a', 'fe', 'indy'];

// Which sub-series currently have standalone cards (not supporting next F1)?
function getStandaloneSubSeries() {
  const nrF1 = getNextOf('f1');
  return ['f2', 'f3', 'f1a'].filter(key => !(nrF1 && nrF1.series.includes(key)));
}

function getActiveHdrSeries() {
  const standalone = getStandaloneSubSeries();
  // Always include all series ‚Äî on mobile we rotate through them one at a time
  return ['f1', ...standalone, 'fe', 'indy', 'wec', 'wrc'].filter(k => isSeriesEnabled(k));
}

const HDR_BLOCKS = {
  f1:   { blockId: 'hdr-f1-block',   wrapId: null,                    cdId: 'hdr-f1-countdown'   },
  f2:   { blockId: 'hdr-f2-block',   wrapId: 'hdr-f2-countdown-wrap',  cdId: 'hdr-f2-countdown'   },
  f3:   { blockId: 'hdr-f3-block',   wrapId: 'hdr-f3-countdown-wrap',  cdId: 'hdr-f3-countdown'   },
  f1a:  { blockId: 'hdr-f1a-block',  wrapId: 'hdr-f1a-countdown-wrap', cdId: 'hdr-f1a-countdown'  },
  fe:   { blockId: 'hdr-fe-block',   wrapId: 'hdr-fe-countdown-wrap',  cdId: 'hdr-fe-countdown'   },
  indy: { blockId: 'hdr-indy-block', wrapId: 'hdr-indy-countdown-wrap', cdId: 'hdr-indy-countdown' },
  wec:  { blockId: 'hdr-wec-block',  wrapId: 'hdr-wec-countdown-wrap',  cdId: 'hdr-wec-countdown'  },
  wrc:  { blockId: 'hdr-wrc-block',  wrapId: 'hdr-wrc-countdown-wrap',  cdId: 'hdr-wrc-countdown'  },
};

// ‚îÄ‚îÄ‚îÄ DEBUG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Show ALL currently-active blocks (respects which sub-series are standalone)
function hdrShowAll() {
  // Show only enabled series blocks ‚Äî delegate to hdrShowSet which handles show/hide for all 8 keys
  hdrShowSet(getActiveHdrSeries());
}

// Show ONE series, hide the others
function hdrShowOne(key) {
  const hdr = document.querySelector('header');
  if (!hdr) return;
  hdr.querySelectorAll('.hdr-race-block').forEach(el => el.style.display = 'none');
  hdr.querySelectorAll('.header-countdown').forEach(el => el.style.display = 'none');
  // Hide all dividers, show only the one preceding this card
  const divMap = {f1:'hdr-h1-div',f2:'hdr-f2-div',f3:'hdr-f3-div',f1a:'hdr-f1a-div',fe:'hdr-fe-pre-div',indy:'hdr-indy-pre-div',wec:'hdr-wec-pre-div',wrc:'hdr-wrc-pre-div'};
  ['hdr-h1-div','hdr-f2-div','hdr-f3-div','hdr-f1a-div','hdr-fe-pre-div','hdr-indy-pre-div','hdr-wec-pre-div','hdr-wrc-pre-div','hdr-hint-div'].forEach(id => {
    const el = document.getElementById(id); if (el) el.style.display = 'none';
  });
  const showDiv = document.getElementById(divMap[key]);
  if (showDiv) showDiv.style.display = '';
  const b = HDR_BLOCKS[key];
  if (!b) return;
  const block = document.getElementById(b.blockId);
  if (block) block.style.display = 'flex';
  if (b.wrapId) {
    const wrap = document.getElementById(b.wrapId);
    if (wrap) wrap.style.display = 'flex';
  } else {
    const f1wrap = hdr.querySelector('.header-countdown:not([id])');
    if (f1wrap) f1wrap.style.display = 'flex';
  }
  if (key === 'f1') updateF1Label();
  let nr, raceMs;
  if (key === 'f2' || key === 'f3' || key === 'f1a') {
    nr = getNextOfSub(key); raceMs = nr ? getSubRaceDate(nr, key) - Date.now() : 0;
  } else {
    nr = getNextOf(key); raceMs = nr ? new Date(nr.sessions.race) - Date.now() : 0;
  }
  const nameLocIds = {
    f1:{nameId:'hdr-f1-name',locId:'hdr-f1-loc'},f2:{nameId:'hdr-f2-name',locId:'hdr-f2-loc'},
    f3:{nameId:'hdr-f3-name',locId:'hdr-f3-loc'},f1a:{nameId:'hdr-f1a-name',locId:'hdr-f1a-loc'},
    fe:{nameId:'hdr-fe-name',locId:'hdr-fe-loc'},indy:{nameId:'hdr-indy-name',locId:'hdr-indy-loc'},
    wec:{nameId:'hdr-wec-name',locId:'hdr-wec-loc'},wrc:{nameId:'hdr-wrc-name',locId:'hdr-wrc-loc'},
  };
  const ids = nameLocIds[key];
  if (nr && ids) {
    const nameEl = document.getElementById(ids.nameId);
    const locEl  = document.getElementById(ids.locId);
    if (nameEl) nameEl.textContent = nr.region;
    if (locEl)  locEl.textContent  = nr.city + ' ¬∑ ' + localiseCountry(nr.country);
  }
  const cdEl = document.getElementById(b.cdId);
  if (cdEl) cdEl.textContent = raceMs > 0 ? formatCountdown(raceMs, isMobile()) : t('on_now');
}


function stopHeaderRotation() {
  if (headerRotateTimer) { clearInterval(headerRotateTimer); headerRotateTimer = null; }
}

function startHeaderRotation() {
  startHeaderRotationGroups(getActiveHdrSeries(), 1);
}

function startHeaderRotationGroups(allSeries, groupSize) {
  if (headerRotateTimer) return;
  headerRotateIndex = 0;
  const numGroups = Math.ceil(allSeries.length / groupSize);
  const doShow = (groupIdx) => {
    const start = (groupIdx % numGroups) * groupSize;
    const group = allSeries.slice(start, start + groupSize);
    if (groupSize === 1) {
      hdrShowOne(group[0]);
    } else {
      hdrShowSet(group);
      group.forEach(k => {
        let nr, ms;
        if (k === 'f2' || k === 'f3' || k === 'f1a') {
          nr = getNextOfSub(k); ms = nr ? getSubRaceDate(nr, k) - Date.now() : 0;
        } else {
          nr = getNextOf(k); ms = nr ? new Date(nr.sessions.race) - Date.now() : 0;
        }
        const b = HDR_BLOCKS[k];
        if (b && nr) {
          const cdEl = document.getElementById(b.cdId);
          if (cdEl) cdEl.textContent = ms > 0 ? formatCountdown(ms, false) : t('on_now');
        }
      });
    }
  };
  doShow(0);
  headerRotateTimer = setInterval(() => {
    headerRotateIndex = (headerRotateIndex + 1) % numGroups;
    const hdr = document.querySelector('header');
    if (hdr) hdr.classList.add('hdr-fading');
    setTimeout(() => {
      doShow(headerRotateIndex);
      if (hdr) hdr.classList.remove('hdr-fading');
    }, 300);
  }, 20000);
}

// Check header fit ‚Äî called once on load and on every resize
function hdrShowSet(keys) {
  const hdr = document.querySelector('header');
  if (!hdr) return;
  const allKeys = ['f1', 'f2', 'f3', 'f1a', 'fe', 'indy', 'wec', 'wrc'];
  // Map each key to its preceding divider id
  const divMap = {
    f1:'hdr-h1-div', f2:'hdr-f2-div', f3:'hdr-f3-div',
    f1a:'hdr-f1a-div', fe:'hdr-fe-pre-div', indy:'hdr-indy-pre-div',
    wec:'hdr-wec-pre-div', wrc:'hdr-wrc-pre-div'
  };
  allKeys.forEach(k => {
    const show = keys.includes(k);
    const b = HDR_BLOCKS[k];
    if (!b) return;
    // Show/hide block
    const block = document.getElementById(b.blockId);
    if (block) block.style.display = show ? 'flex' : 'none';
    // Show/hide countdown wrap
    if (b.wrapId) {
      const wrap = document.getElementById(b.wrapId);
      if (wrap) wrap.style.display = show ? 'flex' : 'none';
    } else {
      // F1 countdown wrap has no id
      const f1wrap = hdr.querySelector('.header-countdown:not([id])');
      if (f1wrap) f1wrap.style.display = show ? 'flex' : 'none';
    }
    // Show/hide this card's preceding divider
    const divEl = document.getElementById(divMap[k]);
    if (divEl) divEl.style.display = show ? '' : 'none';
  });
  // Always hide the hint divider
  const hintDiv = document.getElementById('hdr-hint-div');
  if (hintDiv) hintDiv.style.display = 'none';
  // If indy is shown, show its preceding divider (already handled), but not hint-div
  if (keys.includes('f1')) updateF1Label();
}


function checkHeaderFit() {
  const hdr = document.querySelector('header');
  if (!hdr) return;

  stopHeaderRotation();

  // On mobile: always rotate one at a time through all series
  if (isMobile()) {
    document.querySelector('header').classList.remove('hdr-init');
    startHeaderRotationGroups(getActiveHdrSeries(), 1);
    return;
  }

  // Desktop: greedy ‚Äî try showing all, then drop one at a time until it fits
  const allSeries = getActiveHdrSeries(); // ordered list of all active cards
  
  // Try showing all
  hdrShowAll();
  void hdr.offsetWidth;
  if (hdr.scrollWidth <= hdr.clientWidth + 4) return; // all fit!

  // Try progressively fewer cards from the end, keeping the most important ones
  for (let count = allSeries.length - 1; count >= 2; count--) {
    // Try showing first 'count' series
    // But rotate through all groups of 'count' every 20s
    break; // use rotation approach for 2+ but not all
  }

  // Try showing just 2: try each adjacent pair
  // Find the largest N where N consecutive cards fit, then rotate through groups of N
  let maxFit = 1;
  for (let n = allSeries.length; n >= 2; n--) {
    // Try showing the first n cards
    hdrShowSet(allSeries.slice(0, n));
    void hdr.offsetWidth;
    if (hdr.scrollWidth <= hdr.clientWidth + 4) {
      maxFit = n;
      break;
    }
  }

  if (maxFit >= allSeries.length) {
    hdrShowAll();
    return; // all fit
  }

  // maxFit cards fit at a time ‚Äî rotate through them in groups
  hdrShowSet(allSeries.slice(0, maxFit)); // show first group immediately
  window._hdrMaxFit = maxFit;
  startHeaderRotationGroups(allSeries, maxFit);
}

// On mobile, immediately hide all cards except F1 to prevent flash before rotation starts
if (isMobile()) {
  hdrShowOne('f1');
}

// Initial header fit check after fonts settle
setTimeout(checkHeaderFit, 800);

window.addEventListener('resize', () => {
  stopHeaderRotation();
  hdrShowAll();
  setTimeout(checkHeaderFit, 100);
});

// Get next race for f2/f3/f1a ‚Äî uses their specific session dates
function getNextOfSub(key) {
  const now = Date.now();
  const venues = cities.filter(c => c.series.includes(key));
  const getDate = c => {
    if (key === 'f2' && c.f2Sessions) return new Date(c.f2Sessions.feature || c.f2Sessions.race || c.sessions.race);
    if (key === 'f3' && c.f3Sessions) return new Date(c.f3Sessions.feature || c.f3Sessions.race || c.sessions.race);
    if (key === 'f1a' && c.f1aSessions) return new Date(c.f1aSessions.race2 || c.f1aSessions.race1 || c.sessions.race);
    return new Date(c.sessions.race);
  };
  const sorted = [...venues].sort((a, b) => getDate(a) - getDate(b));
  return sorted.find(c => getDate(c).getTime() > now) || sorted[sorted.length - 1];
}

function getSubRaceDate(city, key) {
  if (key === 'f2' && city.f2Sessions) return new Date(city.f2Sessions.feature || city.f2Sessions.race || city.sessions.race);
  if (key === 'f3' && city.f3Sessions) return new Date(city.f3Sessions.feature || city.f3Sessions.race || city.sessions.race);
  if (key === 'f1a' && city.f1aSessions) return new Date(city.f1aSessions.race2 || city.f1aSessions.race1 || city.sessions.race);
  return new Date(city.sessions.race);
}

function updateF1Label() {
  const nrF1 = getNextOf('f1');
  const labelEl = document.getElementById('hdr-f1-label');

  const subs = [
    { key: 'f2',  blockId: 'hdr-f2-block',  wrapId: 'hdr-f2-countdown-wrap',  cdId: 'hdr-f2-countdown',  nameId: 'hdr-f2-name',  locId: 'hdr-f2-loc',  divId: 'hdr-f2-div',  label: 'F2'  },
    { key: 'f3',  blockId: 'hdr-f3-block',  wrapId: 'hdr-f3-countdown-wrap',  cdId: 'hdr-f3-countdown',  nameId: 'hdr-f3-name',  locId: 'hdr-f3-loc',  divId: 'hdr-f3-div',  label: 'F3'  },
    { key: 'f1a', blockId: 'hdr-f1a-block', wrapId: 'hdr-f1a-countdown-wrap', cdId: 'hdr-f1a-countdown', nameId: 'hdr-f1a-name', locId: 'hdr-f1a-loc', divId: 'hdr-f1a-div', label: 'F1A' },
  ];

  const supporting = [];

  subs.forEach(({ key, blockId, wrapId, cdId, nameId, locId, divId, label }) => {
    const withF1 = nrF1 && nrF1.series.includes(key);
    if (withF1) {
      if (isSeriesEnabled(key)) supporting.push(label);
      // Only touch display when rotation is NOT running (rotation manages visibility itself)
      if (!headerRotateTimer) {
        [blockId, wrapId, divId].forEach(id => {
          const e = document.getElementById(id); if (e) e.style.display = 'none';
        });
      }
    } else {
      const nr = getNextOfSub(key);
      if (!nr) return;
      // Always update text content
      const nameEl = document.getElementById(nameId);
      const locEl  = document.getElementById(locId);
      const cdEl   = document.getElementById(cdId);
      if (nameEl) nameEl.textContent = nr.region;
      if (locEl)  locEl.textContent  = nr.city + ' ¬∑ ' + localiseCountry(nr.country);
      if (cdEl) {
        const ms = getSubRaceDate(nr, key) - Date.now();
        cdEl.textContent = ms > 0 ? formatCountdown(ms, isMobile()) : t('on_now');
      }
      // Only touch display when rotation is NOT running AND not on mobile pre-init
      if (!headerRotateTimer && !isMobile()) {
        const blockEl = document.getElementById(blockId);
        const wrapEl  = document.getElementById(wrapId);
        const divEl   = document.getElementById(divId);
        const showSub = isSeriesEnabled(key);
        if (blockEl) blockEl.style.display = showSub ? 'flex' : 'none';
        if (wrapEl)  wrapEl.style.display  = showSub ? 'flex' : 'none';
        if (divEl)   divEl.style.display   = showSub ? '' : 'none';
      }
    }
  });

  if (labelEl) {
    labelEl.textContent = supporting.length
      ? t('next_f1') + '  ¬∑  ' + supporting.join(' ¬∑ ')
      : t('next_f1');
  }
}

function tick() {
  const now = new Date();
  updateF1Label(); // update F1 header label with supporting series

  // Update all three header countdowns
  const series = [
    { key: 'f1',   cdId: 'hdr-f1-countdown',   nameId: 'hdr-f1-name',   locId: 'hdr-f1-loc' },
    { key: 'fe',   cdId: 'hdr-fe-countdown',   nameId: 'hdr-fe-name',   locId: 'hdr-fe-loc' },
    { key: 'indy', cdId: 'hdr-indy-countdown', nameId: 'hdr-indy-name', locId: 'hdr-indy-loc' },
    { key: 'wec',  cdId: 'hdr-wec-countdown',  nameId: 'hdr-wec-name',  locId: 'hdr-wec-loc'  },
    { key: 'wrc',  cdId: 'hdr-wrc-countdown',  nameId: 'hdr-wrc-name',  locId: 'hdr-wrc-loc'  },
  ];
  series.forEach(({ key, cdId, nameId, locId }) => {
    const nr = getNextOf(key);
    if (!nr) return;
    document.getElementById(nameId).textContent = nr.region;
    document.getElementById(locId).textContent  = `${nr.city} ¬∑ ${localiseCountry(nr.country)}`;
    const ms = new Date(nr.sessions.race) - now;
    const el = document.getElementById(cdId);
    if (ms > 0) {
      el.textContent = formatCountdown(ms, isMobile && isMobile());
    } else {
      el.textContent = t('on_now');
    }
  });
  // Sidebar days until race
  cities.forEach((c, i) => {
    const phase = getPhase(c.tz);
    if (cityMeshes[i] && cityMeshes[i].visible) {
      cityMeshes[i].material.color.setHex(phaseColor(phase));
    }
    const st = document.getElementById(`cit-${i}`);
    if (st) st.textContent = daysUntilRace(c.sessions.race);
  });

  // Tooltip days until race
  if (activeCity >= 0) {
    const el = document.getElementById('tt-time');
    if (el) el.textContent = daysUntilRace(cities[activeCity].sessions.race);
  }

  // Session panel countdown
  if (activePanelCity >= 0) {
    const c = cities[activePanelCity];
    const raceMs = new Date(c.sessions.race) - now;
    const cdVal = document.getElementById('sp-countdown-value');
    const cdLabel = document.querySelector('.sp-countdown-label');
    if (cdVal && raceMs > 0) {
      cdVal.innerHTML = `<span>${formatCountdown(raceMs)}</span>`;
      const ps = c.series.includes('f1') ? 'f1' : c.series.includes('fe') ? 'fe' : c.series.includes('wec') ? 'wec' : c.series.includes('wrc') ? 'wrc' : 'indy';
      const lbl = { f1: t('race_starts'), fe: t('eprix_starts'), indy: t('indy_starts'), wec: t('wec_starts'), wrc: t('wrc_starts') }[ps];
      if (cdLabel) cdLabel.textContent = lbl;
    }
  }
}
tick();
setInterval(tick, 1000);

// ‚îÄ‚îÄ‚îÄ SERIES PREFERENCES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// ALL_SERIES keys (use _ALL_SERIES_KEYS declared above)
const ALL_SERIES = _ALL_SERIES_KEYS;
const SERIES_LABELS = {
  f1:'Formula 1', f2:'Formula 2', f3:'Formula 3', f1a:'F1 Academy',
  fe:'Formula E', indy:'IndyCar', wec:'WEC', wrc:'WRC'
};
const SERIES_COLOURS = {
  f1:'#ff6060', f2:'#60d4ff', f3:'#60ffb0', f1a:'#ffb060',
  fe:'#bb80ff', indy:'#ffe040', wec:'#00e8cc', wrc:'#ff6644'
};

function hexToRgb(hex) {
  const r = parseInt(hex.slice(1,3),16), g = parseInt(hex.slice(3,5),16), b = parseInt(hex.slice(5,7),16);
  return `${r},${g},${b}`;
}

const SERIES_PREFS_KEY = _SERIES_PREFS_BOOT_KEY;

function loadSeriesPrefs() {
  try {
    const raw = localStorage.getItem(SERIES_PREFS_KEY);
    if (!raw) return new Set(ALL_SERIES);
    const arr = JSON.parse(raw);
    // Always ensure at least one series enabled
    const s = new Set(arr.filter(k => ALL_SERIES.includes(k)));
    return s.size > 0 ? s : new Set(ALL_SERIES);
  } catch(e) { return new Set(ALL_SERIES); }
}

function saveSeriesPrefs(enabled) {
  try { localStorage.setItem(SERIES_PREFS_KEY, JSON.stringify([...enabled])); } catch(e) {}
}

enabledSeries = loadSeriesPrefs(); // re-initialise using full loadSeriesPrefs

function applySeriesPrefs() {
  // 1. Filter bar buttons ‚Äî hide disabled series buttons
  ALL_SERIES.forEach(key => {
    const enabled = isSeriesEnabled(key);
    document.querySelectorAll(`.filter-btn.${key}, .mob-filter-btn.${key}`).forEach(btn => {
      btn.style.display = enabled ? '' : 'none';
    });
  });

  // 1b. Hide 'All' filter button if only one series is enabled
  const enabledCount = enabledSeries.size;
  document.querySelectorAll('.filter-btn.all, .mob-filter-btn.all').forEach(btn => {
    btn.style.display = enabledCount <= 1 ? 'none' : '';
  });
  // If only one series and activeFilter='all', switch to that series automatically
  if (enabledCount === 1) {
    const onlySeries = [...enabledSeries][0];
    if (activeFilter === 'all') setActiveFilter(onlySeries);
  }

  // 2. If activeFilter is a now-disabled series, reset to 'all'
  if (activeFilter !== 'all' && !isSeriesEnabled(activeFilter)) {
    setActiveFilter('all');
  } else {
    applyFilter();
  }

  // 3. Header rotation ‚Äî checkHeaderFit uses getActiveHdrSeries which respects enabledSeries
  checkHeaderFit();

  // 4. Sidebar city item badges ‚Äî refresh to hide disabled series badges
  cities.forEach((city, i) => {
    const badgesEl = document.querySelector(`#ci-${i} .series-badges`);
    if (badgesEl) badgesEl.innerHTML = seriesBadgesHTML(city.series);
  });

  // 5. Sidebar count update
  applyFilter();
}

function buildSeriesPane() {
  const grid = document.getElementById('series-pref-grid');
  if (!grid) return;
  grid.innerHTML = '';
  ALL_SERIES.forEach(key => {
    const enabled = isSeriesEnabled(key);
    const col = SERIES_COLOURS[key];
    const rgb = hexToRgb(col);
    const el = document.createElement('div');
    el.className = 'series-toggle' + (enabled ? ' enabled' : '');
    el.style.setProperty('--series-col', col);
    el.style.setProperty('--series-col-rgb', rgb);
    el.dataset.series = key;
    el.innerHTML = `
      <div class="series-toggle-dot"></div>
      <span class="series-toggle-name">${SERIES_LABELS[key]}</span>
      <div class="series-toggle-check">${enabled ? '‚úì' : ''}</div>
    `;
    el.addEventListener('click', () => {
      const isOn = enabledSeries.has(key);
      // Prevent disabling the last enabled series
      if (isOn && enabledSeries.size <= 1) return;
      if (isOn) { enabledSeries.delete(key); } else { enabledSeries.add(key); }
      saveSeriesPrefs(enabledSeries);
      buildSeriesPane(); // re-render checkboxes
      applySeriesPrefs();
    });
    grid.appendChild(el);
  });

  const resetBtn = document.getElementById('series-reset-btn');
  if (resetBtn) {
    resetBtn.onclick = () => {
      enabledSeries = new Set(ALL_SERIES);
      saveSeriesPrefs(enabledSeries);
      buildSeriesPane();
      applySeriesPrefs();
    };
  }
}

// Apply preferences on page load
try { applySeriesPrefs(); } catch(e) { console.error('applySeriesPrefs error:', e); }


// ‚îÄ‚îÄ‚îÄ STARTUP: select next F1 race, no auto-rotation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(function selectNextF1OnLoad() {
  const next = getNextOf('f1');
  if (!next) return;
  const idx = cityIndexOf(next);
  if (idx < 0) return;
  autoRotate = false;
  setTimeout(() => {
    highlightSidebar(idx);
    spinToCity(idx);
    // Don't open session panel on load ‚Äî user opens it by clicking
  }, 300);
})();

// ‚îÄ‚îÄ‚îÄ F1 TOUR ‚Äî arc line + idle auto-advance ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// All F1 cities sorted chronologically by race date
const f1Tour = cities
  .filter(c => c.series.includes('f1'))
  .sort((a, b) => new Date(a.sessions.race) - new Date(b.sessions.race));

// Track user interaction ‚Äî any mouse/touch/wheel resets idle timer
let tourActive   = false;
let tourIdx      = 0;        // index into f1Tour
let tourTimer    = null;     // setTimeout handle
let idleTimer    = null;
let userTouched  = false;

// Arc line mesh ‚Äî lives on the globe so it rotates with it
let arcMesh = null;

const ARC_COLOR    = 0xff4444;   // red
const ARC_RADIUS   = globeRadius + 0.022; // just above dots
const IDLE_DELAY   = 10000;      // 10s before tour starts
const STEP_DELAY   = 10000;      // 10s per race

// Build a great-circle arc between two lat/lng points as a TubeGeometry
function buildArc(fromCity, toCity) {
  const a = latLngTo3D(fromCity.lat, fromCity.lng, ARC_RADIUS).normalize();
  const b = latLngTo3D(toCity.lat,   toCity.lng,   ARC_RADIUS).normalize();

  // Sample points along the great circle between a and b
  const SEGMENTS = 60;
  const points = [];
  for (let i = 0; i <= SEGMENTS; i++) {
    const t = i / SEGMENTS;
    // Slerp between a and b
    const dot   = Math.max(-1, Math.min(1, a.dot(b)));
    const omega = Math.acos(dot);
    let p;
    if (omega < 0.0001) {
      p = a.clone().lerp(b, t);
    } else {
      const sinOmega = Math.sin(omega);
      p = a.clone().multiplyScalar(Math.sin((1 - t) * omega) / sinOmega)
           .add(b.clone().multiplyScalar(Math.sin(t * omega) / sinOmega));
    }
    points.push(p.multiplyScalar(ARC_RADIUS));
  }

  const curve   = new THREE.CatmullRomCurve3(points);
  const tubeGeo = new THREE.TubeGeometry(curve, SEGMENTS, 0.004, 6, false);
  const tubeMat = new THREE.MeshBasicMaterial({
    color: ARC_COLOR,
    transparent: true,
    opacity: 0.85,
    depthWrite: false,
  });
  return new THREE.Mesh(tubeGeo, tubeMat);
}

// Remove existing arc from globe
function clearArc() {
  if (arcMesh) {
    globe.remove(arcMesh);
    arcMesh.geometry.dispose();
    arcMesh.material.dispose();
    arcMesh = null;
  }
}

// Advance to the next F1 race in the tour
function tourStep() {
  if (!tourActive) return;

  const tour    = buildTourForSeries(_tourSeries);
  const city    = tour[tourIdx % tour.length];
  const prevIdx = tourIdx - 1;
  const prev    = prevIdx >= 0 ? tour[prevIdx % tour.length] : null;

  clearArc();

  if (prev) {
    const arc = buildArc(prev, city);
    globe.add(arc);
    arcMesh = arc;
    arcMesh.material.opacity = 0;
    let fadeIn = 0;
    const fade = setInterval(() => {
      fadeIn += 0.05;
      if (arcMesh) arcMesh.material.opacity = Math.min(0.85, fadeIn * 0.85);
      if (fadeIn >= 1) clearInterval(fade);
    }, 30);
  }

  const cityIdx = cityIndexOf(city);
  highlightSidebar(cityIdx);
  setSelectedCity(cityIdx);
  spinToCity(cityIdx);
  openSessionPanel(cityIdx);

  tourIdx = (tourIdx + 1) % tour.length;
  tourTimer = setTimeout(tourStep, STEP_DELAY);
}

// Start the tour from the first F1 race (no arc on first step)
// Tour ignore-stop flag ‚Äî set before any listeners or tour functions
let _tourIgnoreStop = false;
let _tourSeries     = 'f1';
let _tourPreFilter  = 'all';

// Build a tour for any series key
function buildTourForSeries(key) {
  const sub = ['f2', 'f3', 'f1a'].includes(key);
  return cities
    .filter(c => c.series.includes(key))
    .sort((a, b) => {
      const getD = c => sub ? getSubRaceDate(c, key) : new Date(c.sessions.race);
      return getD(a) - getD(b);
    });
}

// _tourSeries and _tourPreFilter declared above

function startTour() {
  if (tourActive) return;
  tourActive = true;
  _tourSeries    = (activeFilter !== 'all') ? activeFilter : 'f1';
  _tourPreFilter = activeFilter;
  // Apply the tour series filter so only its dots show
  setActiveFilter(_tourSeries);
  document.getElementById('tour-btn-icon').innerHTML = '&#9646;&#9646;';
  document.getElementById('tour-play-btn').classList.add('tour-running');
  document.getElementById('tour-play-btn').title = t('stop_tour');
  tourIdx = 0;
  tourStep();
}

function stopTour() {
  const wasTourRunning = tourActive;
  tourActive = false;
  clearTimeout(tourTimer);
  clearTimeout(idleTimer);
  idleTimer = null;
  clearArc();
  // Only restore pre-tour filter if the tour was actually running
  if (wasTourRunning && activeFilter !== _tourPreFilter) setActiveFilter(_tourPreFilter);
  // Update button to play icon
  document.getElementById('tour-btn-icon').innerHTML = '&#9654;';
  document.getElementById('tour-play-btn').classList.remove('tour-running');
  document.getElementById('tour-play-btn').title = t('start_tour');
}

// Tour play button
// Prevent play button's own mousedown from triggering the window stopTour listener
document.getElementById('tour-play-btn').addEventListener('mousedown', e => {
  e.stopPropagation();
}, { capture: true });
document.getElementById('tour-play-btn').addEventListener('touchstart', e => {
  e.stopPropagation();
}, { capture: true, passive: true });

document.getElementById('tour-play-btn').addEventListener('click', e => {
  if (tourActive && _tourSeries === (activeFilter === 'all' ? 'f1' : activeFilter)) {
    stopTour();
  } else {
    // Stop any running tour silently (no filter restore) then start fresh
    tourActive = false;
    clearTimeout(tourTimer);
    clearArc();
    startTour();
  }
});

// User interacted ‚Äî stop tour permanently on any interaction anywhere on page
// Only intentional interactions stop the tour ‚Äî not passive mouse movement or the play button click
['mousedown', 'keydown', 'wheel', 'touchstart', 'touchmove'].forEach(evt => {
  window.addEventListener(evt, () => {
    if (_tourIgnoreStop) return;
    stopTour();
  }, { passive: true });
});

// Start idle countdown on load ‚Äî tour begins after 10s if user hasn't touched anything
idleTimer = setTimeout(startTour, IDLE_DELAY);

// ‚îÄ‚îÄ‚îÄ MOTORSPORT NEWS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const NEWS_FEEDS = [
  { url: 'https://www.autosport.com/rss/feed/f1',              badge: 'f1',   label: 'F1'        },
  { url: 'https://www.autosport.com/rss/feed/indycar',         badge: 'indy', label: 'IndyCar'   },
  { url: 'https://www.autosport.com/rss/feed/formula-e',       badge: 'fe',   label: 'Formula E' },
  { url: 'https://the-race.com/formula-1/feed/',               badge: 'f1',   label: 'F1'        },
  { url: 'https://the-race.com/formula-e/feed/',               badge: 'fe',   label: 'Formula E' },
  { url: 'https://the-race.com/indycar/feed/',                 badge: 'indy', label: 'IndyCar'   },
];

// CORS proxies to try in order
const CORS_PROXIES = [
  url => `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`,
  url => `https://corsproxy.io/?${encodeURIComponent(url)}`,
  url => `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}&count=6`,
];

function timeAgo(dateStr) {
  const diff = Date.now() - new Date(dateStr).getTime();
  const m = Math.floor(diff / 60000);
  if (m < 1)  return 'just now';
  if (m < 60) return `${m}m ago`;
  const h = Math.floor(m / 60);
  if (h < 24) return `${h}h ago`;
  return `${Math.floor(h / 24)}d ago`;
}

function stripHtml(str) {
  return (str || '').replace(/<[^>]*>/g, '').replace(/&(?:[a-z]+|#\d+);/gi, ' ').replace(/\s+/g, ' ').trim();
}

// Parse raw RSS XML string into items array
function parseRSS(xml) {
  const parser = new DOMParser();
  const doc = parser.parseFromString(xml, 'text/xml');
  const items = [...doc.querySelectorAll('item')];
  return items.map(item => {
    const get = tag => item.querySelector(tag)?.textContent || '';
    return {
      title:   get('title'),
      link:    get('link') || get('guid'),
      summary: stripHtml(get('description') || get('content\\:encoded')),
      date:    get('pubDate'),
    };
  }).filter(i => i.title && i.link);
}

// Try rss2json first (returns JSON), then raw XML via CORS proxies
async function fetchFeed({ url, badge, label }) {
  // 1. Try rss2json (cleanest)
  try {
    const r = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}&count=6`, { signal: AbortSignal.timeout(6000) });
    if (r.ok) {
      const data = await r.json();
      if (data.status === 'ok' && data.items?.length) {
        return data.items.map(item => ({
          badge, label,
          title:   item.title || '',
          summary: stripHtml(item.description || item.content || ''),
          link:    item.link || item.guid || '#',
          date:    item.pubDate || '',
        }));
      }
    }
  } catch {}

  // 2. Try allorigins (returns raw XML in .contents)
  try {
    const r = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`, { signal: AbortSignal.timeout(6000) });
    if (r.ok) {
      const data = await r.json();
      if (data.contents) {
        return parseRSS(data.contents).map(item => ({ badge, label, ...item }));
      }
    }
  } catch {}

  // 3. Try corsproxy.io (returns raw XML)
  try {
    const r = await fetch(`https://corsproxy.io/?${encodeURIComponent(url)}`, { signal: AbortSignal.timeout(6000) });
    if (r.ok) {
      const xml = await r.text();
      return parseRSS(xml).map(item => ({ badge, label, ...item }));
    }
  } catch {}

  return [];
}

// Toggle open/close
const newsToggle = document.getElementById('news-toggle');
const newsBar    = document.getElementById('news-bar');
let newsLoaded   = false;
let allNewsItems = []; // all fetched items (up to 20)

function buildTicker(items) {
  const ticker = document.getElementById('news-ticker');
  if (!items.length) { ticker.innerHTML = ''; return; }
  // Duplicate items so the scroll loops seamlessly
  const half = items.map(item =>
    `<a class="ticker-item" href="${item.link}" target="_blank" rel="noopener noreferrer">
      <span class="ticker-badge ${item.badge}">${item.label}</span>
      ${item.title}
    </a>
    <span class="ticker-sep">¬∑</span>`
  ).join('');
  ticker.innerHTML = half + half; // duplicate for seamless loop

  // Adjust animation speed based on content width ‚Äî ~30px per second for readability
  const totalW = ticker.scrollWidth;
  const speed  = Math.max(40, totalW / 30); // ~30px per second
  ticker.style.animationDuration = `${speed}s`;
}

function buildDropdown(items) {
  const newsList = document.getElementById('news-list');
  if (!items.length) return;
  newsList.innerHTML = items.map(item => `
    <a class="news-item" href="${item.link}" target="_blank" rel="noopener noreferrer">
      <span class="news-badge ${item.badge}">${item.label}</span>
      <span class="news-headline">${item.title}</span>
      <span class="news-meta">${item.date ? timeAgo(item.date) : ''}</span>
      <span class="news-summary">${(item.summary || '').slice(0, 200)}${(item.summary || '').length > 200 ? '‚Ä¶' : ''}</span>
    </a>
  `).join('');
}

async function loadNews() {
  const newsCount  = document.getElementById('news-count');
  const newsList   = document.getElementById('news-list');
  const ticker     = document.getElementById('news-ticker');

  // Show loading state in ticker
  ticker.innerHTML = '<span style="color:var(--muted);font-size:0.65rem">Loading news‚Ä¶</span>';
  newsList.innerHTML = '<div class="news-loading">Loading latest motorsport news‚Ä¶</div>';

  const results  = await Promise.allSettled(NEWS_FEEDS.map(fetchFeed));
  const allItems = results.flatMap(r => r.status === 'fulfilled' ? r.value : []);

  if (allItems.length === 0) {
    ticker.innerHTML = '<span style="color:#ff6060;font-size:0.65rem">‚ö† News unavailable ‚Äî try disabling your ad blocker</span>';
    newsList.innerHTML = `<div class="news-error">‚ö† Could not load news feeds.<br>
      <span style="font-size:0.6rem;opacity:0.6">Ad blockers can prevent RSS proxy requests.</span></div>`;
    return;
  }

  // Deduplicate, sort newest first, cap at 20
  const seen = new Set();
  allNewsItems = allItems.filter(item => {
    const key = item.title.toLowerCase().replace(/\s+/g, '').slice(0, 50);
    if (seen.has(key)) return false;
    seen.add(key);
    return true;
  }).sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 20);

  newsCount.textContent = `${allNewsItems.length} ${t('stories')}`;
  buildTicker(getFilteredNews());
  buildDropdown(getFilteredNews());

  newsLoaded = true;
}

newsToggle.addEventListener('click', () => {
  const isOpen = newsBar.classList.toggle('open');
  newsToggle.classList.toggle('open', isOpen);
  const ticker = document.getElementById('news-ticker');
  ticker.style.animationPlayState = isOpen ? 'paused' : 'running';
  if (isOpen) {
    const newsList = document.getElementById('news-list');
    newsList.scrollTop = 0;
    // Measure actual 3-item height once open and layout has settled
    requestAnimationFrame(() => requestAnimationFrame(() => {
      const items = newsList.querySelectorAll('.news-item');
      if (items.length >= 3) {
        const h = Math.round(
          items[2].getBoundingClientRect().bottom -
          items[0].getBoundingClientRect().top
        );
        newsList.style.maxHeight = h + 'px';
        newsBar.style.maxHeight  = (h + 8) + 'px';
      }
    }));
  } else {
    // Clear inline styles so CSS max-height:0 takes over and bar collapses
    newsBar.style.maxHeight  = '';
    document.getElementById('news-list').style.maxHeight = '';
  }
});

// Load news automatically on page load
loadNews();

// ‚îÄ‚îÄ‚îÄ SIDEBAR COLLAPSE (desktop) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const sidebarCollapseBtn = document.getElementById('sidebar-collapse-btn');
const sidebarEl = document.querySelector('.sidebar');
sidebarCollapseBtn.addEventListener('click', () => {
  const collapsed = sidebarEl.classList.toggle('collapsed');
  sidebarCollapseBtn.textContent = collapsed ? '‚ñ∂' : '‚óÄ';
});

// ‚îÄ‚îÄ‚îÄ NEWS FILTER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let activeNewsFilter = 'all';
function getFilteredNews() {
  return activeNewsFilter === 'f1'    ? allNewsItems.filter(i => i.badge === 'f1')
       : activeNewsFilter === 'other' ? allNewsItems.filter(i => i.badge !== 'f1')
       : allNewsItems;
}
document.querySelectorAll('.news-filter-btn').forEach(btn => {
  btn.addEventListener('click', e => {
    e.stopPropagation();
    activeNewsFilter = btn.dataset.filter;
    document.querySelectorAll('.news-filter-btn').forEach(b =>
      b.classList.toggle('active', b.dataset.filter === activeNewsFilter));
    const filtered = getFilteredNews();
    buildTicker(filtered);
    buildDropdown(filtered);
  });
});

// ‚îÄ‚îÄ‚îÄ MOBILE: globe centering when session panel shown ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function nudgeGlobeForPanel(open) {
  if (!isMobile()) return;
  // Tilt camera lookAt up so the selected city sits above the 33vh panel
  const panelFraction = open ? 0.33 : 0;
  cameraLookAt.y = open ? -panelFraction * 0.6 : 0;
  camera.lookAt(cameraLookAt);
}

// ‚îÄ‚îÄ‚îÄ MOBILE: news filter ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let mobNewsFilter = 'all';

function populateMobileNews() {
  const mobileNewsList = document.getElementById('news-list-mobile');
  const mobCount = document.getElementById('mob-news-count');
  let items = allNewsItems;
  if (mobNewsFilter === 'f1') {
    items = allNewsItems.filter(i => i.badge === 'f1');
  } else if (mobNewsFilter === 'other') {
    items = allNewsItems.filter(i => i.badge !== 'f1');
  }
  if (mobCount) mobCount.textContent = `¬∑ ${items.length} ${t('stories')}`;
  mobileNewsList.innerHTML = items.length ? items.map(item => `
    <a class="news-item" href="${item.link}" target="_blank" rel="noopener noreferrer">
      <span class="news-badge ${item.badge}">${item.label}</span>
      <span class="news-headline">${item.title}</span>
      <span class="news-meta">${item.date ? timeAgo(item.date) : ''}</span>
      <span class="news-summary">${(item.summary || '').slice(0, 200)}${(item.summary || '').length > 200 ? '‚Ä¶' : ''}</span>
    </a>
  `).join('') : '<div class="news-loading">No stories in this category.</div>';
}

document.querySelectorAll('.mob-news-filter').forEach(btn => {
  btn.addEventListener('click', () => {
    mobNewsFilter = btn.dataset.filter;
    document.querySelectorAll('.mob-news-filter').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    populateMobileNews();
  });
});
// ‚îÄ‚îÄ‚îÄ MOBILE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄo start below the header
function positionMobileOverlay(el) {
  if (!isMobile() || !el) return;
  const header = document.querySelector('header');
  if (!header) return;
  el.style.top = Math.round(header.getBoundingClientRect().bottom) + 'px';
}

function positionMobileRaceList() {
  positionMobileOverlay(document.getElementById('mobile-race-list'));
}

window.addEventListener('resize', () => {
  positionMobileRaceList();
  positionMobileOverlay(document.getElementById('mobile-news'));
});
setTimeout(() => {
  positionMobileRaceList();
  positionMobileOverlay(document.getElementById('mobile-news'));
}, 100);

function mobileTab(tab) {
  if (!isMobile()) return;
  stopTour(); // stop globe auto-tour whenever any tab is tapped
  closeSessionPanel(); // close session panel when switching tabs

  document.querySelectorAll('.mob-tab').forEach(b => b.classList.remove('active'));
  document.getElementById('tab-' + tab)?.classList.add('active');

  const raceListOverlay = document.getElementById('mobile-race-list');
  const mobileNews      = document.getElementById('mobile-news');

  // Hide all overlays first
  raceListOverlay.classList.remove('visible');
  mobileNews.classList.remove('visible');

  if (tab === 'list') {
    positionMobileRaceList();

    if (!raceListOverlay.dataset.built) {
      raceListOverlay.dataset.built = '1';
      const sidebar = document.querySelector('.sidebar');
      raceListOverlay.innerHTML = sidebar.innerHTML;

      const cloneList = raceListOverlay.querySelector('.city-list');
      if (cloneList) { cloneList.style.flex = '1'; cloneList.style.overflowY = 'auto'; }

      raceListOverlay.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          setActiveFilter(btn.dataset.filter);
          syncMobileList();
        });
      });

      raceListOverlay.querySelectorAll('.city-item').forEach((clone) => {
        clone.addEventListener('click', () => {
          const cityIdx = parseInt(clone.dataset.idx, 10);
          mobileTab('globe');
          setTimeout(() => {
            highlightSidebar(cityIdx);
            spinToCity(cityIdx);
            openSessionPanel(cityIdx);
          }, 80);
        });
      });
    }

    syncMobileList();
    raceListOverlay.classList.add('visible');

  } else if (tab === 'news') {
    positionMobileOverlay(mobileNews);
    mobileNews.classList.add('visible');

    // Populate mobile news list if not yet done
    const mobileNewsList = document.getElementById('news-list-mobile');
    if (!mobileNews.dataset.built && allNewsItems.length > 0) {
      mobileNews.dataset.built = '1';
      populateMobileNews();
    } else if (!mobileNews.dataset.built) {
      // News still loading ‚Äî check again shortly
      const check = setInterval(() => {
        if (allNewsItems.length > 0) {
          clearInterval(check);
          mobileNews.dataset.built = '1';
          populateMobileNews();
        }
      }, 300);
    }
  }
}

// Sync hidden/active state of cloned city items with the main list
function syncMobileList() {
  const raceListOverlay = document.getElementById('mobile-race-list');
  const mainItems  = document.querySelectorAll('#city-list .city-item');
  const cloneItems = raceListOverlay.querySelectorAll('.city-item');
  cloneItems.forEach((clone, i) => {
    const main = mainItems[i];
    if (!main) return;
    clone.classList.toggle('hidden',  main.classList.contains('hidden'));
    clone.classList.toggle('active',  main.classList.contains('active'));
  });
  // Sync count label
  const mainCount  = document.getElementById('sidebar-count');
  const cloneCount = raceListOverlay.querySelector('#sidebar-count');
  if (cloneCount && mainCount) cloneCount.textContent = mainCount.textContent;
}

// Close session panel when tapping outside it on mobile ‚Äî handled by touchend on container


// ‚îÄ‚îÄ‚îÄ INFO PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initInfoPanel() {
  const overlay = document.getElementById('info-overlay');
  const closeBtn = document.getElementById('info-close');
  if (!overlay || !closeBtn) return;

  function openInfo(tab) {
    overlay.classList.add('open');
    if (tab) switchInfoTab(tab);
    buildSeriesPane();
  }
  function closeInfo() {
    overlay.classList.remove('open');
  }
  function switchInfoTab(name) {
    document.querySelectorAll('.info-tab').forEach(b => b.classList.toggle('active', b.dataset.tab === name));
    document.querySelectorAll('.info-pane').forEach(p => p.classList.toggle('active', p.id === 'info-pane-' + name));
  }

  const infoBtn = document.getElementById('info-btn');
  if (infoBtn) infoBtn.addEventListener('click', () => openInfo('about'));
  closeBtn.addEventListener('click', closeInfo);
  overlay.addEventListener('click', e => { if (e.target === overlay) closeInfo(); });
  document.addEventListener('keydown', e => { if (e.key === 'Escape') closeInfo(); });
  document.querySelectorAll('.info-tab').forEach(btn => {
    btn.addEventListener('click', () => switchInfoTab(btn.dataset.tab));
  });
}

</script>

<!-- INFO PANEL -->
<div id="info-overlay">
  <div id="info-panel">
    <div id="info-panel-header">
      <span id="info-panel-title">GridPulse &middot; Info</span>
      <button id="info-close" data-i18n-title="close">&#10005;</button>
    </div>
    <div id="info-tabs">
      <button class="info-tab" data-tab="series" data-i18n="info_series">Series</button>
      <button class="info-tab active" data-tab="about" data-i18n="info_about">About</button>
      <button class="info-tab" data-tab="contact" data-i18n="info_contact">Contact</button>
      <button class="info-tab" data-tab="terms" data-i18n="info_terms">Terms of Use</button>
    </div>
    <div id="info-content">

      <div class="info-pane" id="info-pane-series">
        <h2 data-i18n="info_series_h">Series <em>Settings</em></h2>
        <p data-i18n="info_series_desc" style="font-size:0.6rem;color:var(--muted);margin-bottom:0.5rem">Choose which racing series are shown on the globe, calendar, and header.</p>
        <div class="series-pref-grid" id="series-pref-grid">
          <!-- Populated by JS -->
        </div>
        <p class="series-pref-note" data-i18n="info_series_note">Your selection is saved in your browser and restored on every visit.</p>
        <button id="series-reset-btn" data-i18n="info_series_reset">Reset to all series</button>
      </div>

      <div class="info-pane active" id="info-pane-about">
        <h2>Grid<em>Pulse</em></h2>
        <p data-i18n="info_intro1">GridPulse is a live motorsport calendar and race tracker built for fans who want to follow the full racing season &mdash; across every series, on a single globe.</p>
        <p data-i18n="info_intro2">Spin the globe, explore circuits, and see exactly what is racing where and when. Every round is plotted on an interactive 3D map with real-time countdowns to the next session.</p>
        <h3 data-i18n="info_h_covered">What is covered</h3>
        <ul>
          <li data-i18n="info_li_f1">Formula 1 &mdash; full season calendar with practice, qualifying and race sessions</li>
          <li data-i18n="info_li_f2f3">Formula 2 &amp; Formula 3 &mdash; sprint and feature race sessions</li>
          <li data-i18n="info_li_f1a">F1 Academy &mdash; the all-female development series</li>
          <li data-i18n="info_li_fe">Formula E &mdash; electric street racing E-Prix calendar</li>
          <li data-i18n="info_li_indy">IndyCar &mdash; oval and road course championship calendar</li>
        </ul>
        <h3 data-i18n="info_h_how">How to use it</h3>
        <ul>
          <li data-i18n="info_how_1">Drag the globe to rotate, scroll or pinch to zoom</li>
          <li data-i18n="info_how_2">Click any race dot to open the full session schedule</li>
          <li data-i18n="info_how_3">Use the series filter to focus on a single championship</li>
          <li data-i18n="info_how_4">Press &#9654; to start the automatic race tour</li>
          <li data-i18n="info_how_5">The header rotates through next-up races across all active series</li>
        </ul>
        <h3 data-i18n="info_h_data">Data &amp; updates</h3>
        <p data-i18n="info_data_p">Session times are sourced from official series calendars and displayed in your local time zone. News feeds are pulled live from Autosport and The Race.</p>
        <div class="info-divider"></div>
        <p style="font-size:0.52rem;opacity:0.35" data-i18n="info_disclaimer">GridPulse is an independent fan project and is not affiliated with Formula One Management, Formula E Operations, IndyCar or any team or driver.</p>
      </div>

      <div class="info-pane" id="info-pane-contact">
        <h2 data-i18n-html="info_contact_h2">Get in <em>Touch</em></h2>
        <p data-i18n="info_contact_intro">Have a question, found a bug, or want to suggest a feature? We would love to hear from you.</p>
        <h3 data-i18n="info_contact_general">General enquiries</h3>
        <div class="info-contact-grid">
          <div class="info-contact-card"><div class="label" data-i18n="info_email">Email</div><div class="value"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="620a070e0e0d2205100b0612170e11074c031212">[email&#160;protected]</a></div></div>
          <div class="info-contact-card"><div class="label" data-i18n="info_response">Response time</div><div class="value" data-i18n="info_response_val">2&ndash;3 business days</div></div>
          <div class="info-contact-card"><div class="label" data-i18n="info_bugs">Bug reports</div><div class="value"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ed8f988a9ead8a9f84899d98819e88c38c9d9d">[email&#160;protected]</a></div></div>
          <div class="info-contact-card"><div class="label" data-i18n="info_feedback">Feature requests</div><div class="value"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5234373736303331391235203b3622273e21377c332222">[email&#160;protected]</a></div></div>
        </div>
        <h3 data-i18n="info_follow">Follow us</h3>
        <div class="info-contact-grid">
          <div class="info-contact-card"><div class="label">X / Twitter</div><div class="value">@gridpulseapp</div></div>
          <div class="info-contact-card"><div class="label">Instagram</div><div class="value">@gridpulse</div></div>
        </div>
        <div class="info-divider"></div>
        <p style="font-size:0.52rem;opacity:0.35">GridPulse &middot; 1 Racing Way &middot; London &middot; EC1A 1BB &middot; United Kingdom</p>
      </div>

      <div class="info-pane" id="info-pane-terms">
        <h2 data-i18n-html="info_terms_h2">Terms of <em>Use</em></h2>
        <p class="terms-bilingual-note" id="terms-bilingual-note" style="display:none;font-size:0.55rem;padding:0.5rem 0.7rem;background:rgba(200,255,0,0.06);border-left:2px solid var(--accent);margin-bottom:1rem;border-radius:0 4px 4px 0"></p>
        <div id="terms-body">
          <p data-i18n="terms_intro">Last updated: January 2026. By accessing or using GridPulse you agree to these terms.</p>
          <div class="terms-section" data-section="1">
            <h3 data-i18n="terms_h1">1. Acceptance</h3>
            <p data-i18n="terms_p1">These terms govern your access to GridPulse. By using the Service you confirm you are at least 13 years old and agree to be bound by these terms. If you do not agree, please do not use the Service.</p>
            <p class="terms-en-shadow" data-en-key="terms_p1" style="display:none"></p>
          </div>
          <div class="terms-section" data-section="2">
            <h3 data-i18n="terms_h2">2. Permitted use</h3>
            <p data-i18n="terms_p2">GridPulse is provided for personal, non-commercial use only. You may not reproduce, scrape, redistribute or commercially exploit any content, data or code from the Service without prior written permission.</p>
            <p class="terms-en-shadow" data-en-key="terms_p2" style="display:none"></p>
          </div>
          <div class="terms-section" data-section="3">
            <h3 data-i18n="terms_h3">3. Accuracy of information</h3>
            <p data-i18n="terms_p3">While we strive to keep all session times and calendar data accurate, GridPulse does not guarantee the completeness or accuracy of information displayed. Always verify critical information with official series sources.</p>
            <p class="terms-en-shadow" data-en-key="terms_p3" style="display:none"></p>
          </div>
          <div class="terms-section" data-section="4">
            <h3 data-i18n="terms_h4">4. Third-party content</h3>
            <p data-i18n="terms_p4">GridPulse aggregates news from third-party sources including Autosport and The Race. We are not responsible for the content of these external sources.</p>
            <p class="terms-en-shadow" data-en-key="terms_p4" style="display:none"></p>
          </div>
          <div class="terms-section" data-section="5">
            <h3 data-i18n="terms_h5">5. Intellectual property</h3>
            <p data-i18n="terms_p5">All original content, design and code within GridPulse is the property of GridPulse and its creators. Series names, logos and trademarks referenced belong to their respective owners.</p>
            <p class="terms-en-shadow" data-en-key="terms_p5" style="display:none"></p>
          </div>
          <div class="terms-section" data-section="6">
            <h3 data-i18n="terms_h6">6. Limitation of liability</h3>
            <p data-i18n="terms_p6">The Service is provided without warranties of any kind. To the fullest extent permitted by law, GridPulse shall not be liable for any direct, indirect, incidental or consequential damages from your use.</p>
            <p class="terms-en-shadow" data-en-key="terms_p6" style="display:none"></p>
          </div>
          <div class="terms-section" data-section="7">
            <h3 data-i18n="terms_h7">7. Changes to terms</h3>
            <p data-i18n="terms_p7">We may update these terms from time to time. Continued use of the Service following any changes constitutes acceptance of the revised terms.</p>
            <p class="terms-en-shadow" data-en-key="terms_p7" style="display:none"></p>
          </div>
          <div class="terms-section" data-section="8">
            <h3 data-i18n="terms_h8">8. Governing law</h3>
   
            <p data-i18n="terms_p8">These terms are governed by the laws of England and Wales. Any disputes shall be subject to the exclusive jurisdiction of the courts of England and Wales.</p>
            <p class="terms-en-shadow" data-en-key="terms_p8" style="display:none"></p>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
<script>initInfoPanel();</script>
</body>
</html>